import{a as P,c as q,b as j,u as A,bl as G,aR as O,z as i,B as H,f as J,k as e,o as b,h as K,n as s,w as l,j as Q,bq as v,l as C,N as x,v as h,t as k,x as W,bv as X}from"./index-8b526734.js";import{F as S}from"./index-03ea37ad.js";import"./index-3e87b811.js";import{C as Y}from"./index-47ca6c32.js";import{_ as Z}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-671f13b1.js";import{u as ee,a as ae,b as se,L as oe}from"./useLogin-ae32d63a.js";import{V as te}from"./index-9bbd8b07.js";import{s as ne,g as le}from"./login-80d7827e.js";const ie={key:0},be=P({__name:"MobileForm",setup(re){const c=S.Item,{t:o}=q(),{prefixCls:_}=j("login"),{createMessage:w,notification:I,createErrorModal:N}=W(),{handleBackLogin:T,getLoginState:z}=ee(),{tenantEnable:d,captchaEnable:B}=A(),{getFormRules:F}=ae(),L=G(),E=O(),f=i(),u=i(!1),m=i(0),V=i(21),p=i(),M=i("blockPuzzle"),t=H({tenantName:"芋道源码",mobile:"",mobileCode:"",captchaVerification:""}),{validForm:g}=se(f),R=J(()=>e(z)===oe.MOBILE);async function D(){B==="false"?await y():p.value.show()}async function U(){if(d==="true"){const n=await le(t.tenantName);X(n)}}async function y(){const n=await g();if(n)try{u.value=!0;const a=await L.smsLogin({mobile:n.mobile,code:n.mobileCode,mode:"none"});a&&(await E.changePermissionCode(a.permissions),I.success({message:o("sys.login.loginSuccessTitle"),description:`${o("sys.login.loginSuccessDesc")}: ${a.user.nickname}`,duration:3}))}catch(a){N({title:o("sys.api.errorTip"),content:a.message||o("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${_}`)||document.body})}finally{u.value=!1}}async function $(){if(await U(),m.value>0||!await g())return;await ne(t.mobile,V.value)&&(w.success(o("common.successText")),m.value=60)}return(n,a)=>R.value?(b(),K("div",ie,[s(Z,{class:"enter-x"}),s(e(S),{class:"p-4 enter-x",model:t,rules:e(F),ref_key:"formRef",ref:f},{default:l(()=>[s(e(c),{name:"tenantName",class:"enter-x"},{default:l(()=>[e(d)==="true"?(b(),Q(e(v),{key:0,size:"large",value:t.tenantName,"onUpdate:value":a[0]||(a[0]=r=>t.tenantName=r),placeholder:e(o)("sys.login.tenantName"),class:"fix-auto-fill"},null,8,["value","placeholder"])):C("",!0)]),_:1}),s(e(c),{name:"mobile",class:"enter-x"},{default:l(()=>[s(e(v),{size:"large",value:t.mobile,"onUpdate:value":a[1]||(a[1]=r=>t.mobile=r),placeholder:e(o)("sys.login.mobile"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),s(e(c),{name:"mobileCode",class:"enter-x"},{default:l(()=>[s(e(Y),{size:"large",class:"fix-auto-fill",value:t.mobileCode,"onUpdate:value":a[2]||(a[2]=r=>t.mobileCode=r),count:m.value,sendCodeApi:$,placeholder:e(o)("sys.login.smsCode")},null,8,["value","count","placeholder"])]),_:1}),s(e(c),{class:"enter-x"},{default:l(()=>[s(e(x),{type:"primary",size:"large",block:"",onClick:D,loading:u.value},{default:l(()=>[h(k(e(o)("sys.login.loginButton")),1)]),_:1},8,["loading"]),s(e(x),{size:"large",block:"",class:"mt-4",onClick:e(T)},{default:l(()=>[h(k(e(o)("sys.login.backSignIn")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"]),s(e(te),{ref_key:"verify",ref:p,mode:"pop",captchaType:M.value,imgSize:{width:"400px",height:"200px"},onSuccess:y},null,8,["captchaType"])])):C("",!0)}});export{be as _};
