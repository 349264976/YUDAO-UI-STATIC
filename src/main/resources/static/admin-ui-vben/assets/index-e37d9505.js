import{a as b,bv as v,bp as I,J as L,H as N,f7 as U,ax as W,B as p,j as D,o as _,c as E,w as l,b as e,e as r,u as t,k as c,af as i,f as g,F as O,r as P,f8 as A}from"./index-185fe65d.js";import{T as F}from"./index-ea6c9550.js";import{P as J}from"./index-341544d4.js";import"./index-a2353b1b.js";import"./index-a331c47c.js";import"./useSize-536e554d.js";import"./eagerComputed-625aaa6f.js";import"./useWindowSizeFn-513fc031.js";import"./useContentViewHeight-f2cd4d02.js";import"./ArrowLeftOutlined-b0e96cce.js";import"./index-1091f5b3.js";import"./transButton-4d2a5fee.js";const M={class:"flex"},j={class:"w-1/3 bg-white p-4"},H={class:"flex items-center"},R=e("span",{class:"text-lg font-medium mr-4"}," 连接状态: ",-1),q=e("hr",{class:"my-4"},null,-1),z={class:"flex"},G=e("p",{class:"text-lg font-medium mt-4"},"设置",-1),K=e("hr",{class:"my-4"},null,-1),Q={class:"w-2/3 bg-white ml-4 p-4"},X=e("span",{class:"text-lg font-medium mr-4"}," 消息记录: ",-1),Y=e("hr",{class:"my-4"},null,-1),Z={class:"max-h-80 overflow-auto"},$={class:"flex items-center"},ee=e("span",{class:"mr-2 text-primary font-medium"},"收到消息:",-1),te=b({name:"InfraWebSocket"}),fe=b({...te,setup(se){const x=v.TextArea,k=I(),s=L({sendValue:"",recordList:[]}),d=N("http://localhost:48080/websocket/message".replace("http","ws")+"?userId="+k.getUserInfo.user.id),{status:f,data:u,send:w,close:y,open:T}=U(d.value,{autoReconnect:!1,heartbeat:!0});W(()=>{if(u.value)try{const m=JSON.parse(u.value);s.recordList.push(m)}catch{s.recordList.push({res:u.value,id:Math.ceil(Math.random()*1e3),time:new Date().getTime()})}});const o=p(()=>f.value==="OPEN"),S=p(()=>o.value?"success":"red"),V=p(()=>[...s.recordList].reverse());function C(){w(s.sendValue),s.sendValue=""}function B(){o.value?y():T()}return(m,n)=>{const h=D("a-button");return _(),E(t(J),{title:"WebSocket 示例"},{default:l(()=>[e("div",M,[e("div",j,[e("div",H,[R,r(t(F),{color:t(S)},{default:l(()=>[c(i(t(f)),1)]),_:1},8,["color"])]),q,e("div",z,[r(t(v),{value:d.value,"onUpdate:value":n[0]||(n[0]=a=>d.value=a),disabled:""},{addonBefore:l(()=>[c(" 服务地址 ")]),_:1},8,["value"]),r(h,{type:t(o)?"danger":"primary",onClick:B},{default:l(()=>[c(i(t(o)?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),G,K,r(t(x),{placeholder:"需要发送到服务器的内容",disabled:!t(o),value:s.sendValue,"onUpdate:value":n[1]||(n[1]=a=>s.sendValue=a),allowClear:""},null,8,["disabled","value"]),r(h,{type:"primary",block:"",class:"mt-4",disabled:!t(o),onClick:C},{default:l(()=>[c(" 发送 ")]),_:1},8,["disabled"])]),e("div",Q,[X,Y,e("div",Z,[e("ul",null,[(_(!0),g(O,null,P(t(V),a=>(_(),g("li",{class:"mt-2",key:a.time},[e("div",$,[ee,e("span",null,i(t(A)(a.time)),1)]),e("div",null,i(a.res),1)]))),128))])])])])]),_:1})}}});export{fe as default};
