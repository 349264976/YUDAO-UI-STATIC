import{a as U,c as A,z as s,k as e,o as g,j as I,w as k,n as K,l as N,ag as F,x as L}from"./index-8b526734.js";import{u as V,_ as $}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{_ as E}from"./index-ccb32bec.js";import{a as j,B as q}from"./index-40f1f97e.js";import"./index-ec19b8e7.js";import"./index-d2d20fb4.js";import{h as z}from"./tree-e6981725.js";import"./index-03ea37ad.js";import"./index-3e87b811.js";import"./index-c8168e27.js";import"./sortable.esm-f208c0d8.js";import{u as _}from"./useRender-f65ba3eb.js";import{D as p,g as v}from"./dict-5cefafd8.js";import{a as G,u as H,c as W}from"./index-855bdeff.js";import{l as Y}from"./index-a2b632f4.js";import{w as J}from"./without-2018bea7.js";const he=[{title:"套餐编号",dataIndex:"id",width:100},{title:"套餐名",dataIndex:"name",width:180},{title:"状态",dataIndex:"status",width:180,customRender:({text:o})=>_.renderDict(o,p.COMMON_STATUS)},{title:"备注",dataIndex:"remark",width:180},{title:"创建时间",dataIndex:"createTime",width:180,customRender:({text:o})=>_.renderDate(o)}],ge=[{label:"套餐名",field:"name",component:"Input",colProps:{span:8}},{label:"状态",field:"status",component:"Select",componentProps:{options:v(p.COMMON_STATUS)},colProps:{span:8}},{label:"创建时间",field:"createTime",component:"RangePicker",colProps:{span:8}}],Q=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"套餐名",field:"name",required:!0,component:"Input"},{label:"菜单权限",field:"menuIds",slot:"menuIds",component:"Input"},{label:"状态",field:"status",component:"Select",componentProps:{options:v(p.COMMON_STATUS)}}],Ie=U({name:"SystemTenantPackageModal",__name:"TenantPackageModal",emits:["success","register"],setup(o,{emit:w}){const{t:l}=A(),{createMessage:y}=L(),r=s(!0),c=s([]),i=s([]),m=s([]),S=s(1),f=s(new Set),d=s(),[T,{setFieldsValue:M,resetFields:P,validate:b}]=V({labelWidth:120,baseColProps:{span:24},schemas:Q,showActionButtonGroup:!1,actionColOptions:{span:23}}),[C,{setModalProps:u,closeModal:x}]=j(async t=>{if(P(),O(),u({confirmLoading:!1}),e(c).length===0){const a=await Y();c.value=z(a,"id"),f.value=new Set(a.map(n=>n.parentId))}if(r.value=!!t?.isUpdate,e(r)){const a=await G(t.record.id),n=J(a.menuIds,...Array.from(f.value));i.value=a.menuIds,a.menuIds=n,await M({...a})}e(d)&&e(d).filterByLevel(S.value)});async function R(){try{const t=await b();t.menuIds=[...i.value,...m.value],u({confirmLoading:!0}),e(r)?await H(t):await W(t),x(),w("success"),y.success(l("common.saveSuccessText"))}finally{u({confirmLoading:!1})}}function O(){i.value=[],m.value=[]}function D(t,a){t instanceof Array&&(i.value=t,m.value=a.halfCheckedKeys)}return(t,a)=>(g(),I(e(q),F(t.$attrs,{onRegister:e(C),title:r.value?e(l)("action.edit"):e(l)("action.create"),onOk:R}),{default:k(()=>[K(e($),{onRegister:e(T)},{menuIds:k(({model:n,field:h})=>[c.value.length?(g(),I(e(E),{key:0,ref_key:"treeRef",ref:d,checkedKeys:n[h],"onUpdate:checkedKeys":B=>n[h]=B,treeData:c.value,fieldNames:{title:"name",key:"id"},checkable:"",toolbar:"",search:"",showStrictlyButton:!1,selectable:!1,onCheck:D,title:"菜单分配"},null,8,["checkedKeys","onUpdate:checkedKeys","treeData"])):N("",!0)]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Ie as _,he as c,ge as s};
