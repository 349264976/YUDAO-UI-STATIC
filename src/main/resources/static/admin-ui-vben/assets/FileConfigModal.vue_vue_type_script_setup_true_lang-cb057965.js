import{cm as n,a as F,c as _,z as R,k as o,o as P,j as C,w as A,n as k,ag as q,x}from"./index-8b526734.js";import{u as M,_ as T}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{a as y,B as E}from"./index-40f1f97e.js";import"./index-ec19b8e7.js";import"./index-d2d20fb4.js";import"./tree-e6981725.js";import"./index-03ea37ad.js";import"./index-3e87b811.js";import"./index-c8168e27.js";import"./sortable.esm-f208c0d8.js";import{u as f}from"./useRender-f65ba3eb.js";import{D as a,g as u}from"./dict-5cefafd8.js";const Q=[{title:"编号",dataIndex:"id",width:100},{title:"配置名",dataIndex:"name",width:180},{title:"存储器",dataIndex:"storage",width:100,customRender:({text:e})=>f.renderDict(e,a.INFRA_FILE_STORAGE)},{title:"主配置",dataIndex:"master",width:180,customRender:({text:e})=>f.renderDict(e,a.INFRA_BOOLEAN_STRING)},{title:"备注",dataIndex:"remark",width:180},{title:"创建时间",dataIndex:"createTime",width:180,customRender:({text:e})=>f.renderDate(e)}],X=[{label:"配置名",field:"name",component:"Input",colProps:{span:8}},{label:"存储器",field:"storage",component:"Select",componentProps:{options:u(a.INFRA_FILE_STORAGE)},colProps:{span:8}},{label:"创建时间",field:"createTime",component:"RangePicker",colProps:{span:8}}],O=[{label:"编号",field:"id",show:!1,component:"Input"},{label:"配置名",field:"name",required:!0,component:"Input"},{label:"存储器",field:"storage",component:"Select",required:!0,dynamicDisabled:({values:e})=>!!e.id,componentProps:{options:u(a.INFRA_FILE_STORAGE)}},{label:"基础路径",field:"config.basePath",required:!0,ifShow:({values:e})=>e.storage>=10&&e.storage<=12,component:"Input"},{label:"主机地址",field:"config.host",required:!0,ifShow:({values:e})=>e.storage>=11&&e.storage<=12,component:"Input"},{label:"主机端口",field:"config.port",required:!0,ifShow:({values:e})=>e.storage>=11&&e.storage<=12,component:"Input"},{label:"用户名",field:"config.username",required:!0,ifShow:({values:e})=>e.storage>=11&&e.storage<=12,component:"Input"},{label:"密码",field:"config.password",required:!0,ifShow:({values:e})=>e.storage>=11&&e.storage<=12,component:"Input"},{label:"连接模式",field:"config.basePath",required:!0,ifShow:({values:e})=>e.storage===11,component:"Select",componentProps:{options:[{lable:"主动模式",key:"Active",value:"Active"},{lable:"被动模式",key:"Passive",value:"Passive"}]}},{label:"节点地址",field:"config.endpoint",required:!0,ifShow:({values:e})=>e.storage===20,component:"Input"},{label:"存储 bucket",field:"config.bucket",required:!0,ifShow:({values:e})=>e.storage===20,component:"Input"},{label:"accessKey",field:"config.accessKey",ifShow:({values:e})=>e.storage===20,component:"Input"},{label:"accessSecret",field:"config.accessSecret",ifShow:({values:e})=>e.storage===20,component:"Input"},{label:"自定义域名",field:"config.domain",required:!0,component:"Input"},{label:"备注",field:"remark",component:"InputTextArea"}];function Z(e){return n.get({url:"/infra/file-config/page",params:e})}function D(e){return n.get({url:"/infra/file-config/get?id="+e})}function ee(e){return n.put({url:"/infra/file-config/update-master?id="+e})}function L(e){return n.post({url:"/infra/file-config/create",data:e})}function N(e){return n.put({url:"/infra/file-config/update",data:e})}function te(e){return n.delete({url:"/infra/file-config/delete?id="+e})}function oe(e){return n.get({url:"/infra/file-config/test?id="+e})}const ne=F({name:"InfraFileConfigModal",__name:"FileConfigModal",emits:["success","register"],setup(e,{emit:d}){const{t:s}=_(),{createMessage:p}=x(),r=R(!0),[m,{setFieldsValue:g,resetFields:I,validate:h}]=M({labelWidth:120,baseColProps:{span:24},schemas:O,showActionButtonGroup:!1,actionColOptions:{span:23}}),[b,{setModalProps:l,closeModal:w}]=y(async t=>{if(I(),l({confirmLoading:!1}),r.value=!!t?.isUpdate,o(r)){const i=await D(t.record.id);g({...i})}});async function S(){try{let t=await h(),i={};for(let c in t)c.startsWith("config.")&&(i[c.substring(7)]=t[c]);t.config=i,l({confirmLoading:!0}),o(r)?await N(t):await L(t),w(),d("success"),p.success(s("common.saveSuccessText"))}finally{l({confirmLoading:!1})}}return(t,i)=>(P(),C(o(E),q(t.$attrs,{onRegister:o(b),title:r.value?o(s)("action.edit"):o(s)("action.create"),onOk:S}),{default:A(()=>[k(o(T),{onRegister:o(m)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{ne as _,Q as c,te as d,Z as g,X as s,oe as t,ee as u};
