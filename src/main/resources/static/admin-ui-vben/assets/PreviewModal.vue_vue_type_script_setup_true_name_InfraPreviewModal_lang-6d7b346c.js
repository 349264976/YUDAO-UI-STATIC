import{a as k,H as h,j as I,o as m,c as b,w as f,b as y,e as d,u as i,f as N,F as j,r as K,k as S,af as D,ag as E,eE as R,l as V}from"./index-185fe65d.js";import{C as w}from"./index-bb610c0a.js";import{T as P}from"./index-ed8d3e4e.js";import"./index-e80a262d.js";import{_ as $}from"./index-9a79925f.js";import{u as L,B as O}from"./index-b9c40b5d.js";import{p as q}from"./index-f2d2d6f2.js";import{f as A}from"./tree-1cdc2dee.js";const H={class:"flex"},U=k({name:"InfraPreviewModal"}),ae=k({...U,setup(W){const C=P.TabPane,{createMessage:v}=V(),_=h([]),p=h(""),g=h(),[x,{setModalProps:T}]=L(async o=>{T({confirmLoading:!1});const t=await q(o.record.id);let r=B(t);g.value=t,p.value=t[0].filePath,_.value=A(r,"id","parentId","children","/")});function M(o){p.value=o[0]}function B(o){let t={},r=[];for(const l of o){let a=l.filePath.split("/"),c="";if(a[a.length-1].indexOf(".java")>=0){let s=[];for(let n=0;n<a.length;n++){let e=a[n];if(e!=="java"){s.push(e);continue}s.push(e);let u="";for(;n<a.length&&(e=a[n+1],!(e==="controller"||e==="convert"||e==="dal"||e==="enums"||e==="service"||e==="vo"||e==="mysql"||e==="dataobject"));)u=u?u+"."+e:e,n++;u&&s.push(u)}a=s}for(let s=0;s<a.length;s++){let n=c;c=c.length===0?a[s]:c.replaceAll(".","/")+"/"+a[s],!t[c]&&(t[c]=!0,r.push({id:c,label:a[s],parentId:n||"/"}))}}return r}async function F(o){const{copy:t,copied:r,isSupported:l}=R({source:o});l?(await t(),i(r)&&v.success("复制成功")):v.error("复制失败")}return(o,t)=>{const r=I("a-button");return m(),b(i(O),E(o.$attrs,{defaultFullscreen:!0,onRegister:i(x),title:"预览代码"}),{default:f(()=>[y("div",H,[d(i(w),{class:"w-1/4"},{default:f(()=>[d(i($),{title:"文件夹列表",toolbar:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:_.value,fieldNames:{key:"id",title:"label"},onSelect:M},null,8,["treeData"])]),_:1}),d(i(w),{class:"w-3/4"},{default:f(()=>[d(i(P),{activeKey:p.value,"onUpdate:activeKey":t[0]||(t[0]=l=>p.value=l)},{default:f(()=>[(m(!0),N(j,null,K(g.value,l=>(m(),b(i(C),{key:l.filePath,tab:l.filePath.substring(l.filePath.lastIndexOf("/")+1)},{default:f(()=>[d(r,{type:"link",style:{float:"right"},onClick:a=>F(l.code)},{default:f(()=>[S("复制")]),_:2},1032,["onClick"]),y("pre",null,D(l.code),1)]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1})])]),_:1},16,["onRegister"])}}});export{ae as _};
