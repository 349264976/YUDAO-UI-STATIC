import{a as E,z as m,s as F,o as h,j as w,w as d,i as I,n as u,k as r,h as N,F as j,r as K,v as S,ag as V,eP as D,x as O}from"./index-8b526734.js";import{C as y}from"./index-1cd9ce27.js";/* empty css              */import"./index-3e87b811.js";import{_ as R}from"./index-ccb32bec.js";import{a as $,B as A}from"./index-40f1f97e.js";import{M as L,C as q}from"./index-8629d074.js";import{p as z}from"./index-9608a02d.js";import{f as J}from"./tree-e6981725.js";import{T as P}from"./index-e8507731.js";const U={class:"flex"},oe=E({name:"InfraPreviewModal",__name:"PreviewModal",setup(W){const b=P.TabPane,{createMessage:v}=O(),_=m([]),p=m(""),C=m(L.JS),g=m(),[x,{setModalProps:k}]=$(async s=>{k({confirmLoading:!1});const t=await z(s.record.id);let n=T(t);g.value=t,p.value=t[0].filePath,_.value=J(n,"id","parentId","children","/")});function M(s){p.value=s[0]}function T(s){let t={},n=[];for(const l of s){let a=l.filePath.split("/"),c="";if(a[a.length-1].indexOf(".java")>=0){let o=[];for(let i=0;i<a.length;i++){let e=a[i];if(e!=="java"){o.push(e);continue}o.push(e);let f="";for(;i<a.length&&(e=a[i+1],!(e==="controller"||e==="convert"||e==="dal"||e==="enums"||e==="service"||e==="vo"||e==="mysql"||e==="dataobject"));)f=f?f+"."+e:e,i++;f&&o.push(f)}a=o}for(let o=0;o<a.length;o++){let i=c;c=c.length===0?a[o]:c.replaceAll(".","/")+"/"+a[o],!t[c]&&(t[c]=!0,n.push({id:c,label:a[o],parentId:i||"/"}))}}return n}async function B(s){const{copy:t,copied:n,isSupported:l}=D({source:s});l?(await t(),r(n)&&v.success("复制成功")):v.error("复制失败")}return(s,t)=>{const n=F("a-button");return h(),w(r(A),V(s.$attrs,{defaultFullscreen:!0,onRegister:r(x),title:"预览代码"}),{default:d(()=>[I("div",U,[u(r(y),{class:"w-1/4 min-w-130"},{default:d(()=>[u(r(R),{title:"文件夹列表",toolbar:"",defaultExpandAll:!0,treeWrapperClassName:"h-[800px] overflow-auto",clickRowToExpand:!1,treeData:_.value,fieldNames:{key:"id",title:"label"},onSelect:M},null,8,["treeData"])]),_:1}),u(r(y),{class:"w-3/4"},{default:d(()=>[u(r(P),{activeKey:p.value,"onUpdate:activeKey":t[0]||(t[0]=l=>p.value=l)},{default:d(()=>[(h(!0),N(j,null,K(g.value,l=>(h(),w(r(b),{key:l.filePath,tab:l.filePath.substring(l.filePath.lastIndexOf("/")+1)},{default:d(()=>[u(n,{type:"link",style:{float:"right"},onClick:a=>B(l.code)},{default:d(()=>[S("复制")]),_:2},1032,["onClick"]),u(r(q),{class:"max-h-200",value:l.code,mode:C.value,readonly:!0},null,8,["value","mode"])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey"])]),_:1})])]),_:1},16,["onRegister"])}}});export{oe as _};
