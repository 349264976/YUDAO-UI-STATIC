import{a as B,bq as h,bl as I,B as L,z as N,fs as U,aw as W,f as p,s as D,o as _,j as E,w as l,i as e,n as r,k as o,v as c,t as i,h as g,F as O,r as P,fr as A}from"./index-8b526734.js";import{T as F}from"./index-7aea77c8.js";import{P as M}from"./index-42e905fb.js";import"./index-d89d7986.js";import"./index-1967bd47.js";import"./useSize-5af631ed.js";import"./eagerComputed-6290a54f.js";import"./onMountedOrActivated-13e9417a.js";import"./useWindowSizeFn-38cd0f6d.js";import"./useContentViewHeight-0508c576.js";import"./ArrowLeftOutlined-83b12cfe.js";const j={class:"flex"},q={class:"w-1/3 bg-white p-4"},z={class:"flex items-center"},J=e("span",{class:"text-lg font-medium mr-4"}," 连接状态: ",-1),R=e("hr",{class:"my-4"},null,-1),G={class:"flex"},H=e("p",{class:"text-lg font-medium mt-4"},"设置",-1),K=e("hr",{class:"my-4"},null,-1),Q={class:"w-2/3 bg-white ml-4 p-4"},X=e("span",{class:"text-lg font-medium mr-4"}," 消息记录: ",-1),Y=e("hr",{class:"my-4"},null,-1),Z={class:"max-h-80 overflow-auto"},$={class:"flex items-center"},ee=e("span",{class:"mr-2 text-primary font-medium"},"收到消息:",-1),pe=B({name:"InfraWebSocket",__name:"index",setup(te){const b=h.TextArea,x=I(),t=L({sendValue:"",recordList:[]}),d=N("http://api-dashboard.yudao.iocoder.cn/websocket/message".replace("http","ws")+"?userId="+x.getUserInfo.user.id),{status:f,data:u,send:w,close:y,open:k}=U(d.value,{autoReconnect:!1,heartbeat:!0});W(()=>{if(u.value)try{const m=JSON.parse(u.value);t.recordList.push(m)}catch{t.recordList.push({res:u.value,id:Math.ceil(Math.random()*1e3),time:new Date().getTime()})}});const a=p(()=>f.value==="OPEN"),T=p(()=>a.value?"success":"red"),S=p(()=>[...t.recordList].reverse());function V(){w(t.sendValue),t.sendValue=""}function C(){a.value?y():k()}return(m,n)=>{const v=D("a-button");return _(),E(o(M),{title:"WebSocket 示例"},{default:l(()=>[e("div",j,[e("div",q,[e("div",z,[J,r(o(F),{color:T.value},{default:l(()=>[c(i(o(f)),1)]),_:1},8,["color"])]),R,e("div",G,[r(o(h),{value:d.value,"onUpdate:value":n[0]||(n[0]=s=>d.value=s),disabled:""},{addonBefore:l(()=>[c(" 服务地址 ")]),_:1},8,["value"]),r(v,{type:a.value?"danger":"primary",onClick:C},{default:l(()=>[c(i(a.value?"关闭连接":"开启连接"),1)]),_:1},8,["type"])]),H,K,r(o(b),{placeholder:"需要发送到服务器的内容",disabled:!a.value,value:t.sendValue,"onUpdate:value":n[1]||(n[1]=s=>t.sendValue=s),allowClear:""},null,8,["disabled","value"]),r(v,{type:"primary",block:"",class:"mt-4",disabled:!a.value,onClick:V},{default:l(()=>[c(" 发送 ")]),_:1},8,["disabled"])]),e("div",Q,[X,Y,e("div",Z,[e("ul",null,[(_(!0),g(O,null,P(S.value,s=>(_(),g("li",{class:"mt-2",key:s.time},[e("div",$,[ee,e("span",null,i(o(A)(s.time)),1)]),e("div",null,i(s.res),1)]))),128))])])])])]),_:1})}}});export{pe as default};
