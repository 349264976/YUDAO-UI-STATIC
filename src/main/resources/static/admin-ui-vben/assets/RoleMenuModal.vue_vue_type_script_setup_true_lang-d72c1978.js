import{a as K,c as F,z as s,k as a,o as f,j as p,w as h,n as L,l as P,ag as A,x as D}from"./index-8b526734.js";import{u as N,_ as V}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{a as $,B as O}from"./index-40f1f97e.js";import{m as T}from"./role.data-25790bb5.js";import{g as U}from"./index-74c73d6c.js";import{_ as j}from"./index-ccb32bec.js";import{l as z}from"./index-a2b632f4.js";import{h as E}from"./tree-e6981725.js";import{l as G,a as H}from"./index-1b3f13e5.js";import{w as W}from"./without-2018bea7.js";const re=K({name:"SystemRoleMenuModal",__name:"RoleMenuModal",emits:["success","register"],setup(q,{emit:g}){const{t:v}=F(),{createMessage:y}=D(),n=s([]),r=s([]),i=s([]),_=s(1),d=s(new Set),m=s(),[w,{setFieldsValue:k,resetFields:M,validate:R}]=N({labelWidth:120,baseColProps:{span:24},schemas:T,showActionButtonGroup:!1,actionColOptions:{span:23}}),[I,{setModalProps:u,closeModal:S}]=$(async e=>{if(await M(),B(),u({confirmLoading:!1}),a(n).length===0){const c=await z();n.value=E(c,"id"),d.value=new Set(c.map(x=>x.parentId))}const t=await U(e.record.id),o=await G(e.record.id),l=W(o,...Array.from(d.value));r.value=o,t.menuIds=l,await k({...t}),a(m)&&a(m).filterByLevel(_.value)});async function C(){try{const e=await R();u({confirmLoading:!0}),await H({roleId:e.id,menuIds:[...r.value,...i.value]}),S(),g("success"),y.success(v("common.saveSuccessText"))}finally{u({confirmLoading:!1})}}function B(){r.value=[],i.value=[]}function b(e,t){e instanceof Array&&(r.value=e,i.value=t.halfCheckedKeys||[])}return(e,t)=>(f(),p(a(O),A(e.$attrs,{onRegister:a(I),title:"修改角色菜单权限",onOk:C}),{default:h(()=>[L(a(V),{onRegister:a(w)},{menuIds:h(({model:o,field:l})=>[n.value.length?(f(),p(a(j),{key:0,ref_key:"treeRef",ref:m,checkedKeys:o[l],"onUpdate:checkedKeys":c=>o[l]=c,treeData:n.value,fieldNames:{title:"name",key:"id"},checkable:"",toolbar:"",search:"",showStrictlyButton:!1,selectable:!1,onCheck:b,title:"菜单分配"},null,8,["checkedKeys","onUpdate:checkedKeys","treeData"])):P("",!0)]),_:1},8,["onRegister"])]),_:1},16,["onRegister"]))}});export{re as _};
