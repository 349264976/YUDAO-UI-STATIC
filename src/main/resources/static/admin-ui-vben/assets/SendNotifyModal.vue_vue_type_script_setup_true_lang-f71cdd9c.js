import{a as M,B as S}from"./index-40f1f97e.js";import{u as w,_ as F}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{a as P,B as R,z as v,o as C,j as I,w as $,n as N,k as r,ag as V,x as k}from"./index-8b526734.js";import{b as x,s as j}from"./template.data-17076c3c.js";const W=P({name:"SendNotifyModal",__name:"SendNotifyModal",setup(E){const{createMessage:i}=k();let a=R([]);const n=v(""),[d,{setFieldsValue:m,getFieldsValue:u,validateFields:p,resetFields:f,clearValidate:h,setProps:l}]=w({labelWidth:100,baseColProps:{span:24},showSubmitButton:!1,showResetButton:!1}),[g,{changeLoading:c,closeModal:_}]=M(e=>{y(),e.params.forEach(o=>{const B={field:`key-${o}`,label:`参数{${o}} `,component:"Input",componentProps:{placeholder:`输入{${o}}`},required:!0};a.push(B)});const{content:t,code:s}=e;m({content:t}),n.value=s}),b=async()=>{try{l({disabled:!0}),c(!0),await p();const e=u(),t={userId:e.userId,templateCode:n.value,templateParams:{}};Object.keys(e).forEach(s=>{if(s==="content"||s==="userId")return;const o=s.split("-")[1];t.templateParams[o]=e[s]}),await j(t),i.success("发送站内信成功"),_()}finally{l({disabled:!1}),c(!1)}},y=()=>{a.splice(0,a.length),a.push(...x),f(),h()};return(e,t)=>(C(),I(r(S),V(e.$attrs,{title:"发送站内信",onRegister:r(g),onOk:b}),{default:$(()=>[N(r(F),{onRegister:r(d),schemas:r(a)},null,8,["onRegister","schemas"])]),_:1},16,["onRegister"]))}});export{W as _};
