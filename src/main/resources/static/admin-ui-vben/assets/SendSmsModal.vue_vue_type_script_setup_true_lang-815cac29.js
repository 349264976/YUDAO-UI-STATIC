import{a as M,B as w}from"./index-40f1f97e.js";import{u as F,_ as P}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{a as R,B as $,z as v,o as C,j as y,w as V,n as k,k as r,ag as x,x as j}from"./index-8b526734.js";import{b as E,s as I}from"./smsTemplate.data-fd40ce03.js";const W=R({name:"SendSmsModal",__name:"SendSmsModal",setup(O){const{createMessage:i}=j();let a=$([]);const n=v(""),[m,{setFieldsValue:d,getFieldsValue:p,validateFields:u,resetFields:f,clearValidate:h,setProps:l}]=F({labelWidth:100,baseColProps:{span:24},showSubmitButton:!1,showResetButton:!1}),[b,{changeLoading:c,closeModal:g}]=M(e=>{S(),e.params.forEach(o=>{const B={field:`key-${o}`,label:`参数{${o}} `,component:"Input",componentProps:{placeholder:`输入{${o}}`},required:!0};a.push(B)});const{content:t,code:s}=e;d({content:t}),n.value=s}),_=async()=>{try{l({disabled:!0}),c(!0),await u();const e=p(),t={mobile:e.mobile,templateCode:n.value,templateParams:{}};Object.keys(e).forEach(s=>{if(s==="content"||s==="mobile")return;const o=s.split("-")[1];t.templateParams[o]=e[s]}),await I(t),i.success(`发送短信到[${e.mobile}]成功`),g()}finally{l({disabled:!1}),c(!1)}},S=()=>{a.splice(0,a.length),a.push(...E),f(),h()};return(e,t)=>(C(),y(r(w),x(e.$attrs,{title:"测试发送短信",onRegister:r(b),onOk:_}),{default:V(()=>[k(r(P),{onRegister:r(m),schemas:r(a)},null,8,["onRegister","schemas"])]),_:1},16,["onRegister"]))}});export{W as _};
