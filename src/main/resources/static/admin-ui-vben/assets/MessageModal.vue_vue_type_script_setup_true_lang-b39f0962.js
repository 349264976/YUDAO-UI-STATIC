import{cm as o,a as _,c as T,z as h,o as M,j as w,w as I,n as P,k as a,ag as b,x}from"./index-8b526734.js";import{u as S,_ as R}from"./useForm-f7dccb87.js";import"./BasicForm.vue_vue_type_style_index_0_lang-42e5fba8.js";import{a as E,B as k}from"./index-40f1f97e.js";import"./index-ec19b8e7.js";import"./index-d2d20fb4.js";import"./tree-e6981725.js";import"./index-03ea37ad.js";import"./index-3e87b811.js";import"./index-c8168e27.js";import"./sortable.esm-f208c0d8.js";import{u as t}from"./useRender-f65ba3eb.js";import{D as p,g as C}from"./dict-5cefafd8.js";import{f as A}from"./index-6dcbd942.js";const J=[{title:"发送时间",dataIndex:"createTime",width:180,customRender:({text:n})=>t.renderDate(n)},{title:"消息类型",dataIndex:"type",width:80,customRender:({text:n})=>t.renderDict(n,p.MP_MESSAGE_TYPE)},{title:"发送方",dataIndex:"sendFrom",width:180,customRender:({text:n})=>n===1?t.renderTag("粉丝","success"):t.renderTag("公众号","default")},{title:"用户标识",dataIndex:"openid",width:300},{title:"内容",dataIndex:"content",width:300,customRender:({text:n,record:e})=>e.type==="event"&&e.event==="subscribe"?t.renderTag("关注","success"):e.type==="event"&&e.event==="unsubscribe"?t.renderTag("取消关注","warn"):e.type==="event"&&e.event==="CLICK"?t.renderTag("点击菜单"+e.eventKey):e.type==="event"&&e.event==="VIEW"?t.renderTag("点击菜单链接"+e.eventKey):e.type==="event"&&e.event==="scancode_waitmsg"?t.renderTag("扫码结果"+e.eventKey):e.type==="event"&&e.event==="scancode_push"?t.renderTag("扫码结果"+e.eventKey):e.type==="event"&&e.event==="pic_sysphoto"?t.renderTag("系统拍照发图"):e.type==="event"&&e.event==="pic_photo_or_album"?t.renderTag("拍照或者相册"):e.type==="event"&&e.event==="pic_weixin"?t.renderTag("微信相册"):e.type==="event"&&e.event==="location_select"?t.renderTag("选择地理位置"):e.type==="event"?t.renderTag("未知事件类型"):e.type==="text"?n:e.type==="voice"?e.mediaUrl:e.type==="image"?t.renderImg(e.mediaUrl):e.type==="video"||e.type==="shortvideo"?e.mediaUrl:e.type==="link"?t.renderLink(e.url,e.title):e.type==="location"?e.label:e.type==="music"?e.title:e.type==="news"?e.articles:t.renderTag("未知消息类型","warn")}],l=await A(),Q=[{label:"公众号",field:"accountId",component:"Select",required:!0,defaultValue:l[0].id,componentProps:{options:l,fieldNames:{label:"name",value:"id"}},colProps:{span:8}},{label:"消息类型",field:"type",component:"Select",componentProps:{options:C(p.MP_MESSAGE_TYPE,"string")},colProps:{span:8}},{label:"用户标识",field:"openid",component:"Input",colProps:{span:8}},{label:"创建时间",field:"createTime",component:"RangePicker",colProps:{span:8}}],B=[];function X(n){return o.get({url:"/mp/message/page",params:n})}function D(n){return o.post({url:"/mp/message/send",data:n})}const Z=_({name:"MpMessageModal",__name:"MessageModal",emits:["success","register"],setup(n,{emit:e}){const{t:u}=T(),{createMessage:m}=x(),r=h(0),[c,{resetFields:f,validate:g}]=S({labelWidth:120,baseColProps:{span:24},schemas:B,showActionButtonGroup:!1,actionColOptions:{span:23}}),[d,{setModalProps:i,closeModal:v}]=E(async s=>{f(),i({confirmLoading:!1}),r.value=s.record.userId});async function y(){try{const s=await g();s.userId=r.value,i({confirmLoading:!0}),await D(s),v(),e("success"),m.success(u("common.saveSuccessText"))}finally{i({confirmLoading:!1})}}return(s,F)=>(M(),w(a(k),b(s.$attrs,{onRegister:a(d),title:"发送消息",onOk:y}),{default:I(()=>[P(a(R),{onRegister:a(c)},null,8,["onRegister"])]),_:1},16,["onRegister"]))}});export{Z as _,J as c,X as g,Q as s};
