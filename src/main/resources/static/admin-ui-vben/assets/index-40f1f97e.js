import{c as oe,aw as L,k as o,ak as ue,a as _,ao as de,dS as fe,n as C,e8 as pe,e9 as ge,cP as me,av as he,au as ye,z as m,ea as ve,f as H,R as ne,C as be,T as ae,Q as w,H as Me,o as M,j as O,w as g,D as Ce,h as I,ax as T,aD as He,S as Se,b as le,F as ke,aB as z,l as V,a9 as Be,q as Fe,s as we,v as q,t as Y,ag as W,eb as Te,aN as Oe,aY as Pe,c3 as j,bc as Z,r as G,az as U,as as se,c_ as _e,aI as K,aJ as ee,B as re,al as E,c4 as De,d0 as $e,cZ as ie,bo as Re,bz as Ne}from"./index-8b526734.js";import{u as We}from"./useWindowSizeFn-38cd0f6d.js";import{a as xe,F as je}from"./FullscreenOutlined-8b988545.js";const{t:te}=oe(),Ee={visible:{type:Boolean},scrollTop:{type:Boolean,default:!0},height:{type:Number},minHeight:{type:Number},draggable:{type:Boolean,default:!0},centered:{type:Boolean},cancelText:{type:String,default:te("common.cancelText")},okText:{type:String,default:te("common.okText")},closeFunc:Function},J=Object.assign({},Ee,{defaultFullscreen:{type:Boolean},canFullscreen:{type:Boolean,default:!0},wrapperFooterOffset:{type:Number,default:0},helpMessage:[String,Array],useWrapper:{type:Boolean,default:!0},loading:{type:Boolean},loadingTip:{type:String},showCancelBtn:{type:Boolean,default:!0},showOkBtn:{type:Boolean,default:!0},wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:{type:Boolean},destroyOnClose:{type:Boolean},footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},visible:{type:Boolean},width:{type:[String,Number],default:"40%"},wrapClassName:{type:String},zIndex:{type:Number}});function Ie(a){const l=(t,i)=>getComputedStyle(t)[i],r=t=>{if(!t)return;t.setAttribute("data-drag",o(a.draggable));const i=t.querySelector(".ant-modal-header"),e=t.querySelector(".ant-modal");!i||!e||!o(a.draggable)||(i.style.cursor="move",i.onmousedown=c=>{if(!c)return;const u=c.clientX,f=c.clientY,B=document.body.clientWidth,y=document.documentElement.clientHeight,d=e.offsetWidth,v=e.offsetHeight,p=e.offsetLeft,h=B-e.offsetLeft-d,S=e.offsetTop,k=y-e.offsetTop-v,b=l(e,"left"),D=l(e,"top");let $=+b,R=+D;b.includes("%")?($=+document.body.clientWidth*(+b.replace(/%/g,"")/100),R=+document.body.clientHeight*(+D.replace(/%/g,"")/100)):($=+b.replace(/px/g,""),R=+D.replace(/px/g,"")),document.onmousemove=function(x){let F=x.clientX-u,n=x.clientY-f;-F>p?F=-p:F>h&&(F=h),-n>S?n=-S:n>k&&(n=k),e.style.cssText+=`;left:${F+$}px;top:${n+R}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})},s=()=>{const t=document.querySelectorAll(".ant-modal-wrap");for(const i of Array.from(t)){if(!i)continue;const e=l(i,"display"),c=i.getAttribute("data-drag");e!=="none"&&(c===null||o(a.destroyOnClose))&&r(i)}};L(()=>{!o(a.visible)||!o(a.draggable)||ue(()=>{s()},30)})}function Le(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!me(a)}const Ae=_({name:"Modal",inheritAttrs:!1,props:J,emits:["cancel"],setup(a,{slots:l,emit:r}){const{visible:s,draggable:t,destroyOnClose:i}=de(a),e=fe();Ie({visible:s,destroyOnClose:i,draggable:t});const c=u=>{r("cancel",u)};return()=>{let u;const f={...o(e),...a,onCancel:c};return C(ge,f,Le(u=pe(l))?u:{default:()=>[u]})}}}),ce=Symbol();function ze(a){return ye(a,ce)}function et(){return he(ce)}const Ve=["loading-tip"],qe=_({name:"ModalWrapper",inheritAttrs:!1,__name:"ModalWrapper",props:{loading:{type:Boolean},useWrapper:{type:Boolean,default:!0},modalHeaderHeight:{type:Number,default:57},modalFooterHeight:{type:Number,default:74},minHeight:{type:Number,default:200},height:{type:Number},footerOffset:{type:Number,default:0},visible:{type:Boolean},fullScreen:{type:Boolean},loadingTip:{type:String}},emits:["height-change","ext-height"],setup(a,{expose:l,emit:r}){const s=a,t=m(null),i=m(null),e=m(0),c=m(0);let u=0;We(y.bind(null,!1)),ve(i,()=>{y()},{attributes:!0,subtree:!0}),ze({redoModalHeight:y});const f=H(()=>({minHeight:`${s.minHeight}px`,[s.fullScreen?"height":"maxHeight"]:`${o(e)}px`}));L(()=>{s.useWrapper&&y()}),ne(()=>s.fullScreen,d=>{y(),d?c.value=e.value:e.value=c.value}),be(()=>{const{modalHeaderHeight:d,modalFooterHeight:v}=s;r("ext-height",d+v)}),ae(()=>{});async function B(){w(()=>{const d=o(t);d&&d?.scrollTo?.(0)})}async function y(){if(!s.visible)return;const d=o(t);if(!d)return;const v=d.$el.parentElement;if(v){v.style.padding="0",await w();try{const p=v.parentElement&&v.parentElement.parentElement;if(!p)return;const h=getComputedStyle(p).top,S=Number.parseInt(h);let k=window.innerHeight-S*2+(s.footerOffset||0)-s.modalFooterHeight-s.modalHeaderHeight;S<40&&(k-=26),await w();const b=o(i);if(!b)return;await w(),u=b.scrollHeight,s.fullScreen?e.value=window.innerHeight-s.modalFooterHeight-s.modalHeaderHeight-28:e.value=s.height?s.height:u>k?k:u,r("height-change",o(e))}catch{}}}return l({scrollTop:B}),(d,v)=>{const p=Me("loading");return M(),O(o(Se),{ref_key:"wrapperRef",ref:t},{default:g(()=>[Ce((M(),I("div",{ref_key:"spinRef",ref:i,style:He(f.value),"loading-tip":a.loadingTip},[T(d.$slots,"default")],12,Ve)),[[p,a.loading]])]),_:3},512)}}}),Ye=_({name:"ModalClose",__name:"ModalClose",props:{canFullscreen:{type:Boolean,default:!0},fullScreen:{type:Boolean}},emits:["cancel","fullscreen"],setup(a,{emit:l}){const r=a,{t:s}=oe(),{prefixCls:t}=le("basic-modal-close"),i=H(()=>[t,`${t}--custom`,{[`${t}--can-full`]:r.canFullscreen}]);function e(u){l("cancel",u)}function c(u){u?.stopPropagation(),u?.preventDefault(),l("fullscreen")}return(u,f)=>(M(),I("div",{class:Fe(i.value)},[a.canFullscreen?(M(),I(ke,{key:0},[a.fullScreen?(M(),O(o(z),{key:0,title:o(s)("component.modal.restore"),placement:"bottom"},{default:g(()=>[C(o(xe),{role:"full",onClick:c})]),_:1},8,["title"])):(M(),O(o(z),{key:1,title:o(s)("component.modal.maximize"),placement:"bottom"},{default:g(()=>[C(o(je),{role:"close",onClick:c})]),_:1},8,["title"]))],64)):V("",!0),C(o(z),{title:o(s)("component.modal.close"),placement:"bottom"},{default:g(()=>[C(o(Be),{onClick:e})]),_:1},8,["title"])],2))}});const Xe=_({name:"BasicModalFooter",__name:"ModalFooter",props:J,emits:["ok","cancel"],setup(a,{emit:l}){function r(t){l("ok",t)}function s(t){l("cancel",t)}return(t,i)=>{const e=we("a-button");return M(),I("div",null,[T(t.$slots,"insertFooter"),t.showCancelBtn?(M(),O(e,W({key:0},t.cancelButtonProps,{onClick:s}),{default:g(()=>[q(Y(t.cancelText),1)]),_:1},16)):V("",!0),T(t.$slots,"centerFooter"),t.showOkBtn?(M(),O(e,W({key:1,type:t.okType,onClick:r,loading:t.confirmLoading},t.okButtonProps),{default:g(()=>[q(Y(t.okText),1)]),_:1},16,["type","loading"])):V("",!0),T(t.$slots,"appendFooter")])}}}),Ue=_({name:"BasicModalHeader",__name:"ModalHeader",props:{helpMessage:{type:[String,Array]},title:{type:String}},setup(a){return(l,r)=>(M(),O(o(Te),{helpMessage:a.helpMessage},{default:g(()=>[q(Y(a.title),1)]),_:1},8,["helpMessage"]))}});function Je(a){const l=m(!1),r=H(()=>{const t=o(a.wrapClassName)||"";return o(l)?`fullscreen-modal ${t} `:o(t)});function s(t){t&&t.stopPropagation(),l.value=!o(l)}return{getWrapClassName:r,handleFullScreen:s,fullScreenRef:l}}const Qe=_({name:"BasicModal",inheritAttrs:!1,__name:"BasicModal",props:J,emits:["visible-change","height-change","cancel","ok","register","update:visible"],setup(a,{emit:l}){const r=a,s=Oe(),t=m(!1),i=m(null),e=m(null),{prefixCls:c}=le("basic-modal"),u=m(0),f={setModalProps:D,emitVisible:void 0,redoModalHeight:()=>{w(()=>{o(e)&&o(e).setModalHeight()})}},B=U();B&&l("register",f,B.uid);const y=H(()=>({...r,...o(i)})),{handleFullScreen:d,getWrapClassName:v,fullScreenRef:p}=Je({modalWrapperRef:e,extHeightRef:u,wrapClassName:Pe(y.value,"wrapClassName")}),h=H(()=>({...{...o(y),visible:o(t),okButtonProps:void 0,cancelButtonProps:void 0,title:void 0},wrapClassName:o(v)})),S=H(()=>{const n={...s,...o(y),visible:o(t)};return n.wrapClassName=`${n?.wrapClassName||""} ${o(v)}`,o(p)?j(n,["height","title"]):j(n,"title")}),k=H(()=>{if(!o(p))return o(h).height});L(()=>{t.value=!!r.visible,p.value=!!r.defaultFullscreen}),ne(()=>o(t),n=>{l("visible-change",n),l("update:visible",n),w(()=>{r.scrollTop&&n&&o(e)&&o(e).scrollTop()})},{immediate:!1});async function b(n){if(n?.stopPropagation(),!n.target?.classList?.contains(c+"-close--custom")){if(r.closeFunc&&se(r.closeFunc)){const Q=await r.closeFunc();t.value=!Q;return}t.value=!1,l("cancel",n)}}function D(n){i.value=_e(o(i)||{},n),Reflect.has(n,"visible")&&(t.value=!!n.visible),Reflect.has(n,"defaultFullscreen")&&(p.value=!!n.defaultFullscreen)}function $(n){l("ok",n)}function R(n){l("height-change",n)}function x(n){u.value=n}function F(n){r.canFullscreen&&(n.stopPropagation(),d(n))}return(n,Q)=>(M(),O(o(Ae),W(S.value,{onCancel:b}),Z({default:g(()=>[C(qe,W({useWrapper:h.value.useWrapper,footerOffset:n.wrapperFooterOffset,fullScreen:o(p),ref_key:"modalWrapperRef",ref:e,loading:h.value.loading,"loading-tip":h.value.loadingTip,minHeight:h.value.minHeight,height:k.value,visible:t.value,modalFooterHeight:n.footer!==void 0&&!n.footer?0:void 0},o(j)(h.value.wrapperProps,"visible","height","modalFooterHeight"),{onExtHeight:x,onHeightChange:R}),{default:g(()=>[T(n.$slots,"default")]),_:3},16,["useWrapper","footerOffset","fullScreen","loading","loading-tip","minHeight","height","visible","modalFooterHeight"])]),_:2},[n.$slots.closeIcon?void 0:{name:"closeIcon",fn:g(()=>[C(Ye,{canFullscreen:h.value.canFullscreen,fullScreen:o(p),onCancel:b,onFullscreen:o(d)},null,8,["canFullscreen","fullScreen","onFullscreen"])]),key:"0"},n.$slots.title?void 0:{name:"title",fn:g(()=>[C(Ue,{helpMessage:h.value.helpMessage,title:y.value.title,onDblclick:F},null,8,["helpMessage","title"])]),key:"1"},n.$slots.footer?void 0:{name:"footer",fn:g(()=>[C(Xe,W(S.value,{onOk:$,onCancel:b}),Z({_:2},[G(Object.keys(n.$slots),N=>({name:N,fn:g(A=>[T(n.$slots,N,K(ee(A||{})))])}))]),1040)]),key:"2"},G(Object.keys(o(j)(n.$slots,"default")),N=>({name:N,fn:g(A=>[T(n.$slots,N,K(ee(A||{})))])}))]),1040))}}),P=re({}),X=re({});function tt(){const a=m(null),l=m(!1),r=m("");function s(e,c){if(!U())throw new Error("useModal() can only be used inside setup() or functional components!");r.value=c,ae(()=>{a.value=null,l.value=!1,P[o(r)]=null}),!(o(l)&&$e()&&e===o(a))&&(a.value=e,l.value=!0,e.emitVisible=(u,f)=>{X[f]=u})}const t=()=>{const e=o(a);return e||ie("useModal instance is undefined!"),e},i={setModalProps:e=>{t()?.setModalProps(e)},getVisible:H(()=>X[~~o(r)]),redoModalHeight:()=>{t()?.redoModalHeight?.()},openModal:(e=!0,c,u=!0)=>{if(t()?.setModalProps({visible:e}),!c)return;const f=o(r);if(u){P[f]=null,P[f]=E(c);return}De(E(P[f]),E(c))||(P[f]=E(c))},closeModal:()=>{t()?.setModalProps({visible:!1})}};return[s,i]}const ot=a=>{const l=m(null),r=U(),s=m(""),t=()=>{const e=o(l);return e||ie("useModalInner instance is undefined!"),e},i=(e,c)=>{Re(()=>{l.value=null}),s.value=c,l.value=e,r?.emit("register",e,c)};return L(()=>{const e=P[o(s)];e&&(!a||!se(a)||w(()=>{a(e)}))}),[i,{changeLoading:(e=!0)=>{t()?.setModalProps({loading:e})},getVisible:H(()=>X[~~o(s)]),changeOkLoading:(e=!0)=>{t()?.setModalProps({confirmLoading:e})},closeModal:()=>{t()?.setModalProps({visible:!1})},setModalProps:e=>{t()?.setModalProps(e)},redoModalHeight:()=>{const e=t()?.redoModalHeight;e&&e()}}]},nt=Ne(Qe);export{nt as B,ot as a,et as b,tt as u};
