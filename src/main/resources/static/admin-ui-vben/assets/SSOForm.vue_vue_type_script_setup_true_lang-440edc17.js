import{a as E,c as M,y as N,b as V,z as C,B as g,C as A,o as x,h as F,i as O,t as f,k as o,n as i,w as a,v as p,F as S,r as U,j as q,N as h,bu as K,x as j}from"./index-8b526734.js";import{C as L}from"./index-d2d20fb4.js";import{F as z}from"./index-03ea37ad.js";import"./index-3e87b811.js";import{b as G}from"./useLogin-ae32d63a.js";import{b as H,d as J}from"./login-80d7827e.js";import{R as P}from"./index-9e517d44.js";import{C as Q}from"./index-42686290.js";const W={class:"mb-3 text-2xl font-bold text-center xl:text-3xl enter-x xl:text-left"},ae=E({__name:"SSOForm",setup(X){const k=z.Item,{t:n}=M(),{query:c}=N(),{notification:I,createErrorModal:T}=j(),{prefixCls:B}=V("login"),_=C(),d=C(!1),m=g({scopes:[]}),s=g({responseType:void 0,clientId:void 0,redirectUri:void 0,state:void 0,scopes:[]});let v=g({name:"",logo:""});const{validForm:D}=G(_);async function R(){if(s.responseType=c.response_type,s.clientId=c.client_id,s.redirectUri=c.redirect_uri,s.state=c.state,c.scope&&(s.scopes=c.scope.split(" ")),s.scopes.length>0){const l=await w(!0,s.scopes,[]);if(!l)return;location.href=l}const r=await H(s.clientId);v=r.client;let t;if(s.scopes.length>0){t=[];for(const e of r.scopes)s.scopes.indexOf(e.key)>=0&&t.push(e)}else{t=r.data.scopes;for(const e of t)s.scopes.push(e.key)}for(const e of t)e.value&&m.scopes.push(e.key)}async function y(r){if(await D())try{d.value=!0;let e,l;r?(e=m.scopes,l=s.scopes.filter(u=>e.indexOf(u)===-1)):(e=[],l=s.scopes);const b=await w(!1,e,l);if(b){const u=b;if(!u)return;location.href=u,I.success({message:n("sys.login.loginSuccessTitle"),description:`${n("sys.login.loginSuccessDesc")}`,duration:3})}}catch(e){T({title:n("sys.api.errorTip"),content:e.message||n("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${B}`)||document.body})}finally{d.value=!1}}async function w(r,t,e){return await J(s.responseType,s.clientId,s.redirectUri,s.state,r,t,e)}function $(r){switch(r){case"user.read":return n("sys.login.ssoInfoDesc");case"user.write":return n("sys.login.ssoEditDesc");default:return r}}return A(()=>{R()}),(r,t)=>(x(),F(S,null,[O("h2",W,f(o(v).name+o(n)("sys.login.ssoSignInFormTitle")),1),i(o(z),{class:"p-4 enter-x",model:m,ref_key:"formRef",ref:_,onKeypress:t[2]||(t[2]=K(e=>y(!0),["enter"]))},{default:a(()=>[p(" 此第三方应用请求获取以下权限： "),i(o(P),{class:"enter-x"},{default:a(()=>[i(o(Q),{span:12},{default:a(()=>[(x(!0),F(S,null,U(s.scopes,e=>(x(),q(o(k),{key:e},{default:a(()=>[i(o(L),{checked:e,size:"small"},{default:a(()=>[i(o(h),{type:"link",size:"small"},{default:a(()=>[p(f($(e)),1)]),_:2},1024)]),_:2},1032,["checked"])]),_:2},1024))),128))]),_:1})]),_:1}),i(o(k),{class:"enter-x"},{default:a(()=>[i(o(h),{type:"primary",size:"large",block:"",onClick:t[0]||(t[0]=e=>y(!0)),loading:d.value},{default:a(()=>[p(f(o(n)("sys.login.loginButton")),1)]),_:1},8,["loading"]),i(o(h),{size:"large",class:"mt-4 enter-x",block:"",onClick:t[1]||(t[1]=e=>y(!1))},{default:a(()=>[p(f(o(n)("common.cancelText")),1)]),_:1})]),_:1})]),_:1},8,["model"])],64))}});export{ae as _};
