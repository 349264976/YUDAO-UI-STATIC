import"./base-085523fd.js";import{a as e,E as t}from"./el-form-item-8022b942.js";import{E as a}from"./el-row-ad412a39.js";import{E as l}from"./el-col-613bea3c.js";import{E as o}from"./el-card-d8ab0074.js";import{E as s}from"./el-tree-39cab679.js";import"./el-checkbox-cd7dd8c1.js";import"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{_ as i}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as r}from"./Descriptions-8db90f03.js";import{_ as m}from"./Form-a0e23abc.js";import{_ as n}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as p}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as d}from"./XTextButton-ab77381a.js";import{_ as c}from"./XButton-39866472.js";import{d as u,h as _}from"./tree-150ed6f6.js";import{c as f}from"./constants-97c4dd5f.js";import{D as j,g as v}from"./dict-3e42505d.js";import{u as y}from"./useI18n-56d4bc42.js";import{r as k}from"./formRules-a3380b28.js";import{u as h}from"./useVxeCrudSchemas-8bec068b.js";import{A as g,d as b,r as x,x as S,Q as C,o as w,i as T,l as E,w as I,f as D,b as V,a as M,h as P,M as R,k as O,t as A,F,z as U}from"./runtime-core.esm-bundler-ccc21fcd.js";import{g as X,d as L,a as B,c as K,u as Y}from"./index-fdb16af2.js";import{l as q}from"./index-279b6f7b.js";import{l as z}from"./index-e4f7737c.js";import{l as W,a as N,b as Q}from"./index-909d9da6.js";import{u as H}from"./useMessage-5e709b20.js";import{u as J}from"./useXTable-bf420a68.js";import{E as Z}from"./index-795de047.js";import{a as $,E as G}from"./index-168f367d.js";import{_ as ee}from"./_plugin-vue_export-helper-1b428a4d.js";import"./index-c2caee16.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./aria-8fadfbe9.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./is-a7957d81.js";import"./index-183fdc84.js";import"./el-button-6b012e5e.js";import"./isEqual-6e1d5dd6.js";import"./_flatRest-ac7abae6.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";import"./propTypes-5cfdbdab.js";import"./index-be3181b1.js";import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";import"./el-tooltip-4ed993c7.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./dayjs.min-65a6b1e4.js";import"./useCache-d48cf6c5.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./index-7486e100.js";import"./Form.vue_vue_type_style_index_0_scoped_f983cb9f_lang-54d674bd.js";import"./el-radio-group-d1c0e064.js";import"./el-input-number-4fe7018b.js";import"./el-tree-select-6f481715.js";import"./el-switch-4b318cc1.js";/* empty css                   */import"./InputPassword-d0077663.js";import"./auth-2fa258a0.js";import"./el-image-viewer-f62c5b85.js";import"./debounce-eb6bb100.js";import"./el-progress-64245232.js";import"./strings-777507ad.js";import"./index-9d88d8a4.js";import"./isArrayLikeObject-26c677c4.js";import"./index-653de86a.js";/* empty css                        *//* empty css                                                                   *//* empty css                    */import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-a7ef0ded.js";import"./vue-router-0864a153.js";import"./index-6f87c872.js";const{t:te}=y(),ae=g({name:[k],code:[k],sort:[k]}),le=g({action:!0,actionWidth:"400px",columns:[{title:"角色编号",field:"id",table:{width:200}},{title:"角色名称",field:"name",isSearch:!0},{title:"角色类型",field:"type",dictType:j.SYSTEM_ROLE_TYPE,dictClass:"number",isForm:!1},{title:"角色标识",field:"code",isSearch:!0},{title:"显示顺序",field:"sort"},{title:te("form.remark"),field:"remark",isTable:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:te("common.status"),field:"status",dictType:j.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:te("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:oe}=h(le),se=b({name:"Role"}),ie=ee(b({...se,setup(k){const{t:h}=y(),b=H(),[ee,{reload:te,deleteData:le}]=J({allSchemas:oe,getListApi:X,deleteApi:L}),se=x(!1),ie=x(""),re=x(!1),me=x("edit"),ne=x(),pe=x(),de=e=>{me.value=h("action."+e),ie.value=e,re.value=!0},ce=g({id:0,name:"",code:"",dataScope:0,checkList:[]}),ue=x([]),_e=x(),fe=x(!1),je=x("数据权限"),ve=x(""),ye=x(),ke=x(!1),he=async(e,t)=>{var a;if(ce.id=t.id,ce.name=t.name,ce.code=t.code,ve.value=e,fe.value=!0,"menu"===e){const e=await q();ue.value=_(e);const a=await W(t.id);a&&(null==a||a.forEach((e=>{var t;null==(t=D(_e))||t.setChecked(e,!0,!1)})))}else if("data"===e){const e=await z();ue.value=_(e);const l=await B(t.id);ce.dataScope=l.dataScope,l.dataScopeDeptIds&&(null==(a=l.dataScopeDeptIds)||a.forEach((e=>{var t;null==(t=D(_e))||t.setChecked(e,!0,!1)})))}};return S((()=>{ye.value=v(j.SYSTEM_DATA_SCOPE)})),(_,j)=>{const v=c,y=d,k=p,g=n,S=m,X=r,L=i,q=Z,z=e,W=$,H=G,J=s,ge=o,be=l,xe=a,Se=t,Ce=C("hasPermi");return w(),T(F,null,[E(g,null,{default:I((()=>[E(k,{onRegister:D(ee)},{toolbar_buttons:I((()=>[V(E(v,{type:"primary",preIcon:"ep:zoom-in",title:D(h)("action.add"),onClick:j[0]||(j[0]=e=>{de("create")})},null,8,["title"]),[[Ce,["system:role:create"]]])])),actionbtns_default:I((({row:e})=>[V(E(y,{preIcon:"ep:edit",title:D(h)("action.edit"),onClick:t=>(async e=>{var t;de("update");const a=await B(e);null==(t=D(ne))||t.setValues(a)})(e.id)},null,8,["title","onClick"]),[[Ce,["system:role:update"]]]),V(E(y,{preIcon:"ep:view",title:D(h)("action.detail"),onClick:t=>(async e=>{de("detail");const t=await B(e);pe.value=t})(e.id)},null,8,["title","onClick"]),[[Ce,["system:role:query"]]]),V(E(y,{preIcon:"ep:basketball",title:"菜单权限",onClick:t=>he("menu",e)},null,8,["onClick"]),[[Ce,["system:permission:assign-role-menu"]]]),V(E(y,{preIcon:"ep:coin",title:"数据权限",onClick:t=>he("data",e)},null,8,["onClick"]),[[Ce,["system:permission:assign-role-data-scope"]]]),V(E(y,{preIcon:"ep:delete",title:D(h)("action.del"),onClick:t=>D(le)(e.id)},null,8,["title","onClick"]),[[Ce,["system:role:delete"]]])])),_:1},8,["onRegister"])])),_:1}),E(L,{modelValue:D(re),"onUpdate:modelValue":j[3]||(j[3]=e=>R(re)?re.value=e:null),title:D(me)},{footer:I((()=>[["create","update"].includes(D(ie))?(w(),M(v,{key:0,type:"primary",title:D(h)("action.save"),loading:D(se),onClick:j[1]||(j[1]=e=>(async()=>{var e;const t=null==(e=D(ne))?void 0:e.getElFormRef();t&&t.validate((async e=>{var t;if(e){se.value=!0;try{const e=null==(t=D(ne))?void 0:t.formModel;"create"===ie.value?(await K(e),b.success(h("common.createSuccess"))):(await Y(e),b.success(h("common.updateSuccess"))),re.value=!1}finally{se.value=!1,await te()}}}))})())},null,8,["title","loading"])):P("",!0),E(v,{loading:D(se),title:D(h)("dialog.close"),onClick:j[2]||(j[2]=e=>re.value=!1)},null,8,["loading","title"])])),default:I((()=>[["create","update"].includes(D(ie))?(w(),M(S,{key:0,schema:D(oe).formSchema,rules:D(ae),ref_key:"formRef",ref:ne},null,8,["schema","rules"])):P("",!0),"detail"===D(ie)?(w(),M(X,{key:1,schema:D(oe).detailSchema,data:D(pe)},null,8,["schema","data"])):P("",!0)])),_:1},8,["modelValue","title"]),E(L,{modelValue:D(fe),"onUpdate:modelValue":j[7]||(j[7]=e=>R(fe)?fe.value=e:null),title:D(je)},{footer:I((()=>[E(v,{type:"primary",title:D(h)("action.save"),loading:D(se),onClick:j[5]||(j[5]=e=>(async()=>{if("data"===ve.value){const e=x({roleId:ce.id,dataScope:ce.dataScope,dataScopeDeptIds:ce.dataScope!==f.DEPT_CUSTOM?[]:_e.value.getCheckedKeys(!1)});await N(e.value)}else if("menu"===ve.value){const e=x({roleId:ce.id,menuIds:[..._e.value.getCheckedKeys(!1),..._e.value.getHalfCheckedKeys()]});await Q(e.value)}b.success(h("common.updateSuccess")),fe.value=!1})())},null,8,["title","loading"]),E(v,{loading:D(se),title:D(h)("dialog.close"),onClick:j[6]||(j[6]=e=>fe.value=!1)},null,8,["loading","title"])])),default:I((()=>[E(Se,{model:D(ce),"label-width":"140px",inline:!0},{default:I((()=>[E(z,{label:"角色名称"},{default:I((()=>[E(q,null,{default:I((()=>[O(A(D(ce).name),1)])),_:1})])),_:1}),E(z,{label:"角色标识"},{default:I((()=>[E(q,null,{default:I((()=>[O(A(D(ce).code),1)])),_:1})])),_:1}),"data"===D(ve)?(w(),M(z,{key:0,label:"权限范围"},{default:I((()=>[E(H,{modelValue:D(ce).dataScope,"onUpdate:modelValue":j[4]||(j[4]=e=>D(ce).dataScope=e)},{default:I((()=>[(w(!0),T(F,null,U(D(ye),(e=>(w(),M(W,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):P("",!0),E(xe,null,{default:I((()=>[E(be,{span:24},{default:I((()=>["menu"===D(ve)||D(ce).dataScope===D(f).DEPT_CUSTOM?(w(),M(z,{key:0,label:"权限范围",style:{display:"flex"}},{default:I((()=>[E(ge,{class:"card",shadow:"never"},{header:I((()=>[])),default:I((()=>[E(J,{ref_key:"treeRef",ref:_e,"node-key":"id","show-checkbox":"","check-strictly":!D(ke),props:D(u),data:D(ue),"empty-text":"加载中，请稍后"},null,8,["check-strictly","props","data"])])),_:1})])),_:1})):P("",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-cfd625da"]]);export{ie as default};
