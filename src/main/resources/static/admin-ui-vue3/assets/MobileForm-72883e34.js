import"./base-085523fd.js";import{a as e,E as o}from"./el-form-item-8022b942.js";import{_ as l}from"./XButton-39866472.js";import{E as a}from"./el-row-ad412a39.js";import{E as t}from"./el-notification-c7d5f4ea.js";import{E as i}from"./el-col-613bea3c.js";import{v as s}from"./runtime-dom.esm-bundler-daa7e741.js";import{u as r}from"./useIcon-f3ac1fe7.js";import{f as n,s as m}from"./auth-2fa258a0.js";import{a as p}from"./permission-28248990.js";import{e as d,d as u,f as c}from"./index-ffcbf524.js";import{u as g,_ as f,L as _,a as j}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-a0f67dd5.js";import{u as b}from"./useI18n-56d4bc42.js";import{u as h}from"./useMessage-5e709b20.js";import{u as x}from"./vue-router-0864a153.js";import{r as y}from"./formRules-a3380b28.js";import{d as v,r as w,c as F,A as N,m as k,b as I,f as C,o as S,a as V,w as E,l as L,h as M,i as R,t as B}from"./runtime-core.esm-bundler-ccc21fcd.js";import{_ as P}from"./_plugin-vue_export-helper-1b428a4d.js";import"./index-c2caee16.js";import"./aria-8fadfbe9.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./el-button-6b012e5e.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./propTypes-5cfdbdab.js";import"./is-a7957d81.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";/* empty css                  *//* empty css                                                                   *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                    *//* empty css                   */import"./useCache-d48cf6c5.js";import"./index-a7ef0ded.js";import"./el-message-7ddf9388.js";import"./_flatRest-ac7abae6.js";const U={key:1,class:"getMobileCode",style:{cursor:"pointer"}},q=P(v({__name:"MobileForm",setup(v){const{t:P}=b(),q=h(),D=p(),{currentRoute:T,push:z}=x(),A=w(),J=w(!1),K=r({icon:"ep:house"}),O=r({icon:"ep:cellphone"}),X=r({icon:"ep:circle-check"}),{validForm:Y}=j(A),{handleBackLogin:Z,getLoginState:$}=g(),G=F((()=>C($)===_.MOBILE)),H={tenantName:[y],mobileNumber:[y],code:[y]},Q=N({codeImg:"",tenantEnable:"true",token:"",loading:{signIn:!1},loginForm:{uuid:"",tenantName:"芋道源码",mobileNumber:"",code:""}}),W=N({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),ee=w(0),oe=w(""),le=async()=>{await ae(),W.smsCode.mobile=Q.loginForm.mobileNumber,await d(W.smsCode).then((async()=>{q.success(P("login.SmsSendMsg")),ee.value=60;let e=setInterval((()=>{ee.value=ee.value-1,ee.value<=0&&clearInterval(e)}),1e3)}))};k((()=>T.value),(e=>{var o;oe.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const ae=async()=>{if("true"===Q.tenantEnable){const e=await u(Q.loginForm.tenantName);n(e)}};return(r,n)=>{const p=e,d=i,u=t,g=a,_=l,j=o;return I((S(),V(j,{model:C(Q).loginForm,rules:H,"label-position":"top",class:"login-form","label-width":"120px",size:"large",ref_key:"formSmsLogin",ref:A},{default:E((()=>[L(g,{style:{"margin-left":"-10px","margin-right":"-10px"}},{default:E((()=>[L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>[L(p,null,{default:E((()=>[L(f,{style:{width:"100%"}})])),_:1})])),_:1}),L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>["true"===C(Q).tenantEnable?(S(),V(p,{key:0,prop:"tenantName"},{default:E((()=>[L(u,{type:"text",modelValue:C(Q).loginForm.tenantName,"onUpdate:modelValue":n[0]||(n[0]=e=>C(Q).loginForm.tenantName=e),placeholder:C(P)("login.tenantNamePlaceholder"),"prefix-icon":C(K)},null,8,["modelValue","placeholder","prefix-icon"])])),_:1})):M("",!0)])),_:1}),L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>[L(p,{prop:"mobileNumber"},{default:E((()=>[L(u,{modelValue:C(Q).loginForm.mobileNumber,"onUpdate:modelValue":n[1]||(n[1]=e=>C(Q).loginForm.mobileNumber=e),placeholder:C(P)("login.mobileNumberPlaceholder"),"prefix-icon":C(O)},null,8,["modelValue","placeholder","prefix-icon"])])),_:1})])),_:1}),L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>[L(p,{prop:"code"},{default:E((()=>[L(g,{justify:"space-between",style:{width:"100%"},gutter:5},{default:E((()=>[L(d,{span:24},{default:E((()=>[L(u,{modelValue:C(Q).loginForm.code,"onUpdate:modelValue":n[2]||(n[2]=e=>C(Q).loginForm.code=e),placeholder:C(P)("login.codePlaceholder"),"prefix-icon":C(X)},{append:E((()=>[C(ee)<=0?(S(),R("span",{key:0,onClick:le,class:"getMobileCode",style:{cursor:"pointer"}},B(C(P)("login.getSmsCode")),1)):M("",!0),C(ee)>0?(S(),R("span",U,B(C(ee))+"秒后可重新获取 ",1)):M("",!0)])),_:1},8,["modelValue","placeholder","prefix-icon"])])),_:1})])),_:1})])),_:1})])),_:1}),L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>[L(p,null,{default:E((()=>[L(_,{loading:C(J),type:"primary",class:"w-[100%]",title:C(P)("login.login"),onClick:n[3]||(n[3]=e=>(async()=>{await ae(),await Y()&&(J.value=!0,W.loginSms.mobile=Q.loginForm.mobileNumber,W.loginSms.code=Q.loginForm.code,await c(W.loginSms).then((async e=>{m(null==e?void 0:e.token),oe.value||(oe.value="/"),z({path:oe.value||D.addRouters[0].path})})).catch((()=>{})).finally((()=>{J.value=!1})))})())},null,8,["loading","title"])])),_:1})])),_:1}),L(d,{span:24,style:{"padding-left":"10px","padding-right":"10px"}},{default:E((()=>[L(p,null,{default:E((()=>[L(_,{loading:C(J),class:"w-[100%]",title:C(P)("login.backLogin"),onClick:n[4]||(n[4]=e=>C(Z)())},null,8,["loading","title"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])),[[s,C(G)]])}}}),[["__scopeId","data-v-fda27462"]]);export{q as default};
