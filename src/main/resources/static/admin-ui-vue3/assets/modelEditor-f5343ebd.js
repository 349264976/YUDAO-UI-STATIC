import{E as e,v as t,aq as n,y as a,ar as o,as as i,x as c,X as s,al as r}from"./index.esm-6344e9a3.js";import{g as p,u as l,c as m}from"./index-30c543aa.js";import{u as d}from"./vue-router-0864a153.js";import{u}from"./useMessage-5e709b20.js";import{d as b,r as v,x as h,C as g,o as f,i as y,f as E,a as x,v as _,M as k,h as C}from"./runtime-core.esm-bundler-ccc21fcd.js";import"./index-a7ef0ded.js";import"./base-085523fd.js";import"./el-message-7ddf9388.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-c2caee16.js";import"./aria-8fadfbe9.js";import"./is-a7957d81.js";import"./index-7a379d2e.js";import"./el-notification-c7d5f4ea.js";import"./el-button-6b012e5e.js";import"./index-4665dced.js";import"./focus-trap-f53979c5.js";import"./useI18n-56d4bc42.js";import"./useCache-d48cf6c5.js";import"./auth-2fa258a0.js";import"./cloneDeep-8298b498.js";import"./_flatRest-ac7abae6.js";function j(e){return e.originalEvent||e.srcEvent}function w(e){return function(e,t){return(j(e)||e).button===t}(e,0)}function D(e){var t=j(e)||e;return!!w(e)&&(/mac/i.test(navigator.platform)?t.metaKey:t.ctrlKey)}function T(e,t,n,a,o,i,c,s,r,p,l,m){e=e||{},a.registerProvider(this),this._contextPad=a,this._modeling=o,this._elementFactory=i,this._connect=c,this._create=s,this._popupMenu=r,this._canvas=p,this._rules=l,this._translate=m,!1!==e.autoPlace&&(this._autoPlace=t.get("autoPlace",!1)),n.on("create.end",250,(function(e){const t=e.context.shape;if(!D(e)||!a.isOpen(t))return;const n=a.getEntries(t);n.replace&&n.replace.action.click(e,t)}))}function P(e,t,n){const a=e.$instanceOf(t);let o=!1;const c=e.eventDefinitions||[];return i(c,(function(e){e.$type===n&&(o=!0)})),a&&o}T.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],T.prototype.getContextPadEntries=function(i){const r=this._contextPad,p=this._modeling,l=this._elementFactory,m=this._connect,d=this._create,u=this._popupMenu,b=this._canvas,v=this._rules,h=this._autoPlace,g=this._translate,f={};if("label"===i.type)return f;const y=i.businessObject;function E(e,t){m.start(e,t)}function x(e,t,a,o){function i(t,a){const i=l.createShape(n({type:e},o));d.start(t,i,{source:a})}"string"!=typeof a&&(o=a,a=g("Append {type}",{type:e.replace(/^bpmn:/,"")}));return{group:"model",className:t,title:a,action:{dragstart:i,click:h?function(t,a){const i=l.createShape(n({type:e},o));h.append(a,i)}:i}}}function _(e){return function(t,n){p.splitLane(n,e),r.open(n,!0)}}if(e(y,["bpmn:Lane","bpmn:Participant"])&&c(y)){const e=s(i);n(f,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:g("Add Lane above"),action:{click:function(e,t){p.addLane(t,"top")}}}}),e.length<2&&(i.height>=120&&n(f,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:g("Divide into two Lanes"),action:{click:_(2)}}}),i.height>=180&&n(f,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:g("Divide into three Lanes"),action:{click:_(3)}}})),n(f,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:g("Add Lane below"),action:{click:function(e,t){p.addLane(t,"bottom")}}}})}t(y,"bpmn:FlowNode")&&(t(y,"bpmn:EventBasedGateway")?n(f,{"append.receive-task":x("bpmn:ReceiveTask","bpmn-icon-receive-task",g("Append ReceiveTask")),"append.message-intermediate-event":x("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",g("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":x("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",g("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":x("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",g("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":x("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",g("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):P(y,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?n(f,{"append.compensation-activity":x("bpmn:Task","bpmn-icon-task",g("Append compensation activity"),{isForCompensation:!0})}):t(y,"bpmn:EndEvent")||y.isForCompensation||P(y,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||a(y)||n(f,{"append.end-event":x("bpmn:EndEvent","bpmn-icon-end-event-none",g("Append EndEvent")),"append.gateway":x("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",g("Append Gateway")),"append.append-task":x("bpmn:UserTask","bpmn-icon-user-task",g("Append Task")),"append.intermediate-event":x("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",g("Append Intermediate/Boundary Event"))})),u.isEmpty(i,"bpmn-replace")||n(f,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"修改类型",action:{click:function(e,t){const a=n(function(e){const t=b.getContainer(),n=r.getPad(e).html,a=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=o.top-a.top;return{x:o.left-a.left,y:i+o.height+5}}(t),{cursor:{x:e.x,y:e.y}});u.open(t,"bpmn-replace",a)}}}}),e(y,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&n(f,{"append.text-annotation":x("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:g("Connect using "+(y.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:E,dragstart:E}}}),e(y,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&n(f,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:g("Connect using DataInputAssociation"),action:{click:E,dragstart:E}}}),t(y,"bpmn:Group")&&n(f,{"append.text-annotation":x("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let k=v.allowed("elements.delete",{elements:[i]});return o(k)&&(k=k[0]===i),k&&n(f,{delete:{group:"edit",className:"bpmn-icon-trash",title:g("Remove"),action:{click:function(){p.removeElements([i])}}}}),f};const S={__init__:["contextPadProvider"],contextPadProvider:["type",T]};function A(e,t,n,a,o,i,c,s){r.call(this,e,t,n,a,o,i,c,s,2e3)}const N=function(){};(N.prototype=r.prototype).getPaletteEntries=function(){const e={},t=this._create,a=this._elementFactory,o=this._spaceTool,i=this._lassoTool,c=this._handTool,s=this._globalConnect,r=this._translate;function p(e,o,i,c,s){function p(o){const i=a.createShape(n({type:e},s));s&&(i.businessObject.di.isExpanded=s.isExpanded),t.start(o,i)}const l=e.replace(/^bpmn:/,"");return{group:o,className:i,title:c||r("Create {type}",{type:l}),action:{dragstart:p,click:p}}}function l(e){const n=a.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),o=a.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:n});t.start(e,[n,o],{hints:{autoSelect:[o]}})}function m(e){t.start(e,a.createParticipantShape())}return n(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"激活抓手工具",action:{click:function(e){c.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:r("Activate the lasso tool"),action:{click:function(e){i.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:r("Activate the create/remove space tool"),action:{click:function(e){o.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:r("Activate the global connect tool"),action:{click:function(e){s.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":p("bpmn:StartEvent","event","bpmn-icon-start-event-none",r("Create StartEvent")),"create.intermediate-event":p("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",r("Create Intermediate/Boundary Event")),"create.end-event":p("bpmn:EndEvent","event","bpmn-icon-end-event-none",r("Create EndEvent")),"create.exclusive-gateway":p("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",r("Create Gateway")),"create.user-task":p("bpmn:UserTask","activity","bpmn-icon-user-task",r("Create User Task")),"create.data-object":p("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",r("Create DataObjectReference")),"create.data-store":p("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",r("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:r("Create expanded SubProcess"),action:{dragstart:l,click:l}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:r("Create Pool/Participant"),action:{dragstart:m,click:m}},"create.group":p("bpmn:Group","artifact","bpmn-icon-group",r("Create Group"))}),e},A.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],A.prototype=new N,A.prototype.constructor=A;const I={__init__:["paletteProvider"],paletteProvider:["type",A]},R={class:"app-container"},M=b({__name:"modelEditor",setup(e){const t=d(),n=u(),a=v(void 0),o=v(null),i=v(0),c=v({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[S,I]}),s=v();h((()=>{const e=t.currentRoute.value.query&&t.currentRoute.value.query.modelId;e&&p(e).then((e=>{a.value=e.bpmnXml,s.value={...e,bpmnXml:void 0}}))}));const r=e=>{setTimeout((()=>{o.value=e}),10)},b=e=>{const t={...s.value??{},bpmnXml:e};t.id?l(t).then((e=>{n.success("修改成功"),j()})):m(t).then((e=>{n.success("保存成功"),j()}))},j=()=>{t.push({path:"/bpm/manager/model"})};return(e,t)=>{const n=g("my-process-designer"),p=g("my-properties-panel");return f(),y("div",R,[void 0!==E(a)?(f(),x(n,_({key:`designer-${E(i)}`,modelValue:E(a),"onUpdate:modelValue":t[0]||(t[0]=e=>k(a)?a.value=e:null),value:E(a)},E(c),{keyboard:"",ref:"processDesigner",onInitFinished:r,additionalModel:E(c).additionalModel,onSave:b}),null,16,["modelValue","value","additionalModel"])):C("",!0),(f(),x(p,{key:`penal-${E(i)}`,bpmnModeler:E(o),prefix:E(c).prefix,class:"process-panel",model:E(s)},null,8,["bpmnModeler","prefix","model"]))])}}});export{M as default};
