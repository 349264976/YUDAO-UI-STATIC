import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as t}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as l}from"./XButton-39866472.js";import"./base-085523fd.js";import{a as s,E as a}from"./el-form-item-8022b942.js";import{E as o}from"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-tree-39cab679.js";import"./el-checkbox-cd7dd8c1.js";import{E as i}from"./el-tree-select-6f481715.js";import{_ as r}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as p}from"./XTextButton-ab77381a.js";import{a as u}from"./index-a7ef0ded.js";import{l as d}from"./index-fdb16af2.js";import{l as n}from"./index-0886bcf2.js";import{g as m}from"./index-49b8d380.js";import{l as f}from"./index-b68262b6.js";import{l as c}from"./index-e4f7737c.js";import{D as y,a as _}from"./dict-3e42505d.js";import{h as v,d as j}from"./tree-150ed6f6.js";import{u as I}from"./useVxeCrudSchemas-8bec068b.js";import{A as g,d as b,r as h,x as k,Q as V,o as x,a as w,w as T,l as D,y as S,f as U,b as C,i as G,z as E,k as A,t as R,F as q,h as B,M as K}from"./runtime-core.esm-bundler-ccc21fcd.js";import{u as N}from"./useI18n-56d4bc42.js";import{u as P}from"./useMessage-5e709b20.js";import{b as M}from"./vue-router-0864a153.js";import{u as X}from"./useXTable-bf420a68.js";import{E as L}from"./index-795de047.js";import{a as Y,E as W}from"./index-168f367d.js";import"./el-card-d8ab0074.js";import"./el-tooltip-4ed993c7.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./propTypes-5cfdbdab.js";import"./index-7486e100.js";import"./aria-8fadfbe9.js";import"./focus-trap-f53979c5.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-4665dced.js";import"./index-7a379d2e.js";import"./index-be3181b1.js";import"./el-button-6b012e5e.js";import"./index-c2caee16.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./cloneDeep-8298b498.js";import"./is-a7957d81.js";import"./index-183fdc84.js";import"./isEqual-6e1d5dd6.js";import"./_flatRest-ac7abae6.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./useCache-d48cf6c5.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./auth-2fa258a0.js";import"./index-6f87c872.js";import"./strings-777507ad.js";import"./debounce-eb6bb100.js";import"./index-9d88d8a4.js";const z=async e=>await u.get({url:"/bpm/task-assign-rule/list",params:e}),F=g({type:[{required:!0,message:"规则类型不能为空",trigger:"change"}],roleIds:[{required:!0,message:"指定角色不能为空",trigger:"change"}],deptIds:[{required:!0,message:"指定部门不能为空",trigger:"change"}],postIds:[{required:!0,message:"指定岗位不能为空",trigger:"change"}],userIds:[{required:!0,message:"指定用户不能为空",trigger:"change"}],userGroupIds:[{required:!0,message:"指定用户组不能为空",trigger:"change"}],scripts:[{required:!0,message:"指定脚本不能为空",trigger:"change"}]}),O=g({primaryKey:"id",primaryType:null,action:!0,actionWidth:"200px",columns:[{title:"任务名",field:"taskDefinitionName"},{title:"任务标识",field:"taskDefinitionKey"},{title:"规则类型",field:"type",dictType:y.BPM_TASK_ASSIGN_RULE_TYPE,dictClass:"number"},{title:"规则范围",field:"options",table:{slots:{default:"options_default"}}}]}),{allSchemas:Q}=I(O),Z=b({name:"TaskAssignRule"}),$=b({...Z,setup(I){const{t:b}=N(),O=P(),{query:Z}=M(),$=h(),H=h(),J=h(),ee=h(),te=h(),le=h(),se=h(),ae=_(y.BPM_TASK_ASSIGN_SCRIPT),oe=Z.modelId,ie=Z.processDefinitionId;let re=(e=>!!e)(oe);const pe=g({modelId:oe,processDefinitionId:ie}),[ue,{reload:de}]=X({allSchemas:Q,params:pe,getListApi:z,isList:!0}),ne=(e,t)=>{if(10===e){for(const l of H.value)if(l.id===t)return l.name}else if(20===e||21===e){for(const l of J.value)if(l.id===t)return l.name}else if(22===e){for(const l of te.value)if(l.id===t)return l.name}else if(30===e||31===e||32===e){for(const l of le.value)if(l.id===t)return l.nickname}else if(40===e){for(const l of se.value)if(l.id===t)return l.name}else if(50===e){t+="";for(const e of ae)if(e.value===t)return e.label}return"未知("+t+")"},me=h(!1),fe=h(!1),ce=h(),ye=h(),_e=async()=>{const e=U(ce);if(!e)return;if(!(await e.validate()))return;let t={...ye.value,taskDefinitionName:void 0};10===t.type?t.options=t.roleIds:20===t.type||21===t.type?t.options=t.deptIds:22===t.type?t.options=t.postIds:30===t.type||31===t.type||32===t.type?t.options=t.userIds:40===t.type?t.options=t.userGroupIds:50===t.type&&(t.options=t.scripts),t.roleIds=void 0,t.deptIds=void 0,t.postIds=void 0,t.userIds=void 0,t.userGroupIds=void 0,t.scripts=void 0,me.value=!0;try{const e=t;e.id?(await(async e=>await u.put({url:"/bpm/task-assign-rule/update",data:e}))(e),O.success(b("common.updateSuccess"))):(await(async e=>await u.post({url:"/bpm/task-assign-rule/create",data:e}))(e),O.success(b("common.createSuccess"))),fe.value=!1}finally{me.value=!1,await de()}};return k((()=>{H.value=[],d().then((e=>{H.value.push(...e)})),J.value=[],ee.value=[],c().then((e=>{J.value.push(...e),ee.value.push(...v(e,"id"))})),te.value=[],n().then((e=>{te.value.push(...e)})),le.value=[],m().then((e=>{le.value.push(...e)})),se.value=[],f().then((e=>{se.value.push(...e)})),re||setTimeout((()=>{$.value.Ref.hideColumn("actionbtns")}),100)})),(u,d)=>{const n=L,m=p,f=r,c=o,v=s,I=Y,g=W,h=i,k=a,N=l,P=t,M=e,X=V("hasPermi");return x(),w(M,null,{default:T((()=>[D(f,{onRegister:U(ue),ref_key:"xGrid",ref:$},S({options_default:T((({row:e})=>[(x(!0),G(q,null,E(e.options,(t=>(x(),G("span",{key:t},[D(n,null,{default:T((()=>[A(R(ne(e.type,t)),1)])),_:2},1024),A("   ")])))),128))])),_:2},[U(oe)?{name:"actionbtns_default",fn:T((({row:e})=>[C(D(m,{preIcon:"ep:edit",title:U(b)("action.edit"),onClick:t=>(e=>{ye.value={},ye.value={...e,modelId:oe,options:[],roleIds:[],deptIds:[],postIds:[],userIds:[],userGroupIds:[],scripts:[]},10===e.type?ye.value.roleIds.push(...e.options):20===e.type||21===e.type?ye.value.deptIds.push(...e.options):22===e.type?ye.value.postIds.push(...e.options):30===e.type||31===e.type||32===e.type?ye.value.userIds.push(...e.options):40===e.type?ye.value.userGroupIds.push(...e.options):50===e.type&&ye.value.scripts.push(...e.options),fe.value=!0,me.value=!1})(e)},null,8,["title","onClick"]),[[X,["bpm:task-assign-rule:update"]]])])),key:"0"}:void 0]),1032,["onRegister"]),D(P,{modelValue:U(fe),"onUpdate:modelValue":d[10]||(d[10]=e=>K(fe)?fe.value=e:null),title:"修改任务规则",width:"800",height:"35%"},{footer:T((()=>[D(N,{type:"primary",title:U(b)("action.save"),loading:U(me),onClick:_e},null,8,["title","loading"]),D(N,{loading:U(me),title:U(b)("dialog.close"),onClick:d[9]||(d[9]=e=>fe.value=!1)},null,8,["loading","title"])])),default:T((()=>[D(k,{ref_key:"formRef",ref:ce,model:U(ye),rules:U(F),"label-width":"80px"},{default:T((()=>[D(v,{label:"任务名称",prop:"taskDefinitionName"},{default:T((()=>[D(c,{modelValue:U(ye).taskDefinitionName,"onUpdate:modelValue":d[0]||(d[0]=e=>U(ye).taskDefinitionName=e),placeholder:"请输入流标标识",disabled:""},null,8,["modelValue"])])),_:1}),D(v,{label:"任务标识",prop:"taskDefinitionKey"},{default:T((()=>[D(c,{modelValue:U(ye).taskDefinitionKey,"onUpdate:modelValue":d[1]||(d[1]=e=>U(ye).taskDefinitionKey=e),placeholder:"请输入任务标识",disabled:""},null,8,["modelValue"])])),_:1}),D(v,{label:"规则类型",prop:"type"},{default:T((()=>[D(g,{modelValue:U(ye).type,"onUpdate:modelValue":d[2]||(d[2]=e=>U(ye).type=e),clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(_)(U(y).BPM_TASK_ASSIGN_RULE_TYPE),(e=>(x(),w(I,{key:parseInt(e.value),label:e.label,value:parseInt(e.value)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),10===U(ye).type?(x(),w(v,{key:0,label:"指定角色",prop:"roleIds"},{default:T((()=>[D(g,{modelValue:U(ye).roleIds,"onUpdate:modelValue":d[3]||(d[3]=e=>U(ye).roleIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(H),(e=>(x(),w(I,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):B("",!0),20===U(ye).type||21===U(ye).type?(x(),w(v,{key:1,label:"指定部门",prop:"deptIds",span:"24"},{default:T((()=>[D(h,{ref:"treeRef",modelValue:U(ye).deptIds,"onUpdate:modelValue":d[4]||(d[4]=e=>U(ye).deptIds=e),"node-key":"id","show-checkbox":"",props:U(j),data:U(ee),"empty-text":"加载中，请稍后",multiple:""},null,8,["modelValue","props","data"])])),_:1})):B("",!0),22===U(ye).type?(x(),w(v,{key:2,label:"指定岗位",prop:"postIds",span:"24"},{default:T((()=>[D(g,{modelValue:U(ye).postIds,"onUpdate:modelValue":d[5]||(d[5]=e=>U(ye).postIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(te),(e=>(x(),w(I,{key:parseInt(e.id),label:e.name,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):B("",!0),30===U(ye).type||31===U(ye).type||32===U(ye).type?(x(),w(v,{key:3,label:"指定用户",prop:"userIds",span:"24"},{default:T((()=>[D(g,{modelValue:U(ye).userIds,"onUpdate:modelValue":d[6]||(d[6]=e=>U(ye).userIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(le),(e=>(x(),w(I,{key:parseInt(e.id),label:e.nickname,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):B("",!0),40===U(ye).type?(x(),w(v,{key:4,label:"指定用户组",prop:"userGroupIds"},{default:T((()=>[D(g,{modelValue:U(ye).userGroupIds,"onUpdate:modelValue":d[7]||(d[7]=e=>U(ye).userGroupIds=e),multiple:"",clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(se),(e=>(x(),w(I,{key:parseInt(e.id),label:e.name,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):B("",!0),50===U(ye).type?(x(),w(v,{key:5,label:"指定脚本",prop:"scripts"},{default:T((()=>[D(g,{modelValue:U(ye).scripts,"onUpdate:modelValue":d[8]||(d[8]=e=>U(ye).scripts=e),multiple:"",clearable:"",style:{width:"100%"}},{default:T((()=>[(x(!0),G(q,null,E(U(ae),(e=>(x(),w(I,{key:parseInt(e.value),label:e.label,value:parseInt(e.value)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):B("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}});export{$ as default};
