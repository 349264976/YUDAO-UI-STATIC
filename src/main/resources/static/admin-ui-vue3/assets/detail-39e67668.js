import{u as e,b as l,E as a,_ as t,w as s,a as o}from"./base-085523fd.js";/* empty css                   */import{_ as i}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as r}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{E as n}from"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{E as u}from"./el-card-d8ab0074.js";import{E as m}from"./el-col-613bea3c.js";import{_ as p}from"./XButton-39866472.js";import{a as d,E as c}from"./el-form-item-8022b942.js";import{d as f}from"./dayjs.min-65a6b1e4.js";import{g as v}from"./index-49b8d380.js";import{g as y}from"./index-6ed5f261.js";import{a as g}from"./index-6d220aa9.js";import{g as _,a as j,r as b,u as h}from"./index-ca569ce0.js";import{a as k}from"./index-a7ef0ded.js";import{b as x}from"./formCreate-a3356cdc.js";import{a as w}from"./user-76f18df3.js";import{b as T}from"./vue-router-0864a153.js";import{u as U}from"./useMessage-5e709b20.js";import{u as I}from"./useI18n-56d4bc42.js";import{d as C,p as V,B as D,j as M,o as E,i as Y,e as z,n as B,f as $,s as F,a as S,w as q,g as H,h as A,t as G,r as K,A as N,x as R,D as X,C as O,z as P,b as W,l as Z,k as J,F as L,v as Q,M as ee,G as le}from"./runtime-core.esm-bundler-ccc21fcd.js";import{i as ae}from"./index-c2caee16.js";import{E as te}from"./index-795de047.js";import{a as se,E as oe}from"./index-168f367d.js";import{v as ie}from"./directive-7e87637f.js";import"./el-tooltip-4ed993c7.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./propTypes-5cfdbdab.js";import"./index-7486e100.js";import"./aria-8fadfbe9.js";import"./focus-trap-f53979c5.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-4665dced.js";import"./index-7a379d2e.js";import"./index-be3181b1.js";import"./el-button-6b012e5e.js";import"./is-a7957d81.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./cloneDeep-8298b498.js";import"./useCache-d48cf6c5.js";import"./el-message-7ddf9388.js";import"./auth-2fa258a0.js";import"./_flatRest-ac7abae6.js";import"./index-ffcbf524.js";import"./strings-777507ad.js";import"./isEqual-6e1d5dd6.js";import"./debounce-eb6bb100.js";import"./index-9d88d8a4.js";const re=C({name:"ElTimeline",setup(l,{slots:a}){const t=e("timeline");return V("timeline",a),()=>D("ul",{class:[t.b()]},[M(a,"default")])}}),ne=l({timestamp:{type:String,default:""},hideTimestamp:{type:Boolean,default:!1},center:{type:Boolean,default:!1},placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:ae},hollow:{type:Boolean,default:!1}}),ue=C({name:"ElTimelineItem"});var me=t(C({...ue,props:ne,setup(l){const t=e("timeline-item");return(e,l)=>(E(),Y("li",{class:B([$(t).b(),{[$(t).e("center")]:e.center}])},[z("div",{class:B($(t).e("tail"))},null,2),e.$slots.dot?A("v-if",!0):(E(),Y("div",{key:0,class:B([$(t).e("node"),$(t).em("node",e.size||""),$(t).em("node",e.type||""),$(t).is("hollow",e.hollow)]),style:F({backgroundColor:e.color})},[e.icon?(E(),S($(a),{key:0,class:B($(t).e("icon"))},{default:q((()=>[(E(),S(H(e.icon)))])),_:1},8,["class"])):A("v-if",!0)],6)),e.$slots.dot?(E(),Y("div",{key:1,class:B($(t).e("dot"))},[M(e.$slots,"dot")],2)):A("v-if",!0),z("div",{class:B($(t).e("wrapper"))},[e.hideTimestamp||"top"!==e.placement?A("v-if",!0):(E(),Y("div",{key:0,class:B([$(t).e("timestamp"),$(t).is("top")])},G(e.timestamp),3)),z("div",{class:B($(t).e("content"))},[M(e.$slots,"default")],2),e.hideTimestamp||"bottom"!==e.placement?A("v-if",!0):(E(),Y("div",{key:1,class:B([$(t).e("timestamp"),$(t).is("bottom")])},G(e.timestamp),3))],2)],2))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/timeline/src/timeline-item.vue"]]);const pe=s(re,{TimelineItem:me}),de=o(me);function ce(e){const l=Math.floor(e/864e5),a=Math.floor(e/36e5-24*l),t=Math.floor(e/6e4-24*l*60-60*a),s=Math.floor(e/1e3-24*l*60*60-60*a*60-60*t);return l>0?l+"天"+a+"小时"+t+"分钟":a>0?a+"小时"+t+"分钟":t>0?t+"分钟":s>0?s+"秒":"0秒"}const fe={class:"el-icon-picture-outline"},ve={style:{"margin-left":"10%","margin-bottom":"20px","font-size":"14px"}},ye={class:"el-icon-document"},ge={key:1},_e=z("span",{class:"el-icon-picture-outline"},"审批记录",-1),je={class:"block"},be={style:{"font-weight":"700"}},he={key:0,style:{"font-weight":"normal","margin-right":"30px"}},ke={key:1,style:{"font-weight":"normal"}},xe={style:{color:"#8a909c","font-weight":"normal"}},we={key:2,style:{"margin-left":"30px","font-weight":"normal"}},Te={key:3,style:{color:"#8a909c","font-weight":"normal"}},Ue={key:4,style:{"margin-left":"30px","font-weight":"normal"}},Ie={key:5,style:{color:"#8a909c","font-weight":"normal"}},Ce={key:6},Ve=z("span",{class:"el-icon-picture-outline"},"流程图",-1),De=C({__name:"detail",setup(e){const{query:l}=T(),a=U(),{t:t}=I(),{proxy:s}=le(),o=l.id,C=K(!1),V=K({}),D=K([]),M=K([]),B=N({reason:[{required:!0,message:"审批建议不能为空",trigger:"blur"}]}),F=async(e,l)=>{const t=D.value.indexOf(e),o=s.$refs["form"+t][0],i=$(o);if(!i)return;if(!(await i.validate()))return;const r={id:e.id,reason:M.value[t].reason};l?(await j(r),a.success("审批通过成功")):(await b(r),a.success("审批不通过成功")),Ge()},H=K(),ae=w().getUser.id,re=K({rule:[],option:{},value:{}}),ne=K(!0),ue=K([]),me=e=>1===e.result?"el-icon-time":2===e.result?"el-icon-check":3===e.result?"el-icon-close":4===e.result?"el-icon-remove-outline":"",De=e=>1===e.result?"primary":2===e.result?"success":3===e.result?"danger":4===e.result?"info":"",Me=K(!1),Ee=K(!1),Ye=K({id:void 0,assigneeUserId:void 0}),ze=K({assigneeUserId:[{required:!0,message:"新审批人不能为空",trigger:"change"}]}),Be=K(),$e=K([]),Fe=async()=>{const e=$(Be);if(!e)return;if(await e.validate()){Ee.value=!0;try{await h(Ye.value),Me.value=!1,Ge()}finally{Ee.value=!1}}},Se=()=>{var e;Ye.value={id:void 0,assigneeUserId:void 0},null==(e=Be.value)||e.resetFields()},qe=K(null),He=K({prefix:"flowable"}),Ae=K([]);R((()=>{Ge(),v().then((e=>{$e.value.push(...e)}))}));const Ge=()=>{C.value=!0,y(o).then((e=>{if(!e)return void a.error("查询不到流程信息！");V.value=e;const l=e.processDefinition;10===l.formType&&(x(re,l.formConf,l.formFields,e.formVariables),X().then((()=>{var e,l,a;null==(e=H.value)||e.btn.show(!1),null==(l=H.value)||l.resetBtn.show(!1),null==(a=H.value)||a.btn.disabled(!0)}))),g(l.id).then((e=>{qe.value=e})),(async e=>await k.get({url:"/bpm/activity/list",params:e}))({processInstanceId:e.id}).then((e=>{Ae.value=e}))})).finally((()=>{C.value=!1})),ne.value=!0,D.value=[],M.value=[],_(o).then((e=>{ue.value=[],e.forEach((e=>{4!==e.result&&ue.value.push(e)})),ue.value.sort(((e,l)=>e.endTime&&l.endTime?l.endTime-e.endTime:e.endTime?1:l.endTime?-1:l.createTime-e.createTime)),ue.value.forEach((e=>{1===e.result&&e.assigneeUser&&e.assigneeUser.id===ae&&(D.value.push({...e}),M.value.push({reason:""}))}))})).finally((()=>{ne.value=!1}))};return(e,l)=>{const s=d,o=te,v=n,y=c,g=p,_=m,j=u,b=O("form-create"),h=O("router-link"),k=de,x=pe,w=O("my-process-viewer"),T=se,U=oe,I=r,K=i,N=ie;return E(),S(K,null,{default:q((()=>[(E(!0),Y(L,null,P($(D),((e,l)=>W((E(),S(j,{class:"box-card",key:l},{header:q((()=>[z("span",fe,"审批任务【"+G(e.name)+"】",1)])),default:q((()=>[Z(_,{span:16,offset:6},{default:q((()=>[Z(y,{ref_for:!0,ref:"form"+l,model:$(M)[l],rules:$(B),"label-width":"100px"},{default:q((()=>[$(V)&&$(V).name?(E(),S(s,{key:0,label:"流程名"},{default:q((()=>[J(G($(V).name),1)])),_:1})):A("",!0),$(V)&&$(V).startUser?(E(),S(s,{key:1,label:"流程发起人"},{default:q((()=>[J(G($(V).startUser.nickname)+" ",1),Z(o,{type:"info",size:"small"},{default:q((()=>[J(G($(V).startUser.deptName),1)])),_:1})])),_:1})):A("",!0),Z(s,{label:"审批建议",prop:"reason"},{default:q((()=>[Z(v,{type:"textarea",modelValue:$(M)[l].reason,"onUpdate:modelValue":e=>$(M)[l].reason=e,placeholder:"请输入审批建议"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["model","rules"]),z("div",ve,[Z(g,{"pre-icon":"ep:select",type:"success",title:"通过",onClick:l=>F(e,!0)},null,8,["onClick"]),Z(g,{"pre-icon":"ep:close",type:"danger",title:"不通过",onClick:l=>F(e,!1)},null,8,["onClick"]),Z(g,{"pre-icon":"ep:edit",type:"primary",title:"转办",onClick:l=>{return a=e,Se(),Ye.value.id=a.id,void(Me.value=!0);var a}},null,8,["onClick"]),Z(g,{"pre-icon":"ep:position",type:"primary",title:"委派",onClick:e=>(async e=>{a.error("暂不支持【委派】功能，可以使用【转派】替代！")})()},null,8,["onClick"]),Z(g,{"pre-icon":"ep:back",type:"warning",title:"委派",onClick:e=>(async e=>{a.error("暂不支持【退回】功能！")})()},null,8,["onClick"])])])),_:2},1024)])),_:2},1024)),[[N,$(C)]]))),128)),W((E(),S(j,{class:"box-card"},{header:q((()=>[z("span",ye,"申请信息【"+G($(V).name)+"】",1)])),default:q((()=>{var e,a,t,s;return[10===(null==(a=null==(e=$(V))?void 0:e.processDefinition)?void 0:a.formType)?(E(),S(_,{key:0,span:16,offset:6},{default:q((()=>[Z(b,{ref_key:"fApi",ref:H,rule:$(re).rule,option:$(re).option,modelValue:$(re).value,"onUpdate:modelValue":l[0]||(l[0]=e=>$(re).value=e)},null,8,["rule","option","modelValue"])])),_:1})):A("",!0),20===(null==(s=null==(t=$(V))?void 0:t.processDefinition)?void 0:s.formType)?(E(),Y("div",ge,[Z(h,{to:$(V).processDefinition.formCustomViewPath+"?id="+$(V).businessKey},{default:q((()=>[Z(g,{type:"primary",preIcon:"ep:view",title:"点击查看"})])),_:1},8,["to"])])):A("",!0)]})),_:1})),[[N,$(C)]]),W((E(),S(j,{class:"box-card"},{header:q((()=>[_e])),default:q((()=>[Z(_,{span:16,offset:4},{default:q((()=>[z("div",je,[Z(x,null,{default:q((()=>[(E(!0),Y(L,null,P($(ue),((e,l)=>(E(),S(k,{key:l,icon:me(e),type:De(e)},{default:q((()=>[z("p",be,"任务："+G(e.name),1),Z(j,{"body-style":{padding:"10px"}},{default:q((()=>[e.assigneeUser?(E(),Y("label",he,[J(" 审批人："+G(e.assigneeUser.nickname)+" ",1),Z(o,{type:"info",size:"small"},{default:q((()=>[J(G(e.assigneeUser.deptName),1)])),_:2},1024)])):A("",!0),e.createTime?(E(),Y("label",ke,"创建时间：")):A("",!0),z("label",xe,G($(f)(null==e?void 0:e.createTime).format("YYYY-MM-DD HH:mm:ss")),1),e.endTime?(E(),Y("label",we," 审批时间： ")):A("",!0),e.endTime?(E(),Y("label",Te,G($(f)(null==e?void 0:e.endTime).format("YYYY-MM-DD HH:mm:ss")),1)):A("",!0),e.durationInMillis?(E(),Y("label",Ue," 耗时： ")):A("",!0),e.durationInMillis?(E(),Y("label",Ie,G($(ce)(null==e?void 0:e.durationInMillis)),1)):A("",!0),e.reason?(E(),Y("p",Ce,[Z(o,{type:De(e)},{default:q((()=>[J(G(e.reason),1)])),_:2},1032,["type"])])):A("",!0)])),_:2},1024)])),_:2},1032,["icon","type"])))),128))])),_:1})])])),_:1})])),_:1})),[[N,$(ne)]]),W((E(),S(j,{class:"box-card"},{header:q((()=>[Ve])),default:q((()=>[Z(w,Q({key:"designer",modelValue:$(qe),"onUpdate:modelValue":l[1]||(l[1]=e=>ee(qe)?qe.value=e:null),value:$(qe)},$(He),{prefix:$(He).prefix,activityData:$(Ae),processInstanceData:$(V),taskData:$(ue)}),null,16,["modelValue","value","prefix","activityData","processInstanceData","taskData"])])),_:1})),[[N,$(C)]]),Z(I,{modelValue:$(Me),"onUpdate:modelValue":l[4]||(l[4]=e=>ee(Me)?Me.value=e:null),title:"转派审批人",width:"500"},{footer:q((()=>[Z(g,{type:"primary",title:$(t)("action.save"),loading:$(Ee),onClick:Fe},null,8,["title","loading"]),Z(g,{loading:$(Ee),title:$(t)("dialog.close"),onClick:l[3]||(l[3]=e=>Ee.value=!1)},null,8,["loading","title"])])),default:q((()=>[Z(y,{ref_key:"updateAssigneeFormRef",ref:Be,model:$(Ye),rules:$(ze),"label-width":"110px"},{default:q((()=>[Z(s,{label:"新审批人",prop:"assigneeUserId"},{default:q((()=>[Z(U,{modelValue:$(Ye).assigneeUserId,"onUpdate:modelValue":l[2]||(l[2]=e=>$(Ye).assigneeUserId=e),clearable:"",style:{width:"100%"}},{default:q((()=>[(E(!0),Y(L,null,P($($e),(e=>(E(),S(T,{key:parseInt(e.id),label:e.nickname,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1})}}});export{De as default};
