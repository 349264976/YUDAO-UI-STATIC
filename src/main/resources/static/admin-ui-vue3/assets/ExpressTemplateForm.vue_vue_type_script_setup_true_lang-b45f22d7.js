import{d as W,l as Y,r as f,f as Z,A as ee,o as w,q as U,w as t,i as a,a as o,j as h,B as ae,c as le,F as te,k as re,t as oe,x as de,dz as I,dA as E,ad as D,T as ue,D as ne,a6 as se,a5 as ie,J as ce,bE as me,H as pe,K as fe,_ as _e,I as he,L as ge,__tla as Ce}from"./index-0f589822.js";import{_ as Ve,__tla as ve}from"./Dialog.vue_vue_type_style_index_0_lang-2d188c85.js";import{E as be,__tla as xe}from"./el-tree-select-df2c08ac.js";import{a as ye,D as we,__tla as Pe}from"./dict-f9a1a53b.js";import{a as ke,c as Ue,u as Ie,__tla as Ee}from"./index-1853e07d.js";import{d as L}from"./tree-f9b1893a.js";import{g as Te,a as R,__tla as Fe}from"./index-87a58117.js";import{u as Me,__tla as Se}from"./useMessage-45ab706e.js";let A,qe=Promise.all([(()=>{try{return Ce}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return xe}catch{}})(),(()=>{try{return Pe}catch{}})(),(()=>{try{return Ee}catch{}})(),(()=>{try{return Fe}catch{}})(),(()=>{try{return Se}catch{}})()]).then(async()=>{A=W({__name:"ExpressTemplateForm",emits:["success"],setup(ze,{expose:H,emit:j}){const{t:P}=Y(),T=Me(),g=f(!1),F=f(""),C=f(!1),M=f(""),d=f({id:void 0,name:"",chargeMode:1,sort:0,templateCharge:[],templateFree:[]}),V=new Map,v=f({startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),J=Z({name:[{required:!0,message:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],chargeMode:[{required:!0,message:"\u914D\u9001\u8BA1\u8D39\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],sort:[{required:!0,message:"\u5206\u7C7B\u6392\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),y=f(),k=f([]);H({open:async(u,l)=>{g.value=!0,F.value=P("action."+u),M.value=u,G();try{if(l){C.value=!0,d.value=await ke(l),v.value=V.get(d.value.chargeMode);const c=[],r=[];d.value.templateCharge.forEach(n=>{for(let m=0;m<n.areaIds.length;m++)c.includes(n.areaIds[m])||c.push(n.areaIds[m]);n.startPrice=I(n.startPrice),n.extraPrice=I(n.extraPrice)}),d.value.templateFree.forEach(n=>{for(let m=0;m<n.areaIds.length;m++)c.includes(n.areaIds[m])||r.includes(n.areaIds[m])||r.push(n.areaIds[m]);n.freePrice=I(n.freePrice)});const s=c.concat(r);k.value=await Te(s.join(","))}}finally{C.value=!1}}});const B=async()=>{if(y&&await y.value.validate()){C.value=!0;try{const u=d.value;u.templateCharge.forEach(l=>{l.startPrice=E(l.startPrice),l.extraPrice=E(l.extraPrice)}),u.templateFree.forEach(l=>{l.freePrice=E(l.freePrice)}),M.value==="create"?(await Ue(u),T.success(P("common.createSuccess"))):(await Ie(u),T.success(P("common.updateSuccess"))),g.value=!1,j("success")}finally{C.value=!1}}},G=()=>{var u;d.value={id:void 0,name:"",chargeMode:1,templateCharge:[{areaIds:[1],startCount:2,startPrice:5,extraCount:5,extraPrice:10}],templateFree:[],sort:0},v.value=V.get(1),(u=y.value)==null||u.resetFields()},K=u=>{v.value=V.get(u)},S=[{id:1,name:"\u5168\u56FD",disabled:!1}],O=async(u,l)=>{const c=[];if(d.value.templateCharge.forEach(r=>{r.areaIds.length>0&&r.areaIds.forEach(s=>c.push(s))}),u.isLeaf)return l([]);if(u.data.length===0){const r=D(S),s=r[0];c.includes(s.id),l(r)}else{const r=u.data.id,s=await R(r);s.forEach(n=>{c.includes(n.id)}),l(s)}},X=async(u,l)=>{if(u.isLeaf)return l([]);const c=[];if(d.value.templateFree.forEach(r=>{r.areaIds.length>0&&r.areaIds.forEach(s=>c.push(s))}),u.data.length===0){const r=D(S),s=r[0];c.includes(s.id),l(r)}else{const r=u.data.id,s=await R(r);s.forEach(n=>{c.includes(n.id)}),l(s)}};return ee(()=>{(async()=>(V.set(1,{startCountTitle:"\u9996\u4EF6",extraCountTitle:"\u7EED\u4EF6",freeCountTitle:"\u5305\u90AE\u4EF6\u6570"}),V.set(2,{startCountTitle:"\u9996\u4EF6\u91CD\u91CF(kg)",extraCountTitle:"\u7EED\u4EF6\u91CD\u91CF(kg)",freeCountTitle:"\u5305\u90AE\u91CD\u91CF(kg)"}),V.set(3,{startCountTitle:"\u9996\u4EF6\u4F53\u79EF(m\xB3)",extraCountTitle:"\u7EED\u4EF6\u4F53\u79EF(m\xB3)",freeCountTitle:"\u5305\u90AE\u4F53\u79EF(m\xB3)"})))()}),(u,l)=>{const c=ue,r=ne,s=se,n=ie,m=be,p=ce,_=me,b=pe,q=fe,z=_e,$=he,N=Ve,Q=ge;return w(),U(N,{title:o(F),modelValue:o(g),"onUpdate:modelValue":l[6]||(l[6]=e=>de(g)?g.value=e:null),width:"80%"},{footer:t(()=>[a(b,{onClick:B,type:"primary",disabled:o(C)},{default:t(()=>[h("\u786E \u5B9A")]),_:1},8,["disabled"]),a(b,{onClick:l[5]||(l[5]=e=>g.value=!1)},{default:t(()=>[h("\u53D6 \u6D88")]),_:1})]),default:t(()=>[ae((w(),U($,{ref_key:"formRef",ref:y,model:o(d),rules:o(J),"label-width":"80px"},{default:t(()=>[a(r,{label:"\u6A21\u677F\u540D\u79F0",prop:"name"},{default:t(()=>[a(c,{modelValue:o(d).name,"onUpdate:modelValue":l[0]||(l[0]=e=>o(d).name=e),placeholder:"\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(r,{label:"\u8BA1\u8D39\u65B9\u5F0F",prop:"chargeMode"},{default:t(()=>[a(n,{modelValue:o(d).chargeMode,"onUpdate:modelValue":l[1]||(l[1]=e=>o(d).chargeMode=e),onChange:K},{default:t(()=>[(w(!0),le(te,null,re(o(ye)(o(we).EXPRESS_CHARGE_MODE),e=>(w(),U(s,{key:e.value,label:e.value},{default:t(()=>[h(oe(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"\u8FD0\u8D39",prop:"templateCharge"},{default:t(()=>[a(q,{border:"",style:{width:"100%"},data:o(d).templateCharge},{default:t(()=>[a(p,{align:"center",label:"\u533A\u57DF",width:"180"},{default:t(({row:e})=>[a(m,{modelValue:e.areaIds,"onUpdate:modelValue":i=>e.areaIds=i,lazy:"",load:O,props:o(L),multiple:"","node-key":"id","check-strictly":"","show-checkbox":"","check-on-click-node":"","render-after-expand":!1,"cache-data":o(k)},null,8,["modelValue","onUpdate:modelValue","props","cache-data"])]),_:1}),a(p,{align:"center",label:o(v).startCountTitle,width:"180",prop:"startCount"},{default:t(({row:e})=>[a(_,{modelValue:e.startCount,"onUpdate:modelValue":i=>e.startCount=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(p,{width:"180",align:"center",label:"\u8FD0\u8D39(\u5143)",prop:"startPrice"},{default:t(({row:e})=>[a(_,{modelValue:e.startPrice,"onUpdate:modelValue":i=>e.startPrice=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{width:"180",align:"center",label:o(v).extraCountTitle,prop:"extraCount"},{default:t(({row:e})=>[a(_,{modelValue:e.extraCount,"onUpdate:modelValue":i=>e.extraCount=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(p,{width:"180",align:"center",label:"\u7EED\u8D39(\u5143)",prop:"extraPrice"},{default:t(({row:e})=>[a(_,{modelValue:e.extraPrice,"onUpdate:modelValue":i=>e.extraPrice=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{label:"\u64CD\u4F5C",align:"center"},{default:t(e=>[a(b,{link:"",type:"danger",onClick:i=>{return x=e.$index,void d.value.templateCharge.splice(x,1);var x}},{default:t(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(r,null,{default:t(()=>[a(b,{type:"primary",plain:"",onClick:l[2]||(l[2]=e=>{d.value.templateCharge.push({areaIds:[],startCount:1,startPrice:1,extraCount:1,extraPrice:1})})},{default:t(()=>[a(z,{icon:"ep:plus",class:"mr-5px"}),h(" \u6DFB\u52A0\u533A\u57DF ")]),_:1})]),_:1}),a(r,{label:"\u5305\u90AE\u533A\u57DF",prop:"templateFree"},{default:t(()=>[a(q,{border:"",style:{width:"100%"},data:o(d).templateFree},{default:t(()=>[a(p,{align:"center",label:"\u533A\u57DF"},{default:t(({row:e})=>[a(m,{modelValue:e.areaIds,"onUpdate:modelValue":i=>e.areaIds=i,multiple:"",lazy:"",load:X,props:o(L),"node-key":"id","check-strictly":"","show-checkbox":"","check-on-click-node":"","render-after-expand":!0,"cache-data":o(k)},null,8,["modelValue","onUpdate:modelValue","props","cache-data"])]),_:1}),a(p,{align:"center",label:o(v).freeCountTitle,prop:"freeCount"},{default:t(({row:e})=>[a(_,{modelValue:e.freeCount,"onUpdate:modelValue":i=>e.freeCount=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),a(p,{align:"center",label:"\u5305\u90AE\u91D1\u989D\uFF08\u5143\uFF09",prop:"freePrice"},{default:t(({row:e})=>[a(_,{modelValue:e.freePrice,"onUpdate:modelValue":i=>e.freePrice=i,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{label:"\u64CD\u4F5C",align:"center"},{default:t(e=>[a(b,{link:"",type:"danger",onClick:i=>{return x=e.$index,void d.value.templateFree.splice(x,1);var x}},{default:t(()=>[h(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),a(r,null,{default:t(()=>[a(b,{type:"primary",plain:"",onClick:l[3]||(l[3]=e=>{d.value.templateFree.push({areaIds:[],freeCount:1,freePrice:1})})},{default:t(()=>[a(z,{icon:"ep:plus",class:"mr-5px"}),h(" \u6DFB\u52A0\u533A\u57DF ")]),_:1})]),_:1}),a(r,{label:"\u6392\u5E8F",prop:"sort"},{default:t(()=>[a(_,{modelValue:o(d).sort,"onUpdate:modelValue":l[4]||(l[4]=e=>o(d).sort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[Q,o(C)]])]),_:1},8,["title","modelValue"])}}})});export{A as _,qe as __tla};
