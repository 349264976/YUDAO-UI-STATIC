import{_ as e}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as t}from"./Form-a0e23abc.js";import"./base-085523fd.js";import"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-tree-39cab679.js";import"./el-checkbox-cd7dd8c1.js";import{E as r}from"./el-tree-select-6f481715.js";import{_ as a}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as s}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as l}from"./XTextButton-ab77381a.js";import{_ as i}from"./XButton-39866472.js";import{d as o,h as m}from"./tree-150ed6f6.js";import{u as p}from"./useI18n-56d4bc42.js";import{r as n}from"./formRules-a3380b28.js";import{D as d}from"./dict-3e42505d.js";import{u}from"./useVxeCrudSchemas-8bec068b.js";import{A as c,d as j,r as f,x as _,Q as v,o as y,i as g,l as b,w as x,f as h,b as w,e as k,t as I,a as C,h as T,F as U,z as V,M as S,D as F}from"./runtime-core.esm-bundler-ccc21fcd.js";import{g as M,d as R,l as A,a as D,c as E,u as X}from"./index-e4f7737c.js";import{g as B}from"./index-49b8d380.js";import{u as O}from"./useMessage-5e709b20.js";import{u as L}from"./useXTable-bf420a68.js";import{a as N,E as P}from"./index-168f367d.js";import"./propTypes-5cfdbdab.js";import"./index-be3181b1.js";import"./aria-8fadfbe9.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./Form.vue_vue_type_style_index_0_scoped_f983cb9f_lang-54d674bd.js";import"./el-form-item-8022b942.js";import"./index-c2caee16.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./el-row-ad412a39.js";import"./el-col-613bea3c.js";import"./is-a7957d81.js";import"./el-tooltip-4ed993c7.js";import"./el-radio-group-d1c0e064.js";import"./el-button-6b012e5e.js";import"./el-input-number-4fe7018b.js";import"./focus-trap-f53979c5.js";import"./el-switch-4b318cc1.js";/* empty css                   */import"./InputPassword-d0077663.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./el-message-7ddf9388.js";import"./index-7a379d2e.js";import"./auth-2fa258a0.js";import"./useCache-d48cf6c5.js";import"./el-image-viewer-f62c5b85.js";import"./debounce-eb6bb100.js";import"./el-progress-64245232.js";import"./index-cf52a0ab.js";import"./index-7486e100.js";import"./strings-777507ad.js";import"./isEqual-6e1d5dd6.js";import"./_flatRest-ac7abae6.js";import"./index-795de047.js";import"./index-9d88d8a4.js";import"./dayjs.min-65a6b1e4.js";import"./isArrayLikeObject-26c677c4.js";import"./index-653de86a.js";/* empty css                        *//* empty css                                                                   *//* empty css                    */import"./index-183fdc84.js";import"./el-card-d8ab0074.js";import"./app-41ac77cd.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-a7ef0ded.js";import"./vue-router-0864a153.js";import"./index-6f87c872.js";const{t:q}=p(),z=c({name:[n],sort:[n],email:[{required:!0,message:q("profile.rules.mail"),trigger:"blur"},{type:"email",message:q("profile.rules.truemail"),trigger:["blur","change"]}],phone:[{len:11,trigger:"blur",message:"请输入正确的手机号码"}]}),K=c({primaryKey:"id",primaryType:null,action:!0,columns:[{title:"上级部门",field:"parentId",isTable:!1},{title:"部门名称",field:"name",isSearch:!0,table:{treeNode:!0,align:"left"}},{title:"负责人",field:"leaderUserId",table:{slots:{default:"leaderUserId_default"}}},{title:"联系电话",field:"phone"},{title:"邮箱",field:"email",isTable:!1},{title:"显示排序",field:"sort"},{title:q("common.status"),field:"status",dictType:d.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:q("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1}]}),{allSchemas:Q}=u(K),W=j({name:"Dept"}),G=j({...W,setup(n){const{t:d}=p(),u=O(),c=f(),j=f(!1),q=f("edit"),K=f(""),W=f(!1),G=f(),J=f(),Y=f([]),Z=async()=>{J.value=[];const e=await A();let t={id:0,name:"顶级部门",children:[]};t.children=m(e),J.value.push(t)},[$,{reload:H,deleteData:ee}]=L({allSchemas:Q,treeConfig:{transform:!0,rowField:"id",parentField:"parentId",expandAll:!0},getListApi:M,deleteApi:R}),te=e=>{q.value=d("action."+e),K.value=e,j.value=!0},re=e=>{if(!e||!e.leaderUserId)return"未设置";for(const t of Y.value)if(e.leaderUserId===t.id)return t.nickname;return"未知【"+e.leaderUserId+"】"};return _((async()=>{await(async()=>{const e=await B();Y.value=e})(),await Z()})),(m,p)=>{const n=i,f=l,_=s,M=a,R=r,A=N,B=P,O=t,L=e,ae=v("hasPermi");return y(),g(U,null,[b(M,null,{default:x((()=>[b(_,{ref_key:"xGrid",ref:c,onRegister:h($),"show-overflow":""},{toolbar_buttons:x((()=>[w(b(n,{type:"primary",preIcon:"ep:zoom-in",title:h(d)("action.add"),onClick:p[0]||(p[0]=e=>(async()=>{te("create")})())},null,8,["title"]),[[ae,["system:dept:create"]]]),b(n,{title:"展开所有",onClick:p[1]||(p[1]=e=>{var t;return null==(t=h(c))?void 0:t.Ref.setAllTreeExpand(!0)})}),b(n,{title:"关闭所有",onClick:p[2]||(p[2]=e=>{var t;return null==(t=h(c))?void 0:t.Ref.clearTreeExpand()})})])),leaderUserId_default:x((({row:e})=>[k("span",null,I(re(e)),1)])),actionbtns_default:x((({row:e})=>[w(b(f,{preIcon:"ep:edit",title:h(d)("action.edit"),onClick:t=>(async e=>{var t;te("update");const r=await D(e);await F(),null==(t=h(G))||t.setValues(r)})(e.id)},null,8,["title","onClick"]),[[ae,["system:dept:update"]]]),w(b(f,{preIcon:"ep:delete",title:h(d)("action.del"),onClick:t=>h(ee)(e.id)},null,8,["title","onClick"]),[[ae,["system:dept:delete"]]])])),_:1},8,["onRegister"])])),_:1}),b(L,{id:"deptModel",modelValue:h(j),"onUpdate:modelValue":p[5]||(p[5]=e=>S(j)?j.value=e:null),title:h(q)},{footer:x((()=>[["create","update"].includes(h(K))?(y(),C(n,{key:0,type:"primary",loading:h(W),onClick:p[3]||(p[3]=e=>(async()=>{var e;const t=null==(e=h(G))?void 0:e.getElFormRef();t&&t.validate((async e=>{var t;if(e){W.value=!0;try{const e=null==(t=h(G))?void 0:t.formModel;"create"===K.value?(await E(e),u.success(d("common.createSuccess"))):"update"===K.value&&(await X(e),u.success(d("common.updateSuccess"))),j.value=!1}finally{W.value=!1,await Z(),await H()}}}))})()),title:h(d)("action.save")},null,8,["loading","title"])):T("",!0),b(n,{loading:h(W),onClick:p[4]||(p[4]=e=>j.value=!1),title:h(d)("dialog.close")},null,8,["loading","title"])])),default:x((()=>[b(O,{ref_key:"formRef",ref:G,schema:h(Q).formSchema,rules:h(z)},{parentId:x((e=>[b(R,{"node-key":"id",modelValue:e.parentId,"onUpdate:modelValue":t=>e.parentId=t,props:h(o),data:h(J),"default-expanded-keys":[100],"check-strictly":""},null,8,["modelValue","onUpdate:modelValue","props","data"])])),leaderUserId:x((e=>[b(B,{modelValue:e.leaderUserId,"onUpdate:modelValue":t=>e.leaderUserId=t},{default:x((()=>[(y(!0),g(U,null,V(h(Y),(e=>(y(),C(A,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["schema","rules"])])),_:1},8,["modelValue","title"])],64)}}});export{G as default};
