import{w as e,a as t,b as a}from"./runtime-dom.esm-bundler-daa7e741.js";import{b as s,d as l,u as r,E as n,_ as o,w as i,a2 as u}from"./base-085523fd.js";import{I as c,J as d,f as p,n as f,o as m,e as v,K as y,D as h,L as g}from"./index-c2caee16.js";import{d as b,c as k,b7 as w,b8 as $,o as x,i as F,n as E,f as R,e as S,s as T,j as L,t as _,h as C,a as U,w as j,g as P,bp as D,r as O,F as B,z as N,l as q,bd as A,q as H,aO as I,m as M,u as W,H as K,p as z,aU as X,y as J,v as V}from"./runtime-core.esm-bundler-ccc21fcd.js";import{t as G,u as Q,d as Y}from"./el-notification-c7d5f4ea.js";import{i as Z}from"./focus-trap-f53979c5.js";import{m as ee}from"./is-a7957d81.js";import{g as te}from"./aria-8fadfbe9.js";const ae=Symbol("uploadContextKey"),se=s({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:e=>e>=0&&e<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:l(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:l([String,Array,Function]),default:""},format:{type:l(Function),default:e=>`${e}%`}}),le=["aria-valuenow"],re={viewBox:"0 0 100 100"},ne=["d","stroke","stroke-width"],oe=["d","stroke","opacity","stroke-linecap","stroke-width"],ie={key:0},ue=b({name:"ElProgress"});const ce=i(o(b({...ue,props:se,setup(e){const t=e,a={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},s=r("progress"),l=k((()=>({width:`${t.percentage}%`,animationDuration:`${t.duration}s`,backgroundColor:q(t.percentage)}))),o=k((()=>(t.strokeWidth/t.width*100).toFixed(1))),i=k((()=>["circle","dashboard"].includes(t.type)?Number.parseInt(""+(50-Number.parseFloat(o.value)/2),10):0)),u=k((()=>{const e=i.value,a="dashboard"===t.type;return`\n          M 50 50\n          m 0 ${a?"":"-"}${e}\n          a ${e} ${e} 0 1 1 0 ${a?"-":""}${2*e}\n          a ${e} ${e} 0 1 1 0 ${a?"":"-"}${2*e}\n          `})),v=k((()=>2*Math.PI*i.value)),y=k((()=>"dashboard"===t.type?.75:1)),h=k((()=>`${-1*v.value*(1-y.value)/2}px`)),g=k((()=>({strokeDasharray:`${v.value*y.value}px, ${v.value}px`,strokeDashoffset:h.value}))),b=k((()=>({strokeDasharray:`${v.value*y.value*(t.percentage/100)}px, ${v.value}px`,strokeDashoffset:h.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"}))),D=k((()=>{let e;return e=t.color?q(t.percentage):a[t.status]||a.default,e})),O=k((()=>"warning"===t.status?c:"line"===t.type?"success"===t.status?d:p:"success"===t.status?f:m)),B=k((()=>"line"===t.type?12+.4*t.strokeWidth:.111111*t.width+2)),N=k((()=>t.format(t.percentage)));const q=e=>{var a;const{color:s}=t;if(w(s))return s(e);if($(s))return s;{const t=function(e){const t=100/e.length;return e.map(((e,a)=>$(e)?{color:e,percentage:(a+1)*t}:e)).sort(((e,t)=>e.percentage-t.percentage))}(s);for(const a of t)if(a.percentage>e)return a.color;return null==(a=t[t.length-1])?void 0:a.color}};return(e,t)=>(x(),F("div",{class:E([R(s).b(),R(s).m(e.type),R(s).is(e.status),{[R(s).m("without-text")]:!e.showText,[R(s).m("text-inside")]:e.textInside}]),role:"progressbar","aria-valuenow":e.percentage,"aria-valuemin":"0","aria-valuemax":"100"},["line"===e.type?(x(),F("div",{key:0,class:E(R(s).b("bar"))},[S("div",{class:E(R(s).be("bar","outer")),style:T({height:`${e.strokeWidth}px`})},[S("div",{class:E([R(s).be("bar","inner"),{[R(s).bem("bar","inner","indeterminate")]:e.indeterminate}]),style:T(R(l))},[(e.showText||e.$slots.default)&&e.textInside?(x(),F("div",{key:0,class:E(R(s).be("bar","innerText"))},[L(e.$slots,"default",{percentage:e.percentage},(()=>[S("span",null,_(R(N)),1)]))],2)):C("v-if",!0)],6)],6)],2)):(x(),F("div",{key:1,class:E(R(s).b("circle")),style:T({height:`${e.width}px`,width:`${e.width}px`})},[(x(),F("svg",re,[S("path",{class:E(R(s).be("circle","track")),d:R(u),stroke:`var(${R(s).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":R(o),fill:"none",style:T(R(g))},null,14,ne),S("path",{class:E(R(s).be("circle","path")),d:R(u),stroke:R(D),fill:"none",opacity:e.percentage?1:0,"stroke-linecap":e.strokeLinecap,"stroke-width":R(o),style:T(R(b))},null,14,oe)]))],6)),!e.showText&&!e.$slots.default||e.textInside?C("v-if",!0):(x(),F("div",{key:2,class:E(R(s).e("text")),style:T({fontSize:`${R(B)}px`})},[L(e.$slots,"default",{percentage:e.percentage},(()=>[e.status?(x(),U(R(n),{key:1},{default:j((()=>[(x(),U(P(R(O))))])),_:1})):(x(),F("span",ie,_(R(N)),1))]))],6))],10,le))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]));class de extends Error{constructor(e,t,a,s){super(e),this.name="UploadAjaxError",this.status=t,this.method=a,this.url=s}}function pe(e,t,a){let s;return s=a.response?`${a.response.error||a.response}`:a.responseText?`${a.responseText}`:`fail to ${t.method} ${e} ${a.status}`,new de(s,a.status,t.method,e)}const fe=["text","picture","picture-card"];let me=1;const ve=()=>Date.now()+me++,ye=s({action:{type:String,default:"#"},headers:{type:l(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>ee({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:l(Array),default:()=>ee([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:fe,default:"text"},httpRequest:{type:l(Function),default:e=>{"undefined"==typeof XMLHttpRequest&&G("ElUpload","XMLHttpRequest is undefined");const t=new XMLHttpRequest,a=e.action;t.upload&&t.upload.addEventListener("progress",(t=>{const a=t;a.percent=t.total>0?t.loaded/t.total*100:0,e.onProgress(a)}));const s=new FormData;if(e.data)for(const[r,n]of Object.entries(e.data))Array.isArray(n)?s.append(r,...n):s.append(r,n);s.append(e.filename,e.file,e.file.name),t.addEventListener("error",(()=>{e.onError(pe(a,e,t))})),t.addEventListener("load",(()=>{if(t.status<200||t.status>=300)return e.onError(pe(a,e,t));e.onSuccess(function(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(a){return t}}(t))})),t.open(e.method,a,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);const l=e.headers||{};if(l instanceof Headers)l.forEach(((e,a)=>t.setRequestHeader(a,e)));else for(const[r,n]of Object.entries(l))Z(n)||t.setRequestHeader(r,String(n));return t.send(s),t}},disabled:Boolean,limit:Number}),he=s({...ye,beforeUpload:{type:l(Function),default:D},beforeRemove:{type:l(Function)},onRemove:{type:l(Function),default:D},onChange:{type:l(Function),default:D},onPreview:{type:l(Function),default:D},onSuccess:{type:l(Function),default:D},onProgress:{type:l(Function),default:D},onError:{type:l(Function),default:D},onExceed:{type:l(Function),default:D}}),ge=s({files:{type:l(Array),default:()=>ee([])},disabled:{type:Boolean,default:!1},handlePreview:{type:l(Function),default:D},listType:{type:String,values:fe,default:"text"}}),be=["onKeydown"],ke=["src"],we=["onClick"],$e=["onClick"],xe=["onClick"],Fe=b({name:"ElUploadList"});var Ee=o(b({...Fe,props:ge,emits:{remove:e=>!!e},setup(s,{emit:l}){const{t:o}=Q(),i=r("upload"),u=r("icon"),c=r("list"),p=v(),b=O(!1),k=e=>{l("remove",e)};return(s,l)=>(x(),U(a,{tag:"ul",class:E([R(i).b("list"),R(i).bm("list",s.listType),R(i).is("disabled",R(p))]),name:R(c).b()},{default:j((()=>[(x(!0),F(B,null,N(s.files,(a=>(x(),F("li",{key:a.uid||a.name,class:E([R(i).be("list","item"),R(i).is(a.status),{focusing:b.value}]),tabindex:"0",onKeydown:e((e=>!R(p)&&k(a)),["delete"]),onFocus:l[0]||(l[0]=e=>b.value=!0),onBlur:l[1]||(l[1]=e=>b.value=!1),onClick:l[2]||(l[2]=e=>b.value=!1)},[L(s.$slots,"default",{file:a},(()=>["picture"===s.listType||"uploading"!==a.status&&"picture-card"===s.listType?(x(),F("img",{key:0,class:E(R(i).be("list","item-thumbnail")),src:a.url,alt:""},null,10,ke)):C("v-if",!0),"uploading"===a.status||"picture-card"!==s.listType?(x(),F("div",{key:1,class:E(R(i).be("list","item-info"))},[S("a",{class:E(R(i).be("list","item-name")),onClick:t((e=>s.handlePreview(a)),["prevent"])},[q(R(n),{class:E(R(u).m("document"))},{default:j((()=>[q(R(y))])),_:1},8,["class"]),S("span",{class:E(R(i).be("list","item-file-name"))},_(a.name),3)],10,we),"uploading"===a.status?(x(),U(R(ce),{key:0,type:"picture-card"===s.listType?"circle":"line","stroke-width":"picture-card"===s.listType?6:2,percentage:Number(a.percentage),style:T("picture-card"===s.listType?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):C("v-if",!0)],2)):C("v-if",!0),S("label",{class:E(R(i).be("list","item-status-label"))},["text"===s.listType?(x(),U(R(n),{key:0,class:E([R(u).m("upload-success"),R(u).m("circle-check")])},{default:j((()=>[q(R(d))])),_:1},8,["class"])):["picture-card","picture"].includes(s.listType)?(x(),U(R(n),{key:1,class:E([R(u).m("upload-success"),R(u).m("check")])},{default:j((()=>[q(R(f))])),_:1},8,["class"])):C("v-if",!0)],2),R(p)?C("v-if",!0):(x(),U(R(n),{key:2,class:E(R(u).m("close")),onClick:e=>k(a)},{default:j((()=>[q(R(m))])),_:2},1032,["class","onClick"])),C(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),C(" This is a bug which needs to be fixed "),C(" TODO: Fix the incorrect navigation interaction "),R(p)?C("v-if",!0):(x(),F("i",{key:3,class:E(R(u).m("close-tip"))},_(R(o)("el.upload.deleteTip")),3)),"picture-card"===s.listType?(x(),F("span",{key:4,class:E(R(i).be("list","item-actions"))},[S("span",{class:E(R(i).be("list","item-preview")),onClick:e=>s.handlePreview(a)},[q(R(n),{class:E(R(u).m("zoom-in"))},{default:j((()=>[q(R(h))])),_:1},8,["class"])],10,$e),R(p)?C("v-if",!0):(x(),F("span",{key:0,class:E(R(i).be("list","item-delete")),onClick:e=>k(a)},[q(R(n),{class:E(R(u).m("delete"))},{default:j((()=>[q(R(g))])),_:1},8,["class"])],10,xe))],2)):C("v-if",!0)]))],42,be)))),128)),L(s.$slots,"append")])),_:3},8,["class","name"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const Re=s({disabled:{type:Boolean,default:!1}}),Se={file:e=>A(e)},Te=["onDrop","onDragover"],Le="ElUploadDrag",_e=b({name:Le});var Ce=o(b({..._e,props:Re,emits:Se,setup(e,{emit:a}){const s=H(ae);s||G(Le,"usage: <el-upload><el-upload-dragger /></el-upload>");const l=r("upload"),n=O(!1),o=v(),i=e=>{if(o.value)return;n.value=!1;const t=Array.from(e.dataTransfer.files),l=s.accept.value;if(!l)return void a("file",t);const r=t.filter((e=>{const{type:t,name:a}=e,s=a.includes(".")?`.${a.split(".").pop()}`:"",r=t.replace(/\/.*$/,"");return l.split(",").map((e=>e.trim())).filter((e=>e)).some((e=>e.startsWith(".")?s===e:/\/\*$/.test(e)?r===e.replace(/\/\*$/,""):!!/^[^/]+\/[^/]+$/.test(e)&&t===e))}));a("file",r)},u=()=>{o.value||(n.value=!0)};return(e,a)=>(x(),F("div",{class:E([R(l).b("dragger"),R(l).is("dragover",n.value)]),onDrop:t(i,["prevent"]),onDragover:t(u,["prevent"]),onDragleave:a[0]||(a[0]=t((e=>n.value=!1),["prevent"]))},[L(e.$slots,"default")],42,Te))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const Ue=s({...ye,beforeUpload:{type:l(Function),default:D},onRemove:{type:l(Function),default:D},onStart:{type:l(Function),default:D},onSuccess:{type:l(Function),default:D},onProgress:{type:l(Function),default:D},onError:{type:l(Function),default:D},onExceed:{type:l(Function),default:D}}),je=["onKeydown"],Pe=["name","multiple","accept"],De=b({name:"ElUploadContent",inheritAttrs:!1});var Oe=o(b({...De,props:Ue,setup(a,{expose:s}){const l=a,n=r("upload"),o=v(),i=I({}),c=I(),d=e=>{if(0===e.length)return;const{autoUpload:t,limit:a,fileList:s,multiple:r,onStart:n,onExceed:o}=l;if(a&&s.length+e.length>a)o(e,s);else{r||(e=e.slice(0,1));for(const a of e){const e=a;e.uid=ve(),n(e),t&&p(e)}}},p=async e=>{if(c.value.value="",!l.beforeUpload)return f(e);let t;try{t=await l.beforeUpload(e)}catch(s){t=!1}if(!1===t)return void l.onRemove(e);let a=e;t instanceof Blob&&(a=t instanceof File?t:new File([t],e.name,{type:e.type})),f(Object.assign(a,{uid:e.uid}))},f=e=>{const{headers:t,data:a,method:s,withCredentials:r,name:n,action:o,onProgress:u,onSuccess:c,onError:d,httpRequest:p}=l,{uid:f}=e,m={headers:t||{},withCredentials:r,file:e,data:a,method:s,filename:n,action:o,onProgress:t=>{u(t,e)},onSuccess:t=>{c(t,e),delete i.value[f]},onError:t=>{d(t,e),delete i.value[f]}},v=p(m);i.value[f]=v,v instanceof Promise&&v.then(m.onSuccess,m.onError)},m=e=>{const t=e.target.files;t&&d(Array.from(t))},y=()=>{o.value||(c.value.value="",c.value.click())},h=()=>{y()};return s({abort:e=>{u(i.value).filter(e?([t])=>String(e.uid)===t:()=>!0).forEach((([e,t])=>{t instanceof XMLHttpRequest&&t.abort(),delete i.value[e]}))},upload:p}),(a,s)=>(x(),F("div",{class:E([R(n).b(),R(n).m(a.listType),R(n).is("drag",a.drag)]),tabindex:"0",onClick:y,onKeydown:e(t(h,["self"]),["enter","space"])},[a.drag?(x(),U(Ce,{key:0,disabled:R(o),onFile:d},{default:j((()=>[L(a.$slots,"default")])),_:3},8,["disabled"])):L(a.$slots,"default",{key:1}),S("input",{ref_key:"inputRef",ref:c,class:E(R(n).e("input")),name:a.name,multiple:a.multiple,accept:a.accept,type:"file",onChange:m,onClick:s[0]||(s[0]=t((()=>{}),["stop"]))},null,42,Pe)],42,je))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const Be="ElUpload",Ne=(e,t)=>{const a=te(e,"fileList",void 0,{passive:!0}),s=e=>a.value.find((t=>t.uid===e.uid));function l(e){var a;null==(a=t.value)||a.abort(e)}return M((()=>e.listType),(t=>{"picture-card"!==t&&"picture"!==t||(a.value=a.value.map((t=>{const{raw:s,url:l}=t;if(!l&&s)try{t.url=URL.createObjectURL(s)}catch(r){e.onError(r,t,a.value)}return t})))})),M(a,(e=>{for(const t of e)t.uid||(t.uid=ve()),t.status||(t.status="success")}),{immediate:!0,deep:!0}),{uploadFiles:a,abort:l,clearFiles:function(e=["ready","uploading","success","fail"]){a.value=a.value.filter((t=>!e.includes(t.status)))},handleError:(t,l)=>{const r=s(l);r&&(r.status="fail",a.value.splice(a.value.indexOf(r),1),e.onError(t,r,a.value),e.onChange(r,a.value))},handleProgress:(t,l)=>{const r=s(l);r&&(e.onProgress(t,r,a.value),r.status="uploading",r.percentage=Math.round(t.percent))},handleStart:t=>{Z(t.uid)&&(t.uid=ve());const s={name:t.name,percentage:0,status:"ready",size:t.size,raw:t,uid:t.uid};if("picture-card"===e.listType||"picture"===e.listType)try{s.url=URL.createObjectURL(t)}catch(l){Y(Be,l.message),e.onError(l,s,a.value)}a.value=[...a.value,s],e.onChange(s,a.value)},handleSuccess:(t,l)=>{const r=s(l);r&&(r.status="success",r.response=t,e.onSuccess(t,r,a.value),e.onChange(r,a.value))},handleRemove:async t=>{const r=t instanceof File?s(t):t;r||G(Be,"file to be removed not found");const n=t=>{l(t);const s=a.value;s.splice(s.indexOf(t),1),e.onRemove(t,s),(e=>{var t;(null==(t=e.url)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(e.url)})(t)};if(e.beforeRemove){!1!==await e.beforeRemove(r,a.value)&&n(r)}else n(r)},submit:function(){a.value.filter((({status:e})=>"ready"===e)).forEach((({raw:e})=>{var a;return e&&(null==(a=t.value)?void 0:a.upload(e))}))}}},qe=b({name:"ElUpload"});const Ae=i(o(b({...qe,props:he,setup(e,{expose:t}){const a=e,s=W(),l=v(),r=I(),{abort:n,submit:o,clearFiles:i,uploadFiles:u,handleStart:c,handleError:d,handleRemove:p,handleSuccess:f,handleProgress:m}=Ne(a,r),y=k((()=>"picture-card"===a.listType)),h=k((()=>({...a,fileList:u.value,onStart:c,onProgress:m,onSuccess:f,onError:d,onRemove:p})));return K((()=>{u.value.forEach((({url:e})=>{(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))})),z(ae,{accept:X(a,"accept")}),t({abort:n,submit:o,clearFiles:i,handleStart:c,handleRemove:p}),(e,t)=>(x(),F("div",null,[R(y)&&e.showFileList?(x(),U(Ee,{key:0,disabled:R(l),"list-type":e.listType,files:R(u),"handle-preview":e.onPreview,onRemove:R(p)},J({append:j((()=>[q(Oe,V({ref_key:"uploadRef",ref:r},R(h)),{default:j((()=>[R(s).trigger?L(e.$slots,"trigger",{key:0}):C("v-if",!0),!R(s).trigger&&R(s).default?L(e.$slots,"default",{key:1}):C("v-if",!0)])),_:3},16)])),_:2},[e.$slots.file?{name:"default",fn:j((({file:t})=>[L(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):C("v-if",!0),!R(y)||R(y)&&!e.showFileList?(x(),U(Oe,V({key:1,ref_key:"uploadRef",ref:r},R(h)),{default:j((()=>[R(s).trigger?L(e.$slots,"trigger",{key:0}):C("v-if",!0),!R(s).trigger&&R(s).default?L(e.$slots,"default",{key:1}):C("v-if",!0)])),_:3},16)):C("v-if",!0),e.$slots.trigger?L(e.$slots,"default",{key:2}):C("v-if",!0),L(e.$slots,"tip"),!R(y)&&e.showFileList?(x(),U(Ee,{key:3,disabled:R(l),"list-type":e.listType,files:R(u),"handle-preview":e.onPreview,onRemove:R(p)},J({_:2},[e.$slots.file?{name:"default",fn:j((({file:t})=>[L(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):C("v-if",!0)]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]));export{Ae as E,ce as a};
