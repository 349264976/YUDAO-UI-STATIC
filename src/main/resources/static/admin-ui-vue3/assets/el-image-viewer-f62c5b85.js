import{O as e,l as a,b as t,d as n,i as s,u as o,E as l,_ as i,k as c,w as r}from"./base-085523fd.js";import{a as u,v as d,T as f}from"./runtime-dom.esm-bundler-daa7e741.js";import{c as m,E as p}from"./aria-8fadfbe9.js";import{z as v,A as g,o as b,r as h,b as k,B as w,D as x,E as y,F as z}from"./index-c2caee16.js";import{m as I}from"./is-a7957d81.js";import{u as _}from"./el-notification-c7d5f4ea.js";import{u as C}from"./index-7a379d2e.js";import{d as O}from"./debounce-eb6bb100.js";import{d as T,L as N,r as j,aj as E,aO as X,c as Y,m as A,D as R,x as L,o as B,a as D,l as F,w as $,e as W,n as M,f as S,s as V,h as H,i as P,F as G,g as Z,z as q,b as J,j as K,T as Q}from"./runtime-core.esm-bundler-ccc21fcd.js";var U="Expected a function";function ee(a,t,n){var s=!0,o=!0;if("function"!=typeof a)throw new TypeError(U);return e(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),O(a,t,{leading:s,maxWait:t,trailing:o})}const ae=(e,t)=>{if(!a||!e||!t)return!1;const n=e.getBoundingClientRect();let s;return s=t instanceof Element?t.getBoundingClientRect():{top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<s.bottom&&n.bottom>s.top&&n.right>s.left&&n.left<s.right},te=e=>{let a,t;return"touchend"===e.type?(t=e.changedTouches[0].clientY,a=e.changedTouches[0].clientX):e.type.startsWith("touch")?(t=e.touches[0].clientY,a=e.touches[0].clientX):(t=e.clientY,a=e.clientX),{clientX:a,clientY:t}},ne=t({urlList:{type:n(Array),default:()=>I([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),se={close:()=>!0,switch:e=>s(e)},oe=["src"],le=T({name:"ElImageViewer"});const ie=r(i(T({...le,props:ne,emits:se,setup(e,{expose:a,emit:t}){const n=e,i={CONTAIN:{name:"contain",icon:N(v)},ORIGINAL:{name:"original",icon:N(g)}},{t:r}=_(),I=o("image-viewer"),{nextZIndex:O}=C(),T=j(),U=j([]),ae=E(),te=j(!0),ne=j(n.initialIndex),se=X(i.CONTAIN),le=j({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ie=Y((()=>{const{urlList:e}=n;return e.length<=1})),ce=Y((()=>0===ne.value)),re=Y((()=>ne.value===n.urlList.length-1)),ue=Y((()=>n.urlList[ne.value])),de=Y((()=>{const{scale:e,deg:a,offsetX:t,offsetY:n,enableTransition:s}=le.value;let o=t/e,l=n/e;switch(a%360){case 90:case-270:[o,l]=[l,-o];break;case 180:case-180:[o,l]=[-o,-l];break;case 270:case-90:[o,l]=[-l,o]}const c={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${l}px)`,transition:s?"transform .3s":""};return se.value.name===i.CONTAIN.name&&(c.maxWidth=c.maxHeight="100%"),c})),fe=Y((()=>s(n.zIndex)?n.zIndex:O()));function me(){ae.stop(),t("close")}function pe(){te.value=!1}function ve(e){te.value=!1,e.target.alt=r("el.image.error")}function ge(e){if(te.value||0!==e.button||!T.value)return;le.value.enableTransition=!1;const{offsetX:a,offsetY:t}=le.value,n=e.pageX,s=e.pageY,o=ee((e=>{le.value={...le.value,offsetX:a+e.pageX-n,offsetY:t+e.pageY-s}})),l=m(document,"mousemove",o);m(document,"mouseup",(()=>{l()})),e.preventDefault()}function be(){le.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function he(){if(te.value)return;const e=c(i),a=Object.values(i),t=se.value.name,n=(a.findIndex((e=>e.name===t))+1)%e.length;se.value=i[e[n]],be()}function ke(e){const a=n.urlList.length;ne.value=(e+a)%a}function we(){ce.value&&!n.infinite||ke(ne.value-1)}function xe(){re.value&&!n.infinite||ke(ne.value+1)}function ye(e,a={}){if(te.value)return;const{zoomRate:t,rotateDeg:s,enableTransition:o}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":le.value.scale>.2&&(le.value.scale=Number.parseFloat((le.value.scale/t).toFixed(3)));break;case"zoomIn":le.value.scale<7&&(le.value.scale=Number.parseFloat((le.value.scale*t).toFixed(3)));break;case"clockwise":le.value.deg+=s;break;case"anticlockwise":le.value.deg-=s}le.value.enableTransition=o}return A(ue,(()=>{R((()=>{const e=U.value[0];(null==e?void 0:e.complete)||(te.value=!0)}))})),A(ne,(e=>{be(),t("switch",e)})),L((()=>{var e,a;!function(){const e=ee((e=>{switch(e.code){case p.esc:n.closeOnPressEscape&&me();break;case p.space:he();break;case p.left:we();break;case p.up:ye("zoomIn");break;case p.right:xe();break;case p.down:ye("zoomOut")}})),a=ee((e=>{ye((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})}));ae.run((()=>{m(document,"keydown",e),m(document,"wheel",a)}))}(),null==(a=null==(e=T.value)?void 0:e.focus)||a.call(e)})),a({setActiveItem:ke}),(e,a)=>(B(),D(Q,{to:"body",disabled:!e.teleported},[F(f,{name:"viewer-fade",appear:""},{default:$((()=>[W("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:M(S(I).e("wrapper")),style:V({zIndex:S(fe)})},[W("div",{class:M(S(I).e("mask")),onClick:a[0]||(a[0]=u((a=>e.hideOnClickModal&&me()),["self"]))},null,2),H(" CLOSE "),W("span",{class:M([S(I).e("btn"),S(I).e("close")]),onClick:me},[F(S(l),null,{default:$((()=>[F(S(b))])),_:1})],2),H(" ARROW "),S(ie)?H("v-if",!0):(B(),P(G,{key:0},[W("span",{class:M([S(I).e("btn"),S(I).e("prev"),S(I).is("disabled",!e.infinite&&S(ce))]),onClick:we},[F(S(l),null,{default:$((()=>[F(S(h))])),_:1})],2),W("span",{class:M([S(I).e("btn"),S(I).e("next"),S(I).is("disabled",!e.infinite&&S(re))]),onClick:xe},[F(S(l),null,{default:$((()=>[F(S(k))])),_:1})],2)],64)),H(" ACTIONS "),W("div",{class:M([S(I).e("btn"),S(I).e("actions")])},[W("div",{class:M(S(I).e("actions__inner"))},[F(S(l),{onClick:a[1]||(a[1]=e=>ye("zoomOut"))},{default:$((()=>[F(S(w))])),_:1}),F(S(l),{onClick:a[2]||(a[2]=e=>ye("zoomIn"))},{default:$((()=>[F(S(x))])),_:1}),W("i",{class:M(S(I).e("actions__divider"))},null,2),F(S(l),{onClick:he},{default:$((()=>[(B(),D(Z(S(se).icon)))])),_:1}),W("i",{class:M(S(I).e("actions__divider"))},null,2),F(S(l),{onClick:a[3]||(a[3]=e=>ye("anticlockwise"))},{default:$((()=>[F(S(y))])),_:1}),F(S(l),{onClick:a[4]||(a[4]=e=>ye("clockwise"))},{default:$((()=>[F(S(z))])),_:1})],2)],2),H(" CANVAS "),W("div",{class:M(S(I).e("canvas"))},[(B(!0),P(G,null,q(e.urlList,((e,a)=>J((B(),P("img",{ref_for:!0,ref:e=>U.value[a]=e,key:e,src:e,style:V(S(de)),class:M(S(I).e("img")),onLoad:pe,onError:ve,onMousedown:ge},null,46,oe)),[[d,a===ne.value]]))),128))],2),K(e.$slots,"default")],6)])),_:3})],8,["disabled"]))}}),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]));export{ie as E,te as g,ae as i};
