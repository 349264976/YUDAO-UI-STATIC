import{d as ta,N as ra,a8 as sa,e as la,r as n,f as oa,A as na,a7 as ia,o as m,q as b,w as r,c as R,k as _a,a,F as ca,B as S,g as P,t as T,i as t,a1 as D,a9 as ua,aa as ma,E as fa,L as pa,j as f,D as da,a4 as ya,T as ha,I as va,_ as ka,H as ga,__tla as ba}from"./index-0f589822.js";import{_ as xa,__tla as wa}from"./ContentWrap.vue_vue_type_script_setup_true_lang-0f1e3633.js";import{E as Ca,__tla as Ta}from"./el-card-bbdd700f.js";import{b as Ua}from"./formCreate-a3356cdc.js";import{a as Va,__tla as Da}from"./index-388bdb31.js";import{g as Ea,__tla as qa}from"./index-0275191e.js";import{g as Fa,a as Pa,r as Aa,__tla as Ba}from"./index-953eef09.js";import{_ as ja,__tla as za}from"./TaskUpdateAssigneeForm.vue_vue_type_script_setup_true_lang-7e3a8804.js";import{_ as Ha,__tla as Ia}from"./ProcessInstanceBpmnViewer.vue_vue_type_style_index_0_lang-ef80a0a4.js";import{_ as Na,__tla as $a}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-7fd5071c.js";import{u as Ka,__tla as La}from"./useMessage-45ab706e.js";import{__tla as Oa}from"./Dialog.vue_vue_type_style_index_0_lang-2d188c85.js";import{__tla as Ra}from"./index-2e308907.js";import{__tla as Sa}from"./bpmn-embedded-1e1b15cf.js";import{__tla as Ga}from"./XTextButton-f2bb1cf5.js";import"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as Ja}from"./XButton-ceeece05.js";import{__tla as Ma}from"./el-link-932c772d.js";import{__tla as Qa}from"./el-drawer-6328bc2e.js";import{__tla as Wa}from"./dict-f9a1a53b.js";import{__tla as Xa}from"./formatTime-58783104.js";import{__tla as Ya}from"./el-timeline-item-75174dbf.js";let G,Za=Promise.all([(()=>{try{return ba}catch{}})(),(()=>{try{return wa}catch{}})(),(()=>{try{return Ta}catch{}})(),(()=>{try{return Da}catch{}})(),(()=>{try{return qa}catch{}})(),(()=>{try{return Ba}catch{}})(),(()=>{try{return za}catch{}})(),(()=>{try{return Ia}catch{}})(),(()=>{try{return $a}catch{}})(),(()=>{try{return La}catch{}})(),(()=>{try{return Oa}catch{}})(),(()=>{try{return Ra}catch{}})(),(()=>{try{return Sa}catch{}})(),(()=>{try{return Ga}catch{}})(),(()=>{try{return Ja}catch{}})(),(()=>{try{return Ma}catch{}})(),(()=>{try{return Qa}catch{}})(),(()=>{try{return Wa}catch{}})(),(()=>{try{return Xa}catch{}})(),(()=>{try{return Ya}catch{}})()]).then(async()=>{let A,B,j,z;A={class:"el-icon-picture-outline"},B={style:{"margin-left":"10%","margin-bottom":"20px","font-size":"14px"}},j={class:"el-icon-document"},z={key:1},G=ta({name:"BpmProcessInstanceDetail",__name:"index",setup(ae){const{query:J}=ra(),x=Ka(),{proxy:M}=sa(),Q=la().getUser.id,E=J.id,w=n(!1),l=n({}),H=n(""),q=n(!0),v=n([]),U=n([]),k=n([]),W=oa({reason:[{required:!0,message:"\u5BA1\u6279\u5EFA\u8BAE\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),V=n(),C=n({rule:[],option:{},value:{}}),I=async(o,e)=>{const s=U.value.indexOf(o),g=M.$refs["form"+s][0],p=a(g);if(!p||!await p.validate())return;const d={id:o.id,reason:k.value[s].reason};e?(await Pa(d),x.success("\u5BA1\u6279\u901A\u8FC7\u6210\u529F")):(await Aa(d),x.success("\u5BA1\u6279\u4E0D\u901A\u8FC7\u6210\u529F")),F()},N=n(),F=()=>{X(),Y()},$=n(null),X=async()=>{try{w.value=!0;const o=await Ea(E);if(!o)return void x.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");l.value=o;const e=o.processDefinition;e.formType===10?(Ua(C,e.formConf,e.formFields,o.formVariables),ua().then(()=>{var s,g,p,d,_,c;(g=(s=V.value)==null?void 0:s.fapi)==null||g.btn.show(!1),(d=(p=V.value)==null?void 0:p.fapi)==null||d.resetBtn.show(!1),(c=(_=V.value)==null?void 0:_.fapi)==null||c.disabled(!0)})):$.value=ma(o.processDefinition.formCustomViewPath),H.value=await Va(e.id)}finally{w.value=!1}},Y=async()=>{try{q.value=!0;const o=await Fa(E);v.value=[],o.forEach(e=>{e.result!==4&&v.value.push(e)}),v.value.sort((e,s)=>e.endTime&&s.endTime?s.endTime-e.endTime:e.endTime?1:s.endTime?-1:s.createTime-e.createTime),U.value=[],k.value=[],v.value.forEach(e=>{e.result===1&&e.assigneeUser&&e.assigneeUser.id===Q&&(U.value.push({...e}),k.value.push({reason:""}))})}finally{q.value=!1}};return na(()=>{F()}),(o,e)=>{const s=da,g=ya,p=ha,d=va,_=ka,c=ga,K=fa,L=Ca,Z=ia("form-create"),aa=xa,O=pa;return m(),b(aa,null,{default:r(()=>[(m(!0),R(ca,null,_a(a(U),(y,u)=>S((m(),b(L,{key:u,class:"box-card"},{header:r(()=>[P("span",A,"\u5BA1\u6279\u4EFB\u52A1\u3010"+T(y.name)+"\u3011",1)]),default:r(()=>[t(K,{offset:6,span:16},{default:r(()=>[t(d,{ref_for:!0,ref:"form"+u,model:a(k)[u],rules:a(W),"label-width":"100px"},{default:r(()=>[a(l)&&a(l).name?(m(),b(s,{key:0,label:"\u6D41\u7A0B\u540D"},{default:r(()=>[f(T(a(l).name),1)]),_:1})):D("",!0),a(l)&&a(l).startUser?(m(),b(s,{key:1,label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA"},{default:r(()=>[f(T(a(l).startUser.nickname)+" ",1),t(g,{size:"small",type:"info"},{default:r(()=>[f(T(a(l).startUser.deptName),1)]),_:1})]),_:1})):D("",!0),t(s,{label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason"},{default:r(()=>[t(p,{modelValue:a(k)[u].reason,"onUpdate:modelValue":i=>a(k)[u].reason=i,placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u5EFA\u8BAE",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model","rules"]),P("div",B,[t(c,{type:"success",onClick:i=>I(y,!0)},{default:r(()=>[t(_,{icon:"ep:select"}),f(" \u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(c,{type:"danger",onClick:i=>I(y,!1)},{default:r(()=>[t(_,{icon:"ep:close"}),f(" \u4E0D\u901A\u8FC7 ")]),_:2},1032,["onClick"]),t(c,{type:"primary",onClick:i=>{return h=y.id,void N.value.open(h);var h}},{default:r(()=>[t(_,{icon:"ep:edit"}),f(" \u8F6C\u529E ")]),_:2},1032,["onClick"]),t(c,{type:"primary",onClick:i=>(async h=>{x.error("\u6682\u4E0D\u652F\u6301\u3010\u59D4\u6D3E\u3011\u529F\u80FD\uFF0C\u53EF\u4EE5\u4F7F\u7528\u3010\u8F6C\u6D3E\u3011\u66FF\u4EE3\uFF01")})()},{default:r(()=>[t(_,{icon:"ep:position"}),f(" \u59D4\u6D3E ")]),_:2},1032,["onClick"]),t(c,{type:"warning",onClick:i=>(async h=>{x.error("\u6682\u4E0D\u652F\u6301\u3010\u9000\u56DE\u3011\u529F\u80FD\uFF01")})()},{default:r(()=>[t(_,{icon:"ep:back"}),f(" \u56DE\u9000 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[O,a(w)]])),128)),S((m(),b(L,{class:"box-card"},{header:r(()=>[P("span",j,"\u7533\u8BF7\u4FE1\u606F\u3010"+T(a(l).name)+"\u3011",1)]),default:r(()=>{var y,u,i,h;return[((u=(y=a(l))==null?void 0:y.processDefinition)==null?void 0:u.formType)===10?(m(),b(K,{key:0,offset:6,span:16},{default:r(()=>[t(Z,{ref_key:"fApi",ref:V,modelValue:a(C).value,"onUpdate:modelValue":e[0]||(e[0]=ea=>a(C).value=ea),option:a(C).option,rule:a(C).rule},null,8,["modelValue","option","rule"])]),_:1})):D("",!0),((h=(i=a(l))==null?void 0:i.processDefinition)==null?void 0:h.formType)===20?(m(),R("div",z,[t(a($),{id:a(l).businessKey},null,8,["id"])])):D("",!0)]}),_:1})),[[O,a(w)]]),t(Na,{loading:a(q),tasks:a(v)},null,8,["loading","tasks"]),t(Ha,{id:`${a(E)}`,"bpmn-xml":a(H),loading:a(w),"process-instance":a(l),tasks:a(v)},null,8,["id","bpmn-xml","loading","process-instance","tasks"]),t(ja,{ref_key:"taskUpdateAssigneeFormRef",ref:N,onSuccess:F},null,512)]),_:1})}}})});export{Za as __tla,G as default};
