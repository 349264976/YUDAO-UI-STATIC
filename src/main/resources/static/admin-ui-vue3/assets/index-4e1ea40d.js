import{_ as e}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as t}from"./Descriptions-8db90f03.js";import{_ as i}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as s}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as r}from"./XTextButton-ab77381a.js";import{_ as o}from"./XButton-39866472.js";import{D as a}from"./dict-3e42505d.js";import{u as l}from"./useVxeCrudSchemas-8bec068b.js";import{A as p,d as n,r as m,Q as u,o as c,i as d,l as _,w as j,f,e as g,t as x,b as y,a as T,h,M as v,F as S}from"./runtime-core.esm-bundler-ccc21fcd.js";import{a as b}from"./index-a7ef0ded.js";import{I}from"./constants-97c4dd5f.js";import{u as C}from"./useI18n-56d4bc42.js";import{u as w}from"./useMessage-5e709b20.js";import{u as k}from"./useXTable-bf420a68.js";import"./base-085523fd.js";/* empty css                     */import"./propTypes-5cfdbdab.js";import"./index-be3181b1.js";import"./aria-8fadfbe9.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./el-notification-c7d5f4ea.js";import"./el-button-6b012e5e.js";import"./index-4665dced.js";import"./index-c2caee16.js";import"./is-a7957d81.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";/* empty css               */import"./index-795de047.js";import"./el-tooltip-4ed993c7.js";/* empty css                  */import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./dayjs.min-65a6b1e4.js";import"./useCache-d48cf6c5.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./index-7486e100.js";import"./index-183fdc84.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./el-card-d8ab0074.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-6f87c872.js";import"./auth-2fa258a0.js";import"./vue-router-0864a153.js";import"./cloneDeep-8298b498.js";import"./_flatRest-ac7abae6.js";const R=p({primaryKey:"id",primaryType:"seq",primaryTitle:"日志编号",action:!0,actionWidth:"300",columns:[{title:"链路追踪",field:"traceId",isTable:!1},{title:"用户编号",field:"userId",isSearch:!0},{title:"用户类型",field:"userType",dictType:a.USER_TYPE,isSearch:!0},{title:"应用名",field:"applicationName",isSearch:!0},{title:"请求方法名",field:"requestMethod"},{title:"请求地址",field:"requestUrl",isSearch:!0},{title:"异常发生时间",field:"exceptionTime",formatter:"formatDate",search:{show:!0,itemRender:{name:"XDataTimePicker"}}},{title:"异常名",field:"exceptionName"},{title:"处理状态",field:"processStatus",dictType:a.INFRA_API_ERROR_LOG_PROCESS_STATUS,dictClass:"number",isSearch:!0},{title:"处理人",field:"processUserId",isTable:!1},{title:"处理时间",field:"processTime",formatter:"formatDate",isTable:!1}]}),{allSchemas:D}=l(R),A=e=>b.get({url:"/infra/api-error-log/page",params:e}),E=e=>b.download({url:"/infra/api-error-log/export-excel",params:e}),N=n({name:"ApiErrorLog"}),X=n({...N,setup(a){const{t:l}=C(),p=w(),[n,{reload:R,exportList:N}]=k({allSchemas:D,getListApi:A,exportListApi:E}),X=m(),q=m(!1),L=m(""),M=(e,t,i)=>{p.confirm("确认标记为"+i+"?",l("common.reminder")).then((async()=>{var i,s;await(i=e.id,s=t,b.put({url:"/infra/api-error-log/update-status?id="+i+"&processStatus="+s})),p.success(l("common.updateSuccess"))})).finally((async()=>{await R()})).catch((()=>{}))};return(a,p)=>{const m=o,b=r,C=s,w=i,k=t,R=e,A=u("hasPermi");return c(),d(S,null,[_(w,null,{default:j((()=>[_(C,{onRegister:f(n)},{toolbar_buttons:j((()=>[_(m,{type:"warning",preIcon:"ep:download",title:f(l)("action.export"),onClick:p[0]||(p[0]=e=>f(N)("错误数据.xls"))},null,8,["title"])])),duration_default:j((({row:e})=>[g("span",null,x(e.duration+"ms"),1)])),resultCode_default:j((({row:e})=>[g("span",null,x(0===e.resultCode?"成功":"失败("+e.resultMsg+")"),1)])),actionbtns_default:j((({row:e})=>[y(_(b,{preIcon:"ep:view",title:f(l)("action.detail"),onClick:t=>(e=>{X.value=e,L.value=l("action.detail"),q.value=!0})(e)},null,8,["title","onClick"]),[[A,["infra:api-access-log:query"]]]),e.processStatus===f(I).INIT?y((c(),T(b,{key:0,preIcon:"ep:cpu",title:"已处理",onClick:t=>M(e,f(I).DONE,"已处理")},null,8,["onClick"])),[[A,["infra:api-error-log:update-status"]]]):h("",!0),e.processStatus===f(I).INIT?y((c(),T(b,{key:1,preIcon:"ep:mute-notification",title:"已忽略",onClick:t=>M(e,f(I).IGNORE,"已忽略")},null,8,["onClick"])),[[A,["infra:api-error-log:update-status"]]]):h("",!0)])),_:1},8,["onRegister"])])),_:1}),_(R,{modelValue:f(q),"onUpdate:modelValue":p[2]||(p[2]=e=>v(q)?q.value=e:null),title:f(L)},{footer:j((()=>[_(m,{title:f(l)("dialog.close"),onClick:p[1]||(p[1]=e=>q.value=!1)},null,8,["title"])])),default:j((()=>[_(k,{schema:f(D).detailSchema,data:f(X)},null,8,["schema","data"])])),_:1},8,["modelValue","title"])],64)}}});export{X as default};
