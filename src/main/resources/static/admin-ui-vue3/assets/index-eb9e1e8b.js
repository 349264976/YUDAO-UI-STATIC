import"./base-085523fd.js";import{a as e,E as t}from"./el-form-item-8022b942.js";import{E as a}from"./el-notification-c7d5f4ea.js";import{j as l}from"./Form.vue_vue_type_style_index_0_scoped_f983cb9f_lang-54d674bd.js";import{_ as i}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as o}from"./Descriptions-8db90f03.js";import{_ as s}from"./Form-a0e23abc.js";import{_ as r}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as m}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as p}from"./XTextButton-ab77381a.js";import{_ as n}from"./XButton-39866472.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{r as u}from"./formRules-a3380b28.js";import{D as d}from"./dict-3e42505d.js";import{u as c}from"./useVxeCrudSchemas-8bec068b.js";import{A as j,d as _,r as f,x as v,Q as y,o as g,i as b,l as h,w as k,f as x,a as w,F as C,z as I,b as V,e as T,t as P,h as S,M}from"./runtime-core.esm-bundler-ccc21fcd.js";import{a as U}from"./index-a7ef0ded.js";import{b as D}from"./index-aee95b75.js";import{u as R}from"./useI18n-56d4bc42.js";import{u as X}from"./useMessage-5e709b20.js";import{u as q}from"./useXTable-bf420a68.js";import{a as E,E as F}from"./index-168f367d.js";import"./index-c2caee16.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./aria-8fadfbe9.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./el-button-6b012e5e.js";import"./is-a7957d81.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";import"./el-row-ad412a39.js";import"./el-col-613bea3c.js";import"./el-tooltip-4ed993c7.js";import"./el-checkbox-cd7dd8c1.js";import"./isEqual-6e1d5dd6.js";import"./_flatRest-ac7abae6.js";import"./el-radio-group-d1c0e064.js";import"./el-input-number-4fe7018b.js";import"./el-tree-39cab679.js";import"./index-183fdc84.js";import"./el-tree-select-6f481715.js";import"./el-switch-4b318cc1.js";/* empty css                   */import"./InputPassword-d0077663.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./propTypes-5cfdbdab.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./el-message-7ddf9388.js";import"./auth-2fa258a0.js";import"./useCache-d48cf6c5.js";import"./el-image-viewer-f62c5b85.js";import"./debounce-eb6bb100.js";import"./el-progress-64245232.js";import"./index-cf52a0ab.js";import"./index-be3181b1.js";import"./index-7486e100.js";import"./strings-777507ad.js";import"./index-795de047.js";import"./index-9d88d8a4.js";import"./dayjs.min-65a6b1e4.js";import"./isArrayLikeObject-26c677c4.js";import"./index-653de86a.js";/* empty css                        *//* empty css                                                                   *//* empty css                    */import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";import"./app-41ac77cd.js";import"./el-card-d8ab0074.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-6f87c872.js";import"./vue-router-0864a153.js";const A=j({name:[u],code:[u],accountId:[u],title:[u],content:[u],params:[u],status:[u]}),B=j({primaryKey:"id",primaryTitle:"编号",primaryType:null,action:!0,actionWidth:"260",columns:[{title:"模板编码",field:"code",isSearch:!0},{title:"模板名称",field:"name",isSearch:!0},{title:"模板标题",field:"title"},{title:"模板内容",field:"content",form:{component:"Editor",colProps:{span:24},componentProps:{valueHtml:""}}},{title:"邮箱账号",field:"accountId",isSearch:!0,table:{width:200,slots:{default:"accountId_default"}},search:{slots:{default:"accountId_search"}}},{title:"发送人名称",field:"nickname"},{title:"开启状态",field:"status",isSearch:!0,dictType:d.COMMON_STATUS,dictClass:"number"},{title:"备注",field:"remark",isTable:!1},{title:"创建时间",field:"createTime",isForm:!1,formatter:"formatDate",table:{width:180},search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:O}=c(B),z=async e=>await U.get({url:"/system/mail-template/page",params:e}),L=async e=>await U.get({url:"/system/mail-template/get?id="+e}),W=async e=>await U.delete({url:"/system/mail-template/delete?id="+e}),K=_({name:"MailTemplate"}),N=_({...K,setup(u){const{t:d}=R(),c=X(),_=j({accountId:null}),[B,{reload:K,deleteData:N}]=q({allSchemas:O,params:_,getListApi:z,deleteApi:W}),Q=f([]),H=f(!1),J=f("edit"),Y=f(!1),Z=f(""),$=f(!1),G=f(),ee=f(),te=e=>{Y.value=!0,J.value=d("action."+e),Z.value=e,H.value=!0},ae=async()=>{var e;const t=null==(e=x(G))?void 0:e.getElFormRef();t&&t.validate((async e=>{var t;if(e){$.value=!0;try{const e=null==(t=x(G))?void 0:t.formModel;"create"===Z.value?(await(async e=>await U.post({url:"/system/mail-template/create",data:e}))(e),c.success(d("common.createSuccess"))):(await(async e=>await U.put({url:"/system/mail-template/update",data:e}))(e),c.success(d("common.updateSuccess"))),H.value=!1}finally{$.value=!1,await K()}}}))},le=f({content:"",params:{},mail:"",templateCode:"",templateParams:{}}),ie=f({mail:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),oe=f(!1),se=async()=>{const e={mail:le.value.mail,templateCode:le.value.templateCode,templateParams:le.value.templateParams},t=await(e=>U.post({url:"/system/mail-template/send-mail",data:e}))(e);t&&c.success("提交发送成功！发送结果，见发送日志编号："+t),oe.value=!1};return v((()=>{D().then((e=>{Q.value=e}))})),(u,c)=>{const j=E,f=F,v=n,U=p,D=m,R=r,X=s,q=o,z=i,W=l,K=e,re=a,me=t,pe=y("hasPermi");return g(),b(C,null,[h(R,null,{default:k((()=>[h(D,{onRegister:x(B)},{accountId_search:k((()=>[h(f,{modelValue:x(_).accountId,"onUpdate:modelValue":c[0]||(c[0]=e=>x(_).accountId=e)},{default:k((()=>[(g(),w(j,{key:void 0,label:"全部",value:void 0})),(g(!0),b(C,null,I(x(Q),(e=>(g(),w(j,{key:e.id,label:e.mail,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),toolbar_buttons:k((()=>[V(h(v,{type:"primary",preIcon:"ep:zoom-in",title:x(d)("action.add"),onClick:c[1]||(c[1]=e=>(te("create"),void(Y.value=!1)))},null,8,["title"]),[[pe,["system:mail-template:create"]]])])),accountId_default:k((({row:e})=>{var t;return[T("span",null,P(null==(t=x(Q).find((t=>t.id===e.accountId)))?void 0:t.mail),1)]})),actionbtns_default:k((({row:e})=>[V(h(U,{preIcon:"ep:cpu",title:x(d)("action.test"),onClick:t=>(e=>{le.value.content=e.content,le.value.params=e.params,le.value.templateCode=e.code,le.value.templateParams=e.params.reduce((function(e,t){return e[t]=void 0,e}),{}),ie.value.templateParams=e.params.reduce((function(e,t){return e[t]={required:!0,message:"参数 "+t+" 不能为空",trigger:"change"},e}),{}),oe.value=!0})(e)},null,8,["title","onClick"]),[[pe,["system:mail-template:send-mail"]]]),V(h(U,{preIcon:"ep:edit",title:x(d)("action.edit"),onClick:t=>(async e=>{var t;te("update");const a=await L(e);null==(t=x(G))||t.setValues(a),Y.value=!1})(e.id)},null,8,["title","onClick"]),[[pe,["system:mail-template:update"]]]),V(h(U,{preIcon:"ep:view",title:x(d)("action.detail"),onClick:t=>(async e=>{te("detail");const t=await L(e);ee.value=t,Y.value=!1})(e.id)},null,8,["title","onClick"]),[[pe,["system:mail-template:query"]]]),V(h(U,{preIcon:"ep:delete",title:x(d)("action.del"),onClick:t=>x(N)(e.id)},null,8,["title","onClick"]),[[pe,["system:mail-template:delete"]]])])),_:1},8,["onRegister"])])),_:1}),h(z,{id:"mailTemplateModel",loading:x(Y),modelValue:x(H),"onUpdate:modelValue":c[4]||(c[4]=e=>M(H)?H.value=e:null),title:x(J)},{footer:k((()=>[["create","update"].includes(x(Z))?(g(),w(v,{key:0,type:"primary",title:x(d)("action.save"),loading:x($),onClick:c[2]||(c[2]=e=>ae())},null,8,["title","loading"])):S("",!0),h(v,{loading:x($),title:x(d)("dialog.close"),onClick:c[3]||(c[3]=e=>H.value=!1)},null,8,["loading","title"])])),default:k((()=>[["create","update"].includes(x(Z))?(g(),w(X,{key:0,ref_key:"formRef",ref:G,schema:x(O).formSchema,rules:x(A)},{accountId:k((e=>[h(f,{modelValue:e.accountId,"onUpdate:modelValue":t=>e.accountId=t},{default:k((()=>[(g(!0),b(C,null,I(x(Q),(e=>(g(),w(j,{key:e.id,label:e.mail,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["schema","rules"])):S("",!0),"detail"===x(Z)?(g(),w(q,{key:1,schema:x(O).detailSchema,data:x(ee)},null,8,["schema","data"])):S("",!0)])),_:1},8,["loading","modelValue","title"]),h(z,{id:"sendTest",modelValue:x(oe),"onUpdate:modelValue":c[8]||(c[8]=e=>M(oe)?oe.value=e:null),title:"测试"},{footer:k((()=>[h(v,{type:"primary",title:x(d)("action.test"),loading:x($),onClick:c[6]||(c[6]=e=>se())},null,8,["title","loading"]),h(v,{title:x(d)("dialog.close"),onClick:c[7]||(c[7]=e=>oe.value=!1)},null,8,["title"])])),default:k((()=>[h(me,{model:x(le),rules:x(ie),"label-width":"200px","label-position":"top"},{default:k((()=>[h(K,{label:"模板内容",prop:"content"},{default:k((()=>[h(W,{"model-value":x(le).content,readonly:"",height:"150px"},null,8,["model-value"])])),_:1}),h(K,{label:"收件邮箱",prop:"mail"},{default:k((()=>[h(re,{modelValue:x(le).mail,"onUpdate:modelValue":c[5]||(c[5]=e=>x(le).mail=e),placeholder:"请输入收件邮箱"},null,8,["modelValue"])])),_:1}),(g(!0),b(C,null,I(x(le).params,(e=>(g(),w(K,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:k((()=>[h(re,{modelValue:x(le).templateParams[e],"onUpdate:modelValue":t=>x(le).templateParams[e]=t,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}});export{N as default};
