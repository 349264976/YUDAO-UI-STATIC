import{ab as q,d as F,r as u,f as C,A as Q,o as p,q as G,w as M,g as y,B as P,a as t,c as f,a1 as k,i as S,x as J,j as K,a9 as A,H as X,L as Y,$ as Z,a0 as aa,__tla as ea}from"./index-0f589822.js";import{_ as ta,__tla as la}from"./ContentWrap.vue_vue_type_script_setup_true_lang-0f1e3633.js";import{R as B,__tla as sa}from"./TabNews-4157ed58.js";import ra,{__tla as ua}from"./main-7b6b34f8.js";import ca,{__tla as na}from"./MsgList-44a2e568.js";import{g as oa,__tla as ia}from"./index-8bac1953.js";import{u as _a,__tla as pa}from"./useMessage-45ab706e.js";import{_ as ma}from"./_plugin-vue_export-helper-1b428a4d.js";let w,N,D,va=Promise.all([(()=>{try{return ea}catch{}})(),(()=>{try{return la}catch{}})(),(()=>{try{return sa}catch{}})(),(()=>{try{return ua}catch{}})(),(()=>{try{return na}catch{}})(),(()=>{try{return ia}catch{}})(),(()=>{try{return pa}catch{}})()]).then(async()=>{let h,x,z,j,T,H;N=c=>q.get({url:"/mp/message/page",params:c}),h=c=>(Z("data-v-690996b2"),c=c(),aa(),c),x={key:0},z=[h(()=>y("span",{class:"el-table__empty-text"},"\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A",-1))],j={key:1,class:"el-table__empty-block"},T=[h(()=>y("span",{class:"el-table__empty-text"},"\u6CA1\u6709\u66F4\u591A\u4E86",-1))],H={class:"msg-send"},w=ma(F({name:"WxMsg",__name:"main",props:{userId:{type:Number,required:!0}},setup(c){const b=c,L=_a(),m=u(-1),v=u(!1),I=u(!0),_=u([]),n=C({pageNo:1,pageSize:14,accountId:m}),i=C({nickname:"\u7528\u6237",avatar:"/admin-ui-vue3/assets/profile-61ae42a9.jpg",accountId:m}),V=u(!1),e=u({type:B.Text,accountId:-1,articles:[]}),O=u(null),s=u(null);Q(async()=>{var l,r;const a=await oa(b.userId);i.nickname=((l=a.nickname)==null?void 0:l.length)>0?a.nickname:i.nickname,i.avatar=((r=i.avatar)==null?void 0:r.length)>0?a.avatar:i.avatar,m.value=a.accountId,e.value.accountId=a.accountId,E()});const U=async()=>{var l;if(!t(e))return;e.value.type===B.News&&e.value.articles&&e.value.articles.length>1&&(e.value.articles=[e.value.articles[0]],L.success("\u56FE\u6587\u6D88\u606F\u6761\u6570\u9650\u5236\u5728 1 \u6761\u4EE5\u5185\uFF0C\u5DF2\u9ED8\u8BA4\u53D1\u9001\u7B2C\u4E00\u6761"));const a=await(r=>q.post({url:"/mp/message/send",data:r}))({userId:b.userId,...e.value});V.value=!1,_.value=[..._.value,a],await W(),(l=O.value)==null||l.clear()},$=()=>{n.pageNo++,R(n,null)},R=async(a,l=null)=>{var g;v.value=!0;let r=await N(Object.assign({pageNo:a.pageNo,pageSize:a.pageSize,userId:b.userId,accountId:a.accountId},l));const d=((g=s.value)==null?void 0:g.scrollHeight)??0,o=r.list.reverse();_.value=[...o,..._.value],v.value=!1,(o.length<n.pageSize||o.length===0)&&(I.value=!1),n.pageNo=a.pageNo,n.pageSize=a.pageSize,n.pageNo===1?await W():o.length!==0&&(await A(),d!==0&&s.value&&(s.value.scrollTop=s.value.scrollHeight-d-100))},E=()=>{R(n)},W=async()=>{await A(),s.value&&(s.value.scrollTop=s.value.scrollHeight)};return(a,l)=>{const r=X,d=ta,o=Y;return p(),G(d,null,{default:M(()=>[y("div",{class:"msg-div",ref_key:"msgDivRef",ref:s},[P(y("div",null,null,512),[[o,t(v)]]),t(v)?k("",!0):(p(),f("div",x,[t(I)?(p(),f("div",{key:0,class:"el-table__empty-block",onClick:$},z)):k("",!0),t(I)?k("",!0):(p(),f("div",j,T))])),S(ca,{list:t(_),"account-id":t(m),user:t(i)},null,8,["list","account-id","user"])],512),P((p(),f("div",H,[S(t(ra),{ref_key:"replySelectRef",ref:O,modelValue:t(e),"onUpdate:modelValue":l[0]||(l[0]=g=>J(e)?e.value=g:null)},null,8,["modelValue"]),S(r,{type:"success",class:"send-but",onClick:U},{default:M(()=>[K("\u53D1\u9001(S)")]),_:1})])),[[o,t(V)]])]),_:1})}}}),[["__scopeId","data-v-690996b2"]]),D=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"}))});export{w as W,va as __tla,N as g,D as m};
