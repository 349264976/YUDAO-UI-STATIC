import{_ as q,__tla as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-0f1e3633.js";import{i as N,a as D,b as l,c as K,d as z,f as H,e as J,g as Q,P as B,_ as W,h as Y,__tla as Z}from"./bpmn-embedded-1e1b15cf.js";import{g as ee,u as te,c as ne,__tla as ae}from"./index-43231948.js";import{d as oe,u as ie,N as ce,r as S,A as re,o as L,q as G,w as se,a as f,a2 as pe,x as le,a1 as me,i as de,__tla as ue}from"./index-0f589822.js";import{u as be,__tla as ve}from"./useMessage-45ab706e.js";import{__tla as _e}from"./el-card-bbdd700f.js";import{__tla as he}from"./Dialog.vue_vue_type_style_index_0_lang-2d188c85.js";import{__tla as fe}from"./XTextButton-f2bb1cf5.js";import"./_plugin-vue_export-helper-1b428a4d.js";import{__tla as ge}from"./XButton-ceeece05.js";import{__tla as ye}from"./el-link-932c772d.js";import{__tla as Ee}from"./el-drawer-6328bc2e.js";import{__tla as xe}from"./dict-f9a1a53b.js";import{__tla as ke}from"./formatTime-58783104.js";let O,Ce=Promise.all([(()=>{try{return X}catch{}})(),(()=>{try{return Z}catch{}})(),(()=>{try{return ae}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return ve}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return he}catch{}})(),(()=>{try{return fe}catch{}})(),(()=>{try{return ge}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return Ee}catch{}})(),(()=>{try{return xe}catch{}})(),(()=>{try{return ke}catch{}})()]).then(async()=>{function I(n){return n.originalEvent||n.srcEvent}function U(n){return function(i,c){return(I(i)||i).button===c}(n,0)}function V(n){var i=I(n)||n;return!!U(n)&&(/mac/i.test(navigator.platform)?i.metaKey:i.ctrlKey)}function A(n,i,c,s,p,_,u,o,b,g,a,e){n=n||{},s.registerProvider(this),this._contextPad=s,this._modeling=p,this._elementFactory=_,this._connect=u,this._create=o,this._popupMenu=b,this._canvas=g,this._rules=a,this._translate=e,n.autoPlace!==!1&&(this._autoPlace=i.get("autoPlace",!1)),c.on("create.end",250,function(t){const d=t.context.shape;if(!V(t)||!s.isOpen(d))return;const r=s.getEntries(d);r.replace&&r.replace.action.click(t,d)})}function R(n,i,c){const s=n.$instanceOf(i);let p=!1;const _=n.eventDefinitions||[];return H(_,function(u){u.$type===c&&(p=!0)}),s&&p}A.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],A.prototype.getContextPadEntries=function(n){const i=this._contextPad,c=this._modeling,s=this._elementFactory,p=this._connect,_=this._create,u=this._popupMenu,o=this._canvas,b=this._rules,g=this._autoPlace,a=this._translate,e={};if(n.type==="label")return e;const t=n.businessObject;function d(v,h){p.start(v,h)}function r(v,h,m,C){function T(w,E){const P=s.createShape(l({type:v},C));_.start(w,P,{source:E})}return typeof m!="string"&&(C=m,m=a("Append {type}",{type:v.replace(/^bpmn:/,"")})),{group:"model",className:h,title:m,action:{dragstart:T,click:g?function(w,E){const P=s.createShape(l({type:v},C));g.append(E,P)}:T}}}function x(v){return function(h,m){c.splitLane(m,v),i.open(m,!0)}}if(N(t,["bpmn:Lane","bpmn:Participant"])&&J(t)){const v=Q(n);l(e,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:a("Add Lane above"),action:{click:function(h,m){c.addLane(m,"top")}}}}),v.length<2&&(n.height>=120&&l(e,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:a("Divide into two Lanes"),action:{click:x(2)}}}),n.height>=180&&l(e,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:a("Divide into three Lanes"),action:{click:x(3)}}})),l(e,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:a("Add Lane below"),action:{click:function(h,m){c.addLane(m,"bottom")}}}})}D(t,"bpmn:FlowNode")&&(D(t,"bpmn:EventBasedGateway")?l(e,{"append.receive-task":r("bpmn:ReceiveTask","bpmn-icon-receive-task",a("Append ReceiveTask")),"append.message-intermediate-event":r("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",a("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":r("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",a("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":r("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",a("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":r("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",a("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):R(t,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?l(e,{"append.compensation-activity":r("bpmn:Task","bpmn-icon-task",a("Append compensation activity"),{isForCompensation:!0})}):D(t,"bpmn:EndEvent")||t.isForCompensation||R(t,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||K(t)||l(e,{"append.end-event":r("bpmn:EndEvent","bpmn-icon-end-event-none",a("Append EndEvent")),"append.gateway":r("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",a("Append Gateway")),"append.append-task":r("bpmn:UserTask","bpmn-icon-user-task",a("Append Task")),"append.intermediate-event":r("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",a("Append Intermediate/Boundary Event"))})),u.isEmpty(n,"bpmn-replace")||l(e,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"\u4FEE\u6539\u7C7B\u578B",action:{click:function(v,h){const m=l(function(C){const T=o.getContainer(),F=i.getPad(C).html,w=T.getBoundingClientRect(),E=F.getBoundingClientRect(),P=E.top-w.top;return{x:E.left-w.left,y:P+E.height+5}}(h),{cursor:{x:v.x,y:v.y}});u.open(h,"bpmn-replace",m)}}}}),N(t,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&l(e,{"append.text-annotation":r("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a("Connect using "+(t.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:d,dragstart:d}}}),N(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&l(e,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a("Connect using DataInputAssociation"),action:{click:d,dragstart:d}}}),D(t,"bpmn:Group")&&l(e,{"append.text-annotation":r("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let y=b.allowed("elements.delete",{elements:[n]});return z(y)&&(y=y[0]===n),y&&l(e,{delete:{group:"edit",className:"bpmn-icon-trash",title:a("Remove"),action:{click:function(){c.removeElements([n])}}}}),e};const $={__init__:["contextPadProvider"],contextPadProvider:["type",A]};function k(n,i,c,s,p,_,u,o){B.call(this,n,i,c,s,p,_,u,o,2e3)}const M=function(){};(M.prototype=B.prototype).getPaletteEntries=function(){const n={},i=this._create,c=this._elementFactory,s=this._spaceTool,p=this._lassoTool,_=this._handTool,u=this._globalConnect,o=this._translate;function b(e,t,d,r,x){function y(h){const m=c.createShape(l({type:e},x));x&&(m.businessObject.di.isExpanded=x.isExpanded),i.start(h,m)}const v=e.replace(/^bpmn:/,"");return{group:t,className:d,title:r||o("Create {type}",{type:v}),action:{dragstart:y,click:y}}}function g(e){const t=c.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),d=c.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:t});i.start(e,[t,d],{hints:{autoSelect:[d]}})}function a(e){i.start(e,c.createParticipantShape())}return l(n,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"\u6FC0\u6D3B\u6293\u624B\u5DE5\u5177",action:{click:function(e){_.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:o("Activate the lasso tool"),action:{click:function(e){p.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:o("Activate the create/remove space tool"),action:{click:function(e){s.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:o("Activate the global connect tool"),action:{click:function(e){u.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":b("bpmn:StartEvent","event","bpmn-icon-start-event-none",o("Create StartEvent")),"create.intermediate-event":b("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",o("Create Intermediate/Boundary Event")),"create.end-event":b("bpmn:EndEvent","event","bpmn-icon-end-event-none",o("Create EndEvent")),"create.exclusive-gateway":b("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",o("Create Gateway")),"create.user-task":b("bpmn:UserTask","activity","bpmn-icon-user-task",o("Create User Task")),"create.data-object":b("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",o("Create DataObjectReference")),"create.data-store":b("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",o("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:o("Create expanded SubProcess"),action:{dragstart:g,click:g}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:o("Create Pool/Participant"),action:{dragstart:a,click:a}},"create.group":b("bpmn:Group","artifact","bpmn-icon-group",o("Create Group"))}),n},k.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],k.prototype=new M,k.prototype.constructor=k;let j;j={__init__:["paletteProvider"],paletteProvider:["type",k]},O=oe({name:"BpmModelEditor",__name:"index",setup(n){const i=ie(),{query:c}=ce(),s=be(),p=S(void 0),_=S(null),u=S({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[$,j]}),o=S(),b=e=>{setTimeout(()=>{_.value=e},10)},g=async e=>{const t={...o.value,bpmnXml:e};t.id?(await te(t),s.success("\u4FEE\u6539\u6210\u529F")):(await ne(t),s.success("\u65B0\u589E\u6210\u529F")),a()},a=()=>{i.push({path:"/bpm/manager/model"})};return re(async()=>{const e=c.modelId;if(!e)return void s.error("\u7F3A\u5C11\u6A21\u578B modelId \u7F16\u53F7");const t=await ee(e);p.value=t.bpmnXml,o.value={...t,bpmnXml:void 0}}),(e,t)=>{const d=q;return L(),G(d,null,{default:se(()=>[f(p)!==void 0?(L(),G(f(W),pe({key:"designer",modelValue:f(p),"onUpdate:modelValue":t[0]||(t[0]=r=>le(p)?p.value=r:null),value:f(p)},f(u),{keyboard:"",ref:"processDesigner",onInitFinished:b,additionalModel:f(u).additionalModel,onSave:g}),null,16,["modelValue","value","additionalModel"])):me("",!0),de(f(Y),{key:"penal",bpmnModeler:f(_),prefix:f(u).prefix,class:"process-panel",model:f(o)},null,8,["bpmnModeler","prefix","model"])]),_:1})}}})});export{Ce as __tla,O as default};
