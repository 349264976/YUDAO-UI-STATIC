import"./base-085523fd.js";import{E as e}from"./el-progress-64245232.js";import{_ as t}from"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import{_ as i}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as o}from"./Descriptions-8db90f03.js";import{E as r}from"./el-image-fc4d5a67.js";import"./el-image-viewer-f62c5b85.js";import{_ as l}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as a}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as s}from"./XTextButton-ab77381a.js";import{_ as p}from"./XButton-39866472.js";import{u as m}from"./useI18n-56d4bc42.js";import{u as n}from"./useVxeCrudSchemas-8bec068b.js";import{A as u,d as c,r as d,Q as f,o as j,i as _,l as g,w as v,f as y,b as h,a as x,e as b,t as k,M as w,F as C,k as T}from"./runtime-core.esm-bundler-ccc21fcd.js";import{a as S}from"./index-a7ef0ded.js";import{g as V,a as X}from"./auth-2fa258a0.js";import{h as D}from"./aria-8fadfbe9.js";import{u as I}from"./useMessage-5e709b20.js";import{u as R}from"./useXTable-bf420a68.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-c2caee16.js";import"./el-notification-c7d5f4ea.js";import"./el-button-6b012e5e.js";import"./index-4665dced.js";import"./is-a7957d81.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";import"./propTypes-5cfdbdab.js";/* empty css                     */import"./index-be3181b1.js";import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";/* empty css               */import"./dict-3e42505d.js";import"./useCache-d48cf6c5.js";import"./index-795de047.js";import"./el-tooltip-4ed993c7.js";/* empty css                  */import"./dayjs.min-65a6b1e4.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./index-7486e100.js";import"./index-183fdc84.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./debounce-eb6bb100.js";import"./el-card-d8ab0074.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-6f87c872.js";import"./vue-router-0864a153.js";import"./cloneDeep-8298b498.js";import"./_flatRest-ac7abae6.js";const{t:z}=m(),B=u({primaryKey:"id",primaryType:"seq",action:!0,columns:[{title:"文件名",field:"name"},{title:"文件路径",field:"path",isSearch:!0},{title:"URL",field:"url",table:{cellRender:{name:"XPreview"}}},{title:"文件大小",field:"size",formatter:"formatSize"},{title:"文件类型",field:"type",isSearch:!0},{title:z("common.createTime"),field:"createTime",formatter:"formatDate",isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:A}=n(B),E=e=>S.get({url:"/infra/file/page",params:e}),F=e=>S.delete({url:"/infra/file/delete?id="+e}),M=b("div",{class:"el-upload__text"},[T("将文件拖到此处，或"),b("em",null,"点击上传")],-1),P=b("div",{class:"el-upload__tip"},"请上传 .jpg, .png, .gif 标准格式文件",-1),L=c({name:"FileList"}),U=c({...L,setup(n){const{t:u}=m(),c=I(),[T,{reload:S,deleteData:z}]=R({allSchemas:A,getListApi:E,deleteApi:F}),B=d(),L=d(!1),U=d(""),q=d(!1),K=d("上传"),Q=d(0),W=d(!1),Y=d();const Z=d(),$=e=>{const t="image/jpeg"===e.type||"image/gif",i=e.size/1024/1024<5;return t||c.error("上传文件只能是 jpeg / gif / png 格式!"),i||c.error("上传文件大小不能超过 5MB!"),t&&i},G=async e=>{0===e.code?(c.success("上传成功"),q.value=!1,W.value=!1,await S()):c.error(e.msg)},H=()=>{c.error("最多只能上传一个文件！")},J=()=>{c.error("导入数据失败，请您重新上传！")};return(m,n)=>{const d=p,S=s,I=a,R=l,E=r,F=o,N=i,O=t,ee=e,te=f("hasPermi");return j(),_(C,null,[g(R,null,{default:v((()=>[g(I,{onRegister:y(T)},{toolbar_buttons:v((()=>[g(d,{type:"primary",preIcon:"ep:upload",title:"上传文件",onClick:n[0]||(n[0]=e=>q.value=!0)})])),actionbtns_default:v((({row:e})=>[g(S,{preIcon:"ep:copy-document",title:y(u)("common.copy"),onClick:t=>(async e=>{const{copy:t,copied:i,isSupported:o}=D({source:e});o?(await t(),y(i)&&c.success(u("common.copySuccess"))):c.error(u("common.copyError"))})(e.url)},null,8,["title","onClick"]),g(S,{preIcon:"ep:view",title:y(u)("action.detail"),onClick:t=>(e=>{B.value=e,U.value=u("action.detail"),L.value=!0})(e)},null,8,["title","onClick"]),h(g(S,{preIcon:"ep:delete",title:y(u)("action.del"),onClick:t=>y(z)(e.id)},null,8,["title","onClick"]),[[te,["infra:file:delete"]]])])),_:1},8,["onRegister"])])),_:1}),g(N,{modelValue:y(L),"onUpdate:modelValue":n[2]||(n[2]=e=>w(L)?L.value=e:null),title:y(U)},{footer:v((()=>[g(d,{title:y(u)("dialog.close"),onClick:n[1]||(n[1]=e=>L.value=!1)},null,8,["title"])])),default:v((()=>[g(F,{schema:y(A).detailSchema,data:y(B)},{url:v((({row:e})=>[(e.type,j(),x(E,{style:{width:"100px",height:"100px"},src:e.url,key:e.url,lazy:""},null,8,["src"])),b("span",null,k(e.url),1)])),_:1},8,["schema","data"])])),_:1},8,["modelValue","title"]),g(N,{modelValue:y(q),"onUpdate:modelValue":n[5]||(n[5]=e=>w(q)?q.value=e:null),title:y(K)},{footer:v((()=>[g(d,{type:"primary",preIcon:"ep:upload-filled",title:y(u)("action.save"),onClick:n[3]||(n[3]=e=>(Z.value={Authorization:"Bearer "+V(),"tenant-id":X()},W.value=!0,void Y.value.submit()))},null,8,["title"]),g(d,{title:y(u)("dialog.close"),onClick:n[4]||(n[4]=e=>q.value=!1)},null,8,["title"])])),default:v((()=>[g(ee,{ref_key:"uploadRef",ref:Y,action:y("http://localhost:48080/admin-api/infra/file/upload")+"?updateSupport="+y(Q),headers:y(Z),drag:!0,limit:1,multiple:!0,"show-file-list":!0,disabled:y(W),"before-upload":$,"on-exceed":H,"on-success":G,"on-error":J,"auto-upload":!1,accept:".jpg, .png, .gif"},{tip:v((()=>[P])),default:v((()=>[g(O,{icon:"ep:upload-filled"}),M])),_:1},8,["action","headers","disabled"])])),_:1},8,["modelValue","title"])],64)}}});export{U as default};
