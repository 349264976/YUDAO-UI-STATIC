import"./base-085523fd.js";import{b as e}from"./el-checkbox-cd7dd8c1.js";import{E as t}from"./el-progress-64245232.js";import{_ as a}from"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import{a as l,E as s}from"./el-form-item-8022b942.js";import{E as o}from"./el-notification-c7d5f4ea.js";import"./el-button-6b012e5e.js";import{i}from"./Form.vue_vue_type_style_index_0_scoped_f983cb9f_lang-54d674bd.js";import{_ as r}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as n}from"./Descriptions-8db90f03.js";/* empty css               */import{_ as d}from"./Form-a0e23abc.js";/* empty css                  *//* empty css                     *//* empty css                  */import{E as m}from"./el-tree-39cab679.js";import{E as u}from"./el-tree-select-6f481715.js";import{_ as p}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";/* empty css                        */import{E as c,a as f,b as _}from"./el-dropdown-item-446ecbdb.js";import{E as j}from"./el-switch-4b318cc1.js";import{_ as v}from"./XButton-39866472.js";import{E as y}from"./el-card-d8ab0074.js";import{_ as h}from"./XTextButton-ab77381a.js";import{d as g,h as w}from"./tree-150ed6f6.js";import{d as x}from"./download-20922b56.js";import{C as b}from"./constants-97c4dd5f.js";import{g as k,a as I}from"./auth-2fa258a0.js";import{u as V}from"./useI18n-56d4bc42.js";import{r as C}from"./formRules-a3380b28.js";import{D as E}from"./dict-3e42505d.js";import{u as S}from"./useVxeCrudSchemas-8bec068b.js";import{A as T,d as U,r as A,m as B,x as D,Q as L,o as N,i as R,e as F,l as M,w as O,f as P,M as X,t as z,b as q,a as K,h as Q,F as W,z as J,k as Y,D as Z,N as $,O as G}from"./runtime-core.esm-bundler-ccc21fcd.js";import{a as H,d as ee,e as te,b as ae,c as le,u as se,f as oe,r as ie,i as re}from"./index-49b8d380.js";import{l as ne}from"./index-e4f7737c.js";import{l as de}from"./index-fdb16af2.js";import{l as me}from"./index-0886bcf2.js";import{c as ue,d as pe}from"./index-909d9da6.js";import{u as ce}from"./useMessage-5e709b20.js";import{u as fe}from"./useXTable-bf420a68.js";import{u as _e}from"./vue-router-0864a153.js";import{E as je}from"./index-be3181b1.js";import{a as ve,E as ye}from"./index-168f367d.js";import{E as he}from"./index-795de047.js";import{_ as ge}from"./_plugin-vue_export-helper-1b428a4d.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-c2caee16.js";import"./isEqual-6e1d5dd6.js";import"./cloneDeep-8298b498.js";import"./_flatRest-ac7abae6.js";import"./focus-trap-f53979c5.js";import"./aria-8fadfbe9.js";import"./is-a7957d81.js";import"./propTypes-5cfdbdab.js";import"./index-4665dced.js";import"./index-7a379d2e.js";import"./el-row-ad412a39.js";import"./el-col-613bea3c.js";import"./el-tooltip-4ed993c7.js";import"./el-radio-group-d1c0e064.js";import"./el-input-number-4fe7018b.js";/* empty css                   */import"./InputPassword-d0077663.js";import"./el-message-7ddf9388.js";import"./el-image-viewer-f62c5b85.js";import"./debounce-eb6bb100.js";import"./index-cf52a0ab.js";import"./index-7486e100.js";import"./strings-777507ad.js";import"./index-9d88d8a4.js";import"./dayjs.min-65a6b1e4.js";import"./useCache-d48cf6c5.js";import"./isArrayLikeObject-26c677c4.js";import"./index-653de86a.js";/* empty css                        *//* empty css                                                                   *//* empty css                    */import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";import"./app-41ac77cd.js";import"./index-183fdc84.js";import"./dropdown-db24c967.js";import"./refs-41718667.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-a7ef0ded.js";import"./index-6f87c872.js";const{t:we}=V(),xe=T({username:[C],nickname:[C],password:[C],deptId:[C],email:[{required:!0,message:we("profile.rules.mail"),trigger:"blur"},{type:"email",message:we("profile.rules.truemail"),trigger:["blur","change"]}],status:[C],mobile:[{len:11,trigger:"blur",message:"请输入正确的手机号码"}]}),be=T({primaryKey:"id",primaryType:"seq",primaryTitle:"用户编号",action:!0,actionWidth:"200px",columns:[{title:"用户账号",field:"username",isSearch:!0},{title:"用户密码",field:"password",isDetail:!1,isTable:!1,form:{component:"InputPassword"}},{title:"用户昵称",field:"nickname"},{title:"用户邮箱",field:"email"},{title:"手机号码",field:"mobile",isSearch:!0},{title:"部门",field:"deptId",isTable:!1},{title:"岗位",field:"postIds",isTable:!1},{title:we("common.status"),field:"status",dictType:E.COMMON_STATUS,dictClass:"number",isSearch:!0,table:{slots:{default:"status_default"}}},{title:"最后登录时间",field:"loginDate",formatter:"formatDate",isForm:!1},{title:"最后登录IP",field:"loginIp",isTable:!1,isForm:!1},{title:we("form.remark"),field:"remark",isTable:!1},{title:we("common.createTime"),field:"createTime",formatter:"formatDate",isTable:!1,isForm:!1,search:{show:!0,itemRender:{name:"XDataTimePicker"}}}]}),{allSchemas:ke}=S(be),Ie=e=>($("data-v-3a966aec"),e=e(),G(),e),Ve={class:"flex"},Ce={class:"card-header"},Ee=Ie((()=>F("span",null,"部门列表",-1))),Se={class:"card-header"},Te=Ie((()=>F("div",{class:"el-upload__text"},[Y("将文件拖到此处，或"),F("em",null,"点击上传")],-1))),Ue=Ie((()=>F("div",{class:"el-upload__tip"},"请上传 .xls , .xlsx 标准格式文件",-1))),Ae=U({name:"User"}),Be=ge(U({...Ae,setup(C){const{t:E}=V(),S=ce(),U=T({deptId:null}),$=A("用户列表"),[G,{reload:ge,deleteData:we,exportList:be}]=fe({allSchemas:ke,params:U,getListApi:H,deleteApi:ee,exportListApi:te}),Ie=A(""),Ae=A([]),Be=A(),De=(e,t)=>!e||t.name.includes(e),Le=async e=>{U.deptId=e.id,await ge()},{push:Ne}=_e();B(Ie,(e=>{Be.value.filter(e)}));const Re=A(!1),Fe=A(""),Me=A(!1),Oe=A("edit"),Pe=A(),Xe=A([]),ze=(e,t)=>{var a,l="";if(e&&t){for(const s of e)if(s.id==t){if(l=s.name)return l}else if((null==(a=s.children)?void 0:a.length)&&(l=ze(s.children,t)))return l;return l}return t},qe=async e=>{Oe.value=E("action."+e),Fe.value=e,Me.value=!0},Ke=A(),Qe=A(!1),We=A(),Je=T({id:0,username:"",nickname:"",roleIds:[]}),Ye=A(!1),Ze=A(!1),$e=A("用户导入"),Ge=A(0);const He=A(),et=e=>{const t="application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type,a=e.size/1024/1024<5;return t||S.error("上传文件只能是 xls / xlsx 格式!"),a||S.error("上传文件大小不能超过 5MB!"),t&&a},tt=A(),at=async e=>{if(0!==e.code)return void S.error(e.msg);Ye.value=!1,Ze.value=!1;const t=e.data;let a="上传成功数量："+t.createUsernames.length+";";for(let l of t.createUsernames)a+="< "+l+" >";a+="更新成功数量："+t.updateUsernames.length+";";for(const l of t.updateUsernames)a+="< "+l+" >";a+="更新失败数量："+Object.keys(t.failureUsernames).length+";";for(const l in t.failureUsernames)a+="< "+l+": "+t.failureUsernames[l]+" >";S.alert(a),await ge()},lt=()=>{S.error("最多只能上传一个文件！")},st=()=>{S.error("导入数据失败，请您重新上传！")};return D((async()=>{await(async()=>{const e=await me();Xe.value.push(...e)})(),await(async()=>{const e=await ne();Ae.value.push(...w(e))})()})),(w,V)=>{const C=h,T=o,U=m,B=je,D=y,H=v,ee=j,te=c,ne=f,me=_,ce=p,fe=u,_e=ve,ot=ye,it=d,rt=he,nt=n,dt=r,mt=l,ut=i,pt=s,ct=a,ft=t,_t=e,jt=L("hasPermi");return N(),R(W,null,[F("div",Ve,[M(D,{class:"w-1/5 user",gutter:12,shadow:"always"},{header:O((()=>[F("div",Ce,[Ee,M(C,{title:"修改部门",onClick:V[0]||(V[0]=e=>{Ne("/system/dept")})})])])),default:O((()=>[M(T,{modelValue:P(Ie),"onUpdate:modelValue":V[1]||(V[1]=e=>X(Ie)?Ie.value=e:null),placeholder:"搜索部门"},null,8,["modelValue"]),M(B,{height:"650"},{default:O((()=>[M(U,{ref_key:"treeRef",ref:Be,"node-key":"id","default-expand-all":"",data:P(Ae),props:P(g),"highlight-current":!0,"filter-node-method":De,"expand-on-click-node":!1,onNodeClick:Le},null,8,["data","props"])])),_:1})])),_:1}),M(D,{class:"w-4/5 user",style:{"margin-left":"10px"},gutter:12,shadow:"hover"},{header:O((()=>[F("div",Se,[F("span",null,z(P($)),1)])])),default:O((()=>[M(ce,{onRegister:P(G)},{toolbar_buttons:O((()=>[q(M(H,{type:"primary",preIcon:"ep:zoom-in",title:P(E)("action.add"),onClick:V[2]||(V[2]=e=>(async()=>{var e,t;qe("create"),await Z(),"username"!==ke.formSchema[0].field&&(null==(e=P(Pe))||e.addSchema({field:"username",label:"用户账号",component:"Input"},0),null==(t=P(Pe))||t.addSchema({field:"password",label:"用户密码",component:"InputPassword"},1))})())},null,8,["title"]),[[jt,["system:user:create"]]]),q(M(H,{type:"warning",preIcon:"ep:upload",title:P(E)("action.import"),onClick:V[3]||(V[3]=e=>Ye.value=!0)},null,8,["title"]),[[jt,["system:user:import"]]]),q(M(H,{type:"warning",preIcon:"ep:download",title:P(E)("action.export"),onClick:V[4]||(V[4]=e=>P(be)("用户数据.xls"))},null,8,["title"]),[[jt,["system:user:export"]]])])),status_default:O((({row:e})=>[M(ee,{modelValue:e.status,"onUpdate:modelValue":t=>e.status=t,"active-value":0,"inactive-value":1,onChange:t=>(async e=>{const t=e.status===b.ENABLE?"启用":"停用";S.confirm('确认要"'+t+'""'+e.username+'"用户吗?',E("common.reminder")).then((async()=>{e.status=e.status===b.ENABLE?b.ENABLE:b.DISABLE,await oe(e.id,e.status),S.success(t+"成功"),await ge()})).catch((()=>{e.status=e.status===b.ENABLE?b.DISABLE:b.ENABLE}))})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),actionbtns_default:O((({row:e})=>[q(M(C,{preIcon:"ep:edit",title:P(E)("action.edit"),onClick:t=>(async e=>{var t,a,l;qe("update"),await Z(),null==(t=P(Pe))||t.delSchema("username"),null==(a=P(Pe))||a.delSchema("password");const s=await ae(e);null==(l=P(Pe))||l.setValues(s)})(e.id)},null,8,["title","onClick"]),[[jt,["system:user:update"]]]),q(M(C,{preIcon:"ep:view",title:P(E)("action.detail"),onClick:t=>(async e=>{const t=await ae(e);Ke.value=t,await qe("detail")})(e.id)},null,8,["title","onClick"]),[[jt,["system:user:update"]]]),q((N(),K(me,{class:"p-0.5"},{dropdown:O((()=>[M(ne,null,{default:O((()=>[M(te,null,{default:O((()=>[q(M(C,{preIcon:"ep:key",title:"重置密码",onClick:t=>(e=>{S.prompt('请输入"'+e.username+'"的新密码',E("common.reminder")).then((({value:t})=>{ie(e.id,t).then((()=>{S.success("修改成功，新密码是："+t)}))}))})(e)},null,8,["onClick"]),[[jt,["system:user:update-password"]]])])),_:2},1024),M(te,null,{default:O((()=>[q(M(C,{preIcon:"ep:key",title:"分配角色",onClick:t=>(async e=>{Je.id=e.id,Je.username=e.username,Je.nickname=e.nickname;const t=await ue(e.id);Je.roleIds=t;const a=await de();We.value=a,Qe.value=!0})(e)},null,8,["onClick"]),[[jt,["system:permission:assign-user-role"]]])])),_:2},1024),M(te,null,{default:O((()=>[q(M(C,{preIcon:"ep:delete",title:P(E)("action.del"),onClick:t=>P(we)(e.id)},null,8,["title","onClick"]),[[jt,["system:user:delete"]]])])),_:2},1024)])),_:2},1024)])),default:O((()=>[M(C,{title:P(E)("action.more"),postIcon:"ep:arrow-down"},null,8,["title"])])),_:2},1024)),[[jt,["system:user:update-password","system:permission:assign-user-role","system:user:delete"]]])])),_:1},8,["onRegister"])])),_:1})]),M(dt,{modelValue:P(Me),"onUpdate:modelValue":V[7]||(V[7]=e=>X(Me)?Me.value=e:null),title:P(Oe)},{footer:O((()=>[["create","update"].includes(P(Fe))?(N(),K(H,{key:0,type:"primary",title:P(E)("action.save"),loading:P(Re),onClick:V[5]||(V[5]=e=>(async()=>{var e;const t=null==(e=P(Pe))?void 0:e.getElFormRef();t&&t.validate((async e=>{var t;if(e)try{const e=null==(t=P(Pe))?void 0:t.formModel;"create"===Fe.value?(await le(e),Re.value=!0,S.success(E("common.createSuccess"))):(await se(e),Re.value=!0,S.success(E("common.updateSuccess"))),Me.value=!1}finally{await ge(),Re.value=!1}}))})())},null,8,["title","loading"])):Q("",!0),M(H,{loading:P(Re),title:P(E)("dialog.close"),onClick:V[6]||(V[6]=e=>Me.value=!1)},null,8,["loading","title"])])),default:O((()=>[["create","update"].includes(P(Fe))?(N(),K(it,{key:0,rules:P(xe),schema:P(ke).formSchema,ref_key:"formRef",ref:Pe},{deptId:O((e=>[M(fe,{"node-key":"id",modelValue:e.deptId,"onUpdate:modelValue":t=>e.deptId=t,props:P(g),data:P(Ae),"check-strictly":""},null,8,["modelValue","onUpdate:modelValue","props","data"])])),postIds:O((e=>[M(ot,{modelValue:e.postIds,"onUpdate:modelValue":t=>e.postIds=t,multiple:"",placeholder:P(E)("common.selectText")},{default:O((()=>[(N(!0),R(W,null,J(P(Xe),(e=>(N(),K(_e,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:1},8,["rules","schema"])):Q("",!0),"detail"===P(Fe)?(N(),K(nt,{key:1,schema:P(ke).detailSchema,data:P(Ke)},{deptId:O((({row:e})=>[M(rt,null,{default:O((()=>{return[Y(z((t=e.deptId,ze(Ae.value,t))),1)];var t})),_:2},1024)])),postIds:O((({row:e})=>[""!==e.postIds?(N(!0),R(W,{key:0},J(e.postIds,((e,t)=>(N(),K(rt,{key:t,index:""},{default:O((()=>[(N(!0),R(W,null,J(P(Xe),(t=>(N(),R(W,null,[Y(z(e===t.id?t.name:""),1)],64)))),256))])),_:2},1024)))),128)):(N(),R(W,{key:1},[],64))])),_:1},8,["schema","data"])):Q("",!0)])),_:1},8,["modelValue","title"]),M(dt,{modelValue:P(Qe),"onUpdate:modelValue":V[11]||(V[11]=e=>X(Qe)?Qe.value=e:null),title:"分配角色"},{footer:O((()=>[M(H,{type:"primary",title:P(E)("action.save"),loading:P(Re),onClick:V[9]||(V[9]=e=>(async()=>{const e=A({userId:Je.id,roleIds:Je.roleIds});await pe(e.value),S.success(E("common.updateSuccess")),Qe.value=!1})())},null,8,["title","loading"]),M(H,{title:P(E)("dialog.close"),onClick:V[10]||(V[10]=e=>Qe.value=!1)},null,8,["title"])])),default:O((()=>[M(pt,{model:P(Je),"label-width":"140px",inline:!0},{default:O((()=>[M(mt,{label:"用户名称"},{default:O((()=>[M(rt,null,{default:O((()=>[Y(z(P(Je).username),1)])),_:1})])),_:1}),M(mt,{label:"用户昵称"},{default:O((()=>[M(rt,null,{default:O((()=>[Y(z(P(Je).nickname),1)])),_:1})])),_:1}),M(mt,{label:"角色"},{default:O((()=>[M(ut,{modelValue:P(Je).roleIds,"onUpdate:modelValue":V[8]||(V[8]=e=>P(Je).roleIds=e),titles:["角色列表","已选择"],props:{key:"id",label:"name"},data:P(We)},null,8,["modelValue","data"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),M(dt,{modelValue:P(Ye),"onUpdate:modelValue":V[16]||(V[16]=e=>X(Ye)?Ye.value=e:null),title:P($e)},{footer:O((()=>[M(H,{type:"warning",preIcon:"ep:upload-filled",title:P(E)("action.save"),onClick:V[14]||(V[14]=e=>(He.value={Authorization:"Bearer "+k(),"tenant-id":I()},Ze.value=!0,void tt.value.submit()))},null,8,["title"]),M(H,{title:P(E)("dialog.close"),onClick:V[15]||(V[15]=e=>Ye.value=!1)},null,8,["title"])])),default:O((()=>[M(pt,{class:"drawer-multiColumn-form","label-width":"150px"},{default:O((()=>[M(mt,{label:"模板下载 :"},{default:O((()=>[M(H,{type:"primary",prefix:"ep:download",title:"点击下载",onClick:V[12]||(V[12]=e=>(async()=>{const e=await re();x.excel(e,"用户导入模版.xls")})())})])),_:1}),M(mt,{label:"文件上传 :"},{default:O((()=>[M(ft,{ref_key:"uploadRef",ref:tt,action:P("http://localhost:48080/admin-api/system/user/import")+"?updateSupport="+P(Ge),headers:P(He),drag:!0,limit:1,multiple:!0,"show-file-list":!0,disabled:P(Ze),"before-upload":et,"on-exceed":lt,"on-success":at,"on-error":st,"auto-upload":!1,accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},{tip:O((()=>[Ue])),default:O((()=>[M(ct,{icon:"ep:upload-filled"}),Te])),_:1},8,["action","headers","disabled"])])),_:1}),M(mt,{label:"是否更新已经存在的用户数据:"},{default:O((()=>[M(_t,{modelValue:P(Ge),"onUpdate:modelValue":V[13]||(V[13]=e=>X(Ge)?Ge.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-3a966aec"]]);export{Be as default};
