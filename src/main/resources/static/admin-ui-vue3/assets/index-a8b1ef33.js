import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{E as l}from"./base-085523fd.js";import{E as t}from"./el-progress-64245232.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import{_ as a}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{a as o,E as i}from"./el-form-item-8022b942.js";import{b as s,E as r}from"./el-radio-group-d1c0e064.js";import{E as n}from"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-tooltip-4ed993c7.js";import{_ as u}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{E as d}from"./el-switch-4b318cc1.js";import{_ as m}from"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import{_ as p}from"./XTextButton-ab77381a.js";import{_ as c}from"./XButton-39866472.js";import{D as f,a as y}from"./dict-3e42505d.js";import{g as _,a as v}from"./auth-2fa258a0.js";import{b as h,g as b}from"./index-918c96df.js";import{a as g,g as j,c as V,u as k,d as w,b as C,e as x}from"./index-30c543aa.js";import{u as I}from"./useI18n-56d4bc42.js";import{r as T}from"./formRules-a3380b28.js";import{u as D}from"./useVxeCrudSchemas-8bec068b.js";import{A as P,d as E,r as U,x as S,C as M,Q as R,o as q,a as B,w as F,l as O,f as A,b as L,k as X,t as Y,h as z,M as G,i as N,F as Q,z as W,e as K,v as Z}from"./runtime-core.esm-bundler-ccc21fcd.js";import{b as $}from"./formCreate-a3356cdc.js";import{u as H}from"./useMessage-5e709b20.js";import{u as J}from"./vue-router-0864a153.js";import{u as ee}from"./useXTable-bf420a68.js";import{E as le}from"./index-795de047.js";import{E as te}from"./index-7486e100.js";import{a as ae,E as oe}from"./index-168f367d.js";import"./el-card-d8ab0074.js";import"./propTypes-5cfdbdab.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./index-c2caee16.js";import"./focus-trap-f53979c5.js";import"./aria-8fadfbe9.js";import"./is-a7957d81.js";import"./index-be3181b1.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./el-button-6b012e5e.js";import"./index-7a379d2e.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./useCache-d48cf6c5.js";import"./download-20922b56.js";import"./color-a8b4eb58.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./index-a7ef0ded.js";import"./_flatRest-ac7abae6.js";import"./index-6f87c872.js";import"./strings-777507ad.js";import"./isEqual-6e1d5dd6.js";import"./debounce-eb6bb100.js";import"./index-9d88d8a4.js";const{t:ie}=I(),se=P({key:[T],name:[T],category:[T],formType:[T],formId:[T],formCustomCreatePath:[T],formCustomViewPath:[T]}),re=P({primaryKey:"key",primaryType:null,action:!0,actionWidth:"540px",columns:[{title:"流程标识",field:"key",isSearch:!0,table:{width:120}},{title:"流程名称",field:"name",isSearch:!0,table:{width:120,slots:{default:"name_default"}}},{title:"流程分类",field:"category",dictType:f.BPM_MODEL_CATEGORY,dictClass:"number",isSearch:!0,table:{slots:{default:"category_default"}}},{title:"表单信息",field:"formId",table:{width:180,slots:{default:"formId_default"}}},{title:"最新部署的流程定义",field:"processDefinition",isForm:!1,table:{children:[{title:"流程版本",field:"version",slots:{default:"version_default"},width:80},{title:"激活状态",field:"status",slots:{default:"status_default"},width:80},{title:"部署时间",field:"processDefinition.deploymentTime",formatter:"formatDate",width:180}]}},{title:ie("common.createTime"),field:"createTime",isForm:!1,formatter:"formatDate",table:{width:180}}]}),{allSchemas:ne}=D(re),ue=K("i",{style:{"padding-left":"5px"},class:"el-icon-question"},null,-1),de=K("i",{style:{"padding-left":"5px"},class:"el-icon-question"},null,-1),me={key:1},pe=K("i",{style:{"padding-left":"5px"},class:"el-icon-question"},null,-1),ce=K("i",{style:{"padding-left":"5px"},class:"el-icon-question"},null,-1),fe=K("div",{class:"el-upload__text"},[X(" 将文件拖到此处，或 "),K("em",null,"点击上传")],-1),ye=K("div",{class:"el-upload__tip",style:{color:"red"}}," 提示：仅允许导入“bpm”或“xml”格式文件！ ",-1),_e=E({__name:"index",setup(T){const{t:D}=I(),P=H(),E=J(),ie=U(!1),re=U(null),_e=U({prefix:"flowable"}),[ve,{reload:he}]=ee({allSchemas:ne,getListApi:g}),be=U(),ge=U(!1),je=U({rule:[],option:{}}),Ve=async e=>{if(10==e.formType){const l=await b(e.formId);$(je,l.conf,l.fields),ge.value=!0}else await E.push({path:e.formCustomCreatePath})},ke=U(!1),we=U("新建模型"),Ce=U(!1),xe=U(),Ie=U(),Te=async e=>{we.value=D("action."+e),ke.value=!0},De=async()=>{Ee(),await Te("create")},Pe=async()=>{const e=A(Ie);if(!e)return;if(await e.validate()){Ce.value=!0;try{const e=xe.value;e.id?(await k(e),P.success(D("common.updateSuccess"))):(await V(e),P.success(D("common.createSuccess"))),ke.value=!1}finally{await he(),Ce.value=!1}}},Ee=()=>{var e;xe.value={formType:10,name:"",courseSort:"",description:"",formId:"",formCustomCreatePath:"",formCustomViewPath:""},null==(e=Ie.value)||e.resetFields()},Ue=U();const Se=U(),Me=U(!1),Re=U(!1),qe=U(),Be=U({key:"",name:"",description:""}),Fe=()=>{Me.value=!0},Oe=()=>{P.error("最多只能上传一个文件！")},Ae=()=>{P.error("导入流程失败，请您重新上传！")},Le=()=>{Se.value={Authorization:"Bearer "+_(),"tenant-id":v()},Re.value=!0,Ue.value.submit()},Xe=async e=>{0===e.code?(Ye(),P.success("导入流程成功！请点击【设计流程】按钮，进行编辑保存后，才可以进行【发布流程】"),await he()):P.error(e.msg)},Ye=()=>{var e;Me.value=!1,Re.value=!1,Ue.value.clearFiles(),Be.value={key:"",name:"",description:""},null==(e=qe.value)||e.resetFields()};return S((()=>{h().then((e=>{be.value=e}))})),(_,v)=>{const h=c,b=p,g=m,V=le,k=d,I=u,T=n,U=te,S=o,$=ae,H=oe,J=s,ee=r,ne=i,ze=a,Ge=M("upload-filled"),Ne=l,Qe=t,We=M("form-create"),Ke=M("my-process-viewer"),Ze=e,$e=R("hasPermi");return q(),B(Ze,null,{default:F((()=>[O(I,{onRegister:A(ve)},{toolbar_buttons:F((()=>[L(O(h,{type:"primary",preIcon:"ep:zoom-in",title:"新建流程",onClick:De},null,512),[[$e,["bpm:model:create"]]]),O(h,{type:"warning",preIcon:"ep:upload",title:"导入流程",onClick:Fe,style:{"margin-left":"10px"}})])),name_default:F((({row:e})=>[O(b,{title:e.name,onClick:l=>(e=>{j(e).then((e=>{re.value=e.bpmnXml,ie.value=!0}))})(e.id)},null,8,["title","onClick"])])),category_default:F((({row:e})=>[O(g,{type:A(f).BPM_MODEL_CATEGORY,value:Number(null==e?void 0:e.category)},null,8,["type","value"])])),formId_default:F((({row:e})=>{var l;return[10===e.formType?(q(),B(b,{key:0,title:(null==(l=A(be).find((l=>l.id===e.formId)))?void 0:l.name)||e.formId,onClick:l=>Ve(e)},null,8,["title","onClick"])):(q(),B(b,{key:1,title:e.formCustomCreatePath,onClick:l=>Ve(e)},null,8,["title","onClick"]))]})),version_default:F((({row:e})=>[e.processDefinition?(q(),B(V,{key:0},{default:F((()=>[X("v"+Y(e.processDefinition.version),1)])),_:2},1024)):(q(),B(V,{key:1,type:"warning"},{default:F((()=>[X("未部署")])),_:1}))])),status_default:F((({row:e})=>[e.processDefinition?(q(),B(k,{key:0,modelValue:e.processDefinition.suspensionState,"onUpdate:modelValue":l=>e.processDefinition.suspensionState=l,"active-value":1,"inactive-value":2,onChange:l=>(e=>{const l=e.id,t=e.processDefinition.suspensionState,a="是否确认"+(1===t?"激活":"挂起")+'流程名字为"'+e.name+'"的数据项?';P.confirm(a).then((async()=>{await C(l,t),P.success(D("部署成功")),he()})).catch((()=>{e.processDefinition.suspensionState=1===t?2:1}))})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])):z("",!0)])),actionbtns_default:F((({row:e})=>[L(O(b,{preIcon:"ep:edit",title:"修改流程",onClick:l=>(async e=>{Ee(),await Te("edit"),xe.value=await j(e),null==xe.value.category?xe.value.category=1:xe.value.category=Number(xe.value.category)})(e.id)},null,8,["onClick"]),[[$e,["bpm:model:update"]]]),L(O(b,{preIcon:"ep:setting",title:"设计流程",onClick:l=>(e=>{E.push({name:"modelEditor",query:{modelId:e.id}})})(e)},null,8,["onClick"]),[[$e,["bpm:model:update"]]]),L(O(b,{preIcon:"ep:user",title:"分配规则",onClick:l=>(e=>{E.push({name:"BpmTaskAssignRuleList",query:{modelId:e.id}})})(e)},null,8,["onClick"]),[[$e,["bpm:task-assign-rule:query"]]]),L(O(b,{preIcon:"ep:position",title:"发布流程",onClick:l=>(e=>{P.confirm("是否部署该流程！！").then((async()=>{await x(e.id),P.success(D("部署成功")),he()}))})(e)},null,8,["onClick"]),[[$e,["bpm:model:deploy"]]]),L(O(b,{preIcon:"ep:aim",title:"流程定义",onClick:l=>(e=>{E.push({name:"BpmProcessDefinitionList",query:{key:e.key}})})(e)},null,8,["onClick"]),[[$e,["bpm:process-definition:query"]]]),L(O(b,{preIcon:"ep:delete",title:A(D)("action.del"),onClick:l=>{return t=e.id,void P.delConfirm("是否删除该流程！！").then((async()=>{await w(t),P.success(D("common.delSuccess")),he()}));var t}},null,8,["title","onClick"]),[[$e,["bpm:model:delete"]]])])),_:1},8,["onRegister"]),O(ze,{modelValue:A(ke),"onUpdate:modelValue":v[9]||(v[9]=e=>G(ke)?ke.value=e:null),title:A(we),width:"600"},{footer:F((()=>[O(h,{type:"primary",loading:A(Ce),onClick:Pe,title:A(D)("action.save")},null,8,["loading","title"]),O(h,{loading:A(Ce),onClick:v[8]||(v[8]=e=>ke.value=!1),title:A(D)("dialog.close")},null,8,["loading","title"])])),default:F((()=>[O(ne,{loading:A(Ce),"el-form":"",ref_key:"saveFormRef",ref:Ie,model:A(xe),rules:A(se),"label-width":"110px"},{default:F((()=>[O(S,{label:"流程标识",prop:"key"},{default:F((()=>[O(T,{modelValue:A(xe).key,"onUpdate:modelValue":v[0]||(v[0]=e=>A(xe).key=e),placeholder:"请输入流标标识",style:{width:"330px"},disabled:!!A(xe).id},null,8,["modelValue","disabled"]),A(xe).id?(q(),B(U,{key:1,class:"item",effect:"light",content:"流程标识不可修改！",placement:"top"},{default:F((()=>[de])),_:1})):(q(),B(U,{key:0,class:"item",effect:"light",content:"新建后，流程标识不可修改！",placement:"top"},{default:F((()=>[ue])),_:1}))])),_:1}),O(S,{label:"流程名称",prop:"name"},{default:F((()=>[O(T,{modelValue:A(xe).name,"onUpdate:modelValue":v[1]||(v[1]=e=>A(xe).name=e),placeholder:"请输入流程名称",disabled:!!A(xe).id,clearable:""},null,8,["modelValue","disabled"])])),_:1}),A(xe).id?(q(),B(S,{key:0,label:"流程分类",prop:"category"},{default:F((()=>[O(H,{modelValue:A(xe).category,"onUpdate:modelValue":v[2]||(v[2]=e=>A(xe).category=e),placeholder:"请选择流程分类",clearable:"",style:{width:"100%"}},{default:F((()=>[(q(!0),N(Q,null,W(A(y)(A(f).BPM_MODEL_CATEGORY),(e=>(q(),B($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):z("",!0),O(S,{label:"流程描述",prop:"description"},{default:F((()=>[O(T,{type:"textarea",modelValue:A(xe).description,"onUpdate:modelValue":v[3]||(v[3]=e=>A(xe).description=e),clearable:""},null,8,["modelValue"])])),_:1}),A(xe).id?(q(),N("div",me,[O(S,{label:"表单类型",prop:"formType"},{default:F((()=>[O(ee,{modelValue:A(xe).formType,"onUpdate:modelValue":v[4]||(v[4]=e=>A(xe).formType=e)},{default:F((()=>[(q(!0),N(Q,null,W(A(y)(A(f).BPM_MODEL_FORM_TYPE),(e=>(q(),B(J,{key:parseInt(e.value),label:parseInt(e.value)},{default:F((()=>[X(Y(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),10===A(xe).formType?(q(),B(S,{key:0,label:"流程表单",prop:"formId"},{default:F((()=>[O(H,{modelValue:A(xe).formId,"onUpdate:modelValue":v[5]||(v[5]=e=>A(xe).formId=e),clearable:"",style:{width:"100%"}},{default:F((()=>[(q(!0),N(Q,null,W(A(be),(e=>(q(),B($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):z("",!0),20===A(xe).formType?(q(),B(S,{key:1,label:"表单提交路由",prop:"formCustomCreatePath"},{default:F((()=>[O(T,{modelValue:A(xe).formCustomCreatePath,"onUpdate:modelValue":v[6]||(v[6]=e=>A(xe).formCustomCreatePath=e),placeholder:"请输入表单提交路由",style:{width:"330px"}},null,8,["modelValue"]),O(U,{class:"item",effect:"light",content:"自定义表单的提交路径，使用 Vue 的路由地址，例如说：bpm/oa/leave/create",placement:"top"},{default:F((()=>[pe])),_:1})])),_:1})):z("",!0),20===A(xe).formType?(q(),B(S,{key:2,label:"表单查看路由",prop:"formCustomViewPath"},{default:F((()=>[O(T,{modelValue:A(xe).formCustomViewPath,"onUpdate:modelValue":v[7]||(v[7]=e=>A(xe).formCustomViewPath=e),placeholder:"请输入表单查看路由",style:{width:"330px"}},null,8,["modelValue"]),O(U,{class:"item",effect:"light",content:"自定义表单的查看路径，使用 Vue 的路由地址，例如说：bpm/oa/leave/view",placement:"top"},{default:F((()=>[ce])),_:1})])),_:1})):z("",!0)])):z("",!0)])),_:1},8,["loading","model","rules"])])),_:1},8,["modelValue","title"]),O(ze,{modelValue:A(Me),"onUpdate:modelValue":v[13]||(v[13]=e=>G(Me)?Me.value=e:null),width:"400",title:"导入流程"},{footer:F((()=>[O(h,{type:"warning",preIcon:"ep:upload-filled",title:A(D)("action.save"),onClick:Le},null,8,["title"]),O(h,{title:"取 消",onClick:Ye})])),default:F((()=>[K("div",null,[O(Qe,{ref_key:"uploadRef",ref:Ue,action:A("http://localhost:48080/admin-api/bpm/model/import"),headers:A(Se),drag:!0,limit:1,multiple:!0,"show-file-list":!0,disabled:A(Re),"on-exceed":Oe,"on-success":Xe,"on-error":Ae,"auto-upload":!1,accept:".bpmn, .xml",name:"bpmnFile",data:A(Be)},{tip:F((()=>[ye,K("div",null,[O(ne,{ref_key:"importFormRef",ref:qe,model:A(Be),rules:A(se),"label-width":"120px","status-icon":""},{default:F((()=>[O(S,{label:"流程标识",prop:"key"},{default:F((()=>[O(T,{modelValue:A(Be).key,"onUpdate:modelValue":v[10]||(v[10]=e=>A(Be).key=e),placeholder:"请输入流标标识",style:{width:"250px"}},null,8,["modelValue"])])),_:1}),O(S,{label:"流程名称",prop:"name"},{default:F((()=>[O(T,{modelValue:A(Be).name,"onUpdate:modelValue":v[11]||(v[11]=e=>A(Be).name=e),placeholder:"请输入流程名称",clearable:""},null,8,["modelValue"])])),_:1}),O(S,{label:"流程描述",prop:"description"},{default:F((()=>[O(T,{type:"textarea",modelValue:A(Be).description,"onUpdate:modelValue":v[12]||(v[12]=e=>A(Be).description=e),clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),default:F((()=>[O(Ne,{class:"el-icon--upload"},{default:F((()=>[O(Ge)])),_:1}),fe])),_:1},8,["action","headers","disabled","data"])])])),_:1},8,["modelValue"]),O(ze,{modelValue:A(ge),"onUpdate:modelValue":v[14]||(v[14]=e=>G(ge)?ge.value=e:null),width:"800",title:"表单详情","show-footer":!1},{default:F((()=>[A(ge)?(q(),B(We,{key:0,rule:A(je).rule,option:A(je).option},null,8,["rule","option"])):z("",!0)])),_:1},8,["modelValue"]),O(ze,{title:"流程图",modelValue:A(ie),"onUpdate:modelValue":v[16]||(v[16]=e=>G(ie)?ie.value=e:null),width:"80%",height:"90%"},{default:F((()=>[O(Ke,Z({key:"designer",modelValue:A(re),"onUpdate:modelValue":v[15]||(v[15]=e=>G(re)?re.value=e:null),value:A(re)},A(_e),{prefix:A(_e).prefix}),null,16,["modelValue","value","prefix"])])),_:1},8,["modelValue"])])),_:1})}}});export{_e as default};
