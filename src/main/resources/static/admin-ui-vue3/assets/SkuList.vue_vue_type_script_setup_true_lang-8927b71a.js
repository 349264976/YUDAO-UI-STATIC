import{d as M,p as U,r as S,af as L,o as m,c as k,q as w,w as i,a as u,a1 as b,F as C,i as t,k as N,j as f,K as A,t as p,al as Q,dp as X,J as Y,T as Z,bE as ee,H as le,g as F,__tla as ae}from"./index-0f589822.js";import{E as te,__tla as ie}from"./el-image-9c2dd802.js";import{__tla as oe}from"./el-image-viewer-863e3dd0.js";import{_ as re,__tla as se}from"./UploadImg-fe783aab.js";import{__tla as ne}from"./UploadFile.vue_vue_type_style_index_0_scoped_5a2639f8_lang-77946e64.js";import{c as ce,__tla as de}from"./index-2b69f27f.js";import{u as me,__tla as ue}from"./useMessage-45ab706e.js";let j,pe=Promise.all([(()=>{try{return ae}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return oe}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ne}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return ue}catch{}})()]).then(async()=>{let T,E,O;T={style:{"font-weight":"bold",color:"#40aaff"}},E={style:{"font-weight":"bold",color:"#40aaff"}},O={style:{"font-weight":"bold",color:"#40aaff"}},j=M({name:"SkuList",__name:"SkuList",props:{propFormData:{type:Object,default:()=>{}},propertyList:{type:Array,default:()=>[]},ruleConfig:{type:Array,default:()=>[]},isBatch:U.bool.def(!1),isDetail:U.bool.def(!1),isComponent:U.bool.def(!1),isActivityComponent:U.bool.def(!1)},emits:["selectionChange"],setup(h,{expose:$,emit:q}){const V=h,H=me(),d=S(),x=S([{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,subCommissionFirstPrice:0,subCommissionSecondPrice:0}]),z=o=>{ce({zIndex:9999999,urlList:[o]})},K=()=>{d.value.skus.forEach(o=>{X(o,x.value[0])})},v=S([]),R=(o,c)=>{const e=c.split(".");let s=o;for(const r of e){if(!s||typeof s!="object"||!(r in s)){s=void 0;break}s=s[r]}return s},W=o=>{q("selectionChange",o)};L(()=>V.propFormData,o=>{o&&(d.value=o)},{deep:!0,immediate:!0});const B=o=>{const c=o.map(s=>s.values.map(r=>({propertyId:s.id,propertyName:s.name,valueId:r.id,valueName:r.name}))),e=I(c);D(o)||(d.value.skus=[]);for(const s of e){const r={properties:Array.isArray(s)?s:[s],price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,subCommissionFirstPrice:0,subCommissionSecondPrice:0};d.value.skus.findIndex(_=>JSON.stringify(_.properties)===JSON.stringify(r.properties))===-1&&d.value.skus.push(r)}},D=o=>{const c=[];d.value.skus.forEach(s=>{var r,_;return(_=(r=s.properties)==null?void 0:r.map(g=>g.propertyId))==null?void 0:_.forEach(g=>{c.indexOf(g)===-1&&c.push(g)})});const e=o.map(s=>s.id);return c.length===e.length},I=o=>{if(o.length===0)return[];if(o.length===1)return o[0];{const c=[],e=I(o.slice(1));for(let s=0;s<o[0].length;s++)for(let r=0;r<e.length;r++)Array.isArray(e[r])?c.push([o[0][s],...e[r]]):c.push([o[0][s],e[r]]);return c}};L(()=>V.propertyList,o=>{d.value.specType&&(V.isBatch&&(x.value=[{price:0,marketPrice:0,costPrice:0,barCode:"",picUrl:"",stock:0,weight:0,volume:0,subCommissionFirstPrice:0,subCommissionSecondPrice:0}]),JSON.stringify(o)!=="[]"&&(v.value=[],o.forEach((c,e)=>{v.value.push({prop:`name${e}`,label:c.name})}),D(o)||o.some(c=>c.values.length===0)||B(o)))},{deep:!0,immediate:!0});const J=S();return $({generateTableData:B,validateSku:()=>{const o=["price","marketPrice","costPrice"];let c="\u8BF7\u68C0\u67E5\u5546\u54C1\u5404\u884C\u76F8\u5173\u5C5E\u6027\u914D\u7F6E\uFF0C",e=!0;for(const s of d.value.skus){if(V.isActivityComponent)for(const r of V.ruleConfig){const _=R(s,r.name);if(!r.rule(_)){e=!1,c+=r.message;break}}else if(o.some(r=>s[r]<.01)){e=!1,c="\u5546\u54C1\u76F8\u5173\u4EF7\u683C\u4E0D\u80FD\u4F4E\u4E8E 0.01 \u5143\uFF01\uFF01";break}if(!e)throw H.warning(c),new Error(c)}},clearSelection:()=>{J.value.clearSelection()}}),(o,c)=>{const e=Y,s=Z,r=ee,_=le,g=te;return m(),k(C,null,[h.isDetail||h.isActivityComponent?b("",!0):(m(),w(u(A),{key:0,data:h.isBatch?u(x):u(d).skus,border:"",class:"tabNumWidth","max-height":"500",size:"small"},{default:i(()=>{var a;return[t(e,{align:"center",fixed:"left",label:"\u56FE\u7247","min-width":"100"},{default:i(({row:l})=>[t(u(re),{modelValue:l.picUrl,"onUpdate:modelValue":n=>l.picUrl=n,height:"80px",width:"100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(d).specType&&!h.isBatch?(m(!0),k(C,{key:0},N(u(v),(l,n)=>(m(),w(e,{key:n,label:l.label,align:"center","min-width":"120"},{default:i(({row:y})=>{var P;return[F("span",T,p((P=y.properties[n])==null?void 0:P.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"168"},{default:i(({row:l})=>[t(s,{modelValue:l.barCode,"onUpdate:modelValue":n=>l.barCode=n,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.price,"onUpdate:modelValue":n=>l.price=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.marketPrice,"onUpdate:modelValue":n=>l.marketPrice=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.costPrice,"onUpdate:modelValue":n=>l.costPrice=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.stock,"onUpdate:modelValue":n=>l.stock=n,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.weight,"onUpdate:modelValue":n=>l.weight=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.volume,"onUpdate:modelValue":n=>l.volume=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(d).subCommissionType?(m(),k(C,{key:1},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.subCommissionFirstPrice,"onUpdate:modelValue":n=>l.subCommissionFirstPrice=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"168"},{default:i(({row:l})=>[t(r,{modelValue:l.subCommissionSecondPrice,"onUpdate:modelValue":n=>l.subCommissionSecondPrice=n,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})],64)):b("",!0),(a=u(d))!=null&&a.specType?(m(),w(e,{key:2,align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"80"},{default:i(({row:l})=>[h.isBatch?(m(),w(_,{key:0,link:"",size:"small",type:"primary",onClick:K},{default:i(()=>[f(" \u6279\u91CF\u6DFB\u52A0 ")]),_:1})):(m(),w(_,{key:1,link:"",size:"small",type:"primary",onClick:n=>(y=>{const P=d.value.skus.findIndex(G=>JSON.stringify(G.properties)===JSON.stringify(y.properties));d.value.skus.splice(P,1)})(l)},{default:i(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"]))]),_:1})):b("",!0)]}),_:1},8,["data"])),h.isDetail?(m(),w(u(A),{key:1,ref_key:"activitySkuListRef",ref:J,data:u(d).skus,border:"","max-height":"500",size:"small",style:{width:"99%"},onSelectionChange:W},{default:i(()=>[h.isComponent?(m(),w(e,{key:0,type:"selection",width:"45"})):b("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:i(({row:a})=>[t(g,{src:a.picUrl,class:"w-60px h-60px",onClick:l=>z(a.picUrl)},null,8,["src","onClick"])]),_:1}),u(d).specType&&!h.isBatch?(m(!0),k(C,{key:1},N(u(v),(a,l)=>(m(),w(e,{key:l,label:a.label,align:"center","min-width":"80"},{default:i(({row:n})=>{var y;return[F("span",E,p((y=n.properties[l])==null?void 0:y.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:i(({row:a})=>[f(p(a.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:i(({row:a})=>[f(p(a.stock),1)]),_:1}),t(e,{align:"center",label:"\u91CD\u91CF(kg)","min-width":"80"},{default:i(({row:a})=>[f(p(a.weight),1)]),_:1}),t(e,{align:"center",label:"\u4F53\u79EF(m^3)","min-width":"80"},{default:i(({row:a})=>[f(p(a.volume),1)]),_:1}),u(d).subCommissionType?(m(),k(C,{key:2},[t(e,{align:"center",label:"\u4E00\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.subCommissionFirstPrice),1)]),_:1}),t(e,{align:"center",label:"\u4E8C\u7EA7\u8FD4\u4F63(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.subCommissionSecondPrice),1)]),_:1})],64)):b("",!0)]),_:1},8,["data"])):b("",!0),h.isActivityComponent?(m(),w(u(A),{key:2,data:u(d).skus,border:"","max-height":"500",size:"small",style:{width:"99%"}},{default:i(()=>[h.isComponent?(m(),w(e,{key:0,type:"selection",width:"45"})):b("",!0),t(e,{align:"center",label:"\u56FE\u7247","min-width":"80"},{default:i(({row:a})=>[t(g,{src:a.picUrl,class:"w-60px h-60px",onClick:l=>z(a.picUrl)},null,8,["src","onClick"])]),_:1}),u(d).specType?(m(!0),k(C,{key:1},N(u(v),(a,l)=>(m(),w(e,{key:l,label:a.label,align:"center","min-width":"80"},{default:i(({row:n})=>{var y;return[F("span",O,p((y=n.properties[l])==null?void 0:y.valueName),1)]}),_:2},1032,["label"]))),128)):b("",!0),t(e,{align:"center",label:"\u5546\u54C1\u6761\u7801","min-width":"100"},{default:i(({row:a})=>[f(p(a.barCode),1)]),_:1}),t(e,{align:"center",label:"\u9500\u552E\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.price),1)]),_:1}),t(e,{align:"center",label:"\u5E02\u573A\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.marketPrice),1)]),_:1}),t(e,{align:"center",label:"\u6210\u672C\u4EF7(\u5143)","min-width":"80"},{default:i(({row:a})=>[f(p(a.costPrice),1)]),_:1}),t(e,{align:"center",label:"\u5E93\u5B58","min-width":"80"},{default:i(({row:a})=>[f(p(a.stock),1)]),_:1}),Q(o.$slots,"extension")]),_:3},8,["data"])):b("",!0)],64)}}})});export{j as _,pe as __tla};
