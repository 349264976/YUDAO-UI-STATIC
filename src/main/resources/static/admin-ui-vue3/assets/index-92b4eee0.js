import"./base-085523fd.js";import{a as e,E as t}from"./el-form-item-8022b942.js";import{E as a}from"./el-notification-c7d5f4ea.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  */import{_ as l}from"./XModal.vue_vue_type_script_setup_true_lang-c47b87cf.js";import{_ as o}from"./Descriptions-8db90f03.js";import{_ as s}from"./Form-a0e23abc.js";import{_ as i}from"./ContentWrap.vue_vue_type_script_setup_true_lang-63555901.js";import{_ as r}from"./XTable.vue_vue_type_style_index_0_lang-9c560634.js";import{_ as m}from"./XTextButton-ab77381a.js";import{_ as p}from"./XButton-39866472.js";import{r as n}from"./formRules-a3380b28.js";import{D as u}from"./dict-3e42505d.js";import{u as d}from"./useVxeCrudSchemas-8bec068b.js";import{A as c,d as j,r as _,x as f,Q as y,o as v,i as g,l as b,w as h,f as x,b as k,a as w,h as C,M as T,F as I,z as V}from"./runtime-core.esm-bundler-ccc21fcd.js";import{a as P}from"./index-a7ef0ded.js";import{g as S}from"./index-49b8d380.js";import{u as M}from"./useI18n-56d4bc42.js";import{u as E}from"./useMessage-5e709b20.js";import{u as D}from"./useXTable-bf420a68.js";import{a as U,E as F}from"./index-168f367d.js";import"./index-c2caee16.js";import"./runtime-dom.esm-bundler-daa7e741.js";import"./aria-8fadfbe9.js";import"./index-4665dced.js";import"./cloneDeep-8298b498.js";import"./el-button-6b012e5e.js";import"./is-a7957d81.js";import"./focus-trap-f53979c5.js";import"./index-7a379d2e.js";import"./propTypes-5cfdbdab.js";import"./index-be3181b1.js";import"./el-descriptions-item-d373bc22.js";import"./DictTag.vue_vue_type_script_lang-a5ff2643.js";import"./color-a8b4eb58.js";import"./index-795de047.js";import"./el-tooltip-4ed993c7.js";import"./Icon.vue_vue_type_script_setup_true_lang-4448c023.js";import"./dayjs.min-65a6b1e4.js";import"./useCache-d48cf6c5.js";import"./app-41ac77cd.js";import"./index-cf52a0ab.js";import"./el-message-7ddf9388.js";import"./index-7486e100.js";import"./index-183fdc84.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./Form.vue_vue_type_style_index_0_scoped_f983cb9f_lang-54d674bd.js";import"./el-row-ad412a39.js";import"./el-col-613bea3c.js";import"./el-checkbox-cd7dd8c1.js";import"./isEqual-6e1d5dd6.js";import"./_flatRest-ac7abae6.js";import"./el-radio-group-d1c0e064.js";import"./el-input-number-4fe7018b.js";import"./el-tree-39cab679.js";import"./el-tree-select-6f481715.js";import"./el-switch-4b318cc1.js";/* empty css                   */import"./InputPassword-d0077663.js";import"./auth-2fa258a0.js";import"./el-image-viewer-f62c5b85.js";import"./debounce-eb6bb100.js";import"./el-progress-64245232.js";import"./strings-777507ad.js";import"./index-9d88d8a4.js";import"./isArrayLikeObject-26c677c4.js";import"./index-653de86a.js";/* empty css                        *//* empty css                                                                   *//* empty css                    */import"./el-card-d8ab0074.js";import"./download-20922b56.js";import"./XTextButton.vue_vue_type_style_index_0_scoped_0fcea4df_lang-41ab76b9.js";import"./index-6f87c872.js";import"./vue-router-0864a153.js";const R=c({name:[n],code:[n],content:[n],type:[n],status:[n]}),X=c({primaryKey:"id",primaryTitle:"编号",primaryType:null,action:!0,actionWidth:"260",columns:[{title:"模版编码",field:"code",isSearch:!0},{title:"模板名称",field:"name",isSearch:!0},{title:"发件人名称",field:"nickname"},{title:"类型",field:"type",dictType:u.SYSTEM_NOTIFY_TEMPLATE_TYPE,dictClass:"number"},{title:"模版内容",field:"content",table:{width:300},form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}}},{title:"状态",field:"status",dictType:u.COMMON_STATUS,dictClass:"number",isSearch:!0},{title:"备注",field:"remark"},{title:"创建时间",field:"createTime",isForm:!1,formatter:"formatDate",search:{show:!0,itemRender:{name:"XDataTimePicker"}},table:{width:180}}]}),{allSchemas:q}=d(X),A=async e=>await P.get({url:"/system/notify-template/page",params:e}),O=async e=>await P.get({url:"/system/notify-template/get?id="+e}),B=async e=>await P.delete({url:"/system/notify-template/delete?id="+e}),L=j({name:"NotifyTemplate"}),N=j({...L,setup(n){const{t:u}=M(),d=E(),[c,{reload:j,deleteData:X}]=D({allSchemas:q,getListApi:A,deleteApi:B}),L=_(!1),N=_("edit"),Y=_(!1),z=_(""),W=_(!1),K=_(),Q=_(),J=e=>{Y.value=!0,N.value=u("action."+e),z.value=e,L.value=!0},Z=async()=>{var e;const t=null==(e=x(K))?void 0:e.getElFormRef();t&&t.validate((async e=>{var t;if(e){W.value=!0;try{const e=null==(t=x(K))?void 0:t.formModel;"create"===z.value?(await(async e=>await P.post({url:"/system/notify-template/create",data:e}))(e),d.success(u("common.createSuccess"))):(await(async e=>await P.put({url:"/system/notify-template/update",data:e}))(e),d.success(u("common.updateSuccess"))),L.value=!1}finally{W.value=!1,await j()}}}))},$=_({content:"",params:{},userId:0,templateCode:"",templateParams:{}}),G=_({userId:[{required:!0,message:"用户编号不能为空",trigger:"blur"}],templateCode:[{required:!0,message:"模版编号不能为空",trigger:"blur"}],templateParams:{}}),H=_(!1),ee=_([]),te=async()=>{const e={userId:$.value.userId,templateCode:$.value.templateCode,templateParams:$.value.templateParams},t=await(e=>P.post({url:"/system/notify-template/send-notify",data:e}))(e);t&&d.success("提交发送成功！发送结果，见发送日志编号："+t),H.value=!1};return f((()=>{S().then((e=>{ee.value=e}))})),(n,d)=>{const j=p,_=m,f=r,P=i,S=s,M=o,E=l,D=a,A=e,B=U,ae=F,le=t,oe=y("hasPermi");return v(),g(I,null,[b(P,null,{default:h((()=>[b(f,{onRegister:x(c)},{toolbar_buttons:h((()=>[k(b(j,{type:"primary",preIcon:"ep:zoom-in",title:x(u)("action.add"),onClick:d[0]||(d[0]=e=>(J("create"),void(Y.value=!1)))},null,8,["title"]),[[oe,["system:notify-template:create"]]])])),actionbtns_default:h((({row:e})=>[k(b(_,{preIcon:"ep:cpu",title:x(u)("action.test"),onClick:t=>(e=>{$.value.content=e.content,$.value.params=e.params,$.value.templateCode=e.code,$.value.templateParams=e.params.reduce((function(e,t){return e[t]=void 0,e}),{}),G.value.templateParams=e.params.reduce((function(e,t){return e[t]={required:!0,message:"参数 "+t+" 不能为空",trigger:"change"},e}),{}),H.value=!0})(e)},null,8,["title","onClick"]),[[oe,["system:notify-template:send-notify"]]]),k(b(_,{preIcon:"ep:edit",title:x(u)("action.edit"),onClick:t=>(async e=>{var t;J("update");const a=await O(e);null==(t=x(K))||t.setValues(a),Y.value=!1})(e.id)},null,8,["title","onClick"]),[[oe,["system:notify-template:update"]]]),k(b(_,{preIcon:"ep:view",title:x(u)("action.detail"),onClick:t=>(async e=>{J("detail");const t=await O(e);Q.value=t,Y.value=!1})(e.id)},null,8,["title","onClick"]),[[oe,["system:notify-template:query"]]]),k(b(_,{preIcon:"ep:delete",title:x(u)("action.del"),onClick:t=>x(X)(e.id)},null,8,["title","onClick"]),[[oe,["system:notify-template:delete"]]])])),_:1},8,["onRegister"])])),_:1}),b(E,{id:"templateModel",loading:x(Y),modelValue:x(L),"onUpdate:modelValue":d[3]||(d[3]=e=>T(L)?L.value=e:null),title:x(N)},{footer:h((()=>[["create","update"].includes(x(z))?(v(),w(j,{key:0,type:"primary",title:x(u)("action.save"),loading:x(W),onClick:d[1]||(d[1]=e=>Z())},null,8,["title","loading"])):C("",!0),b(j,{loading:x(W),title:x(u)("dialog.close"),onClick:d[2]||(d[2]=e=>L.value=!1)},null,8,["loading","title"])])),default:h((()=>[["create","update"].includes(x(z))?(v(),w(S,{key:0,ref_key:"formRef",ref:K,schema:x(q).formSchema,rules:x(R)},null,8,["schema","rules"])):C("",!0),"detail"===x(z)?(v(),w(M,{key:1,schema:x(q).detailSchema,data:x(Q)},null,8,["schema","data"])):C("",!0)])),_:1},8,["loading","modelValue","title"]),b(E,{id:"sendTest",modelValue:x(H),"onUpdate:modelValue":d[8]||(d[8]=e=>T(H)?H.value=e:null),title:"测试"},{footer:h((()=>[b(j,{type:"primary",title:x(u)("action.test"),loading:x(W),onClick:d[6]||(d[6]=e=>te())},null,8,["title","loading"]),b(j,{title:x(u)("dialog.close"),onClick:d[7]||(d[7]=e=>H.value=!1)},null,8,["title"])])),default:h((()=>[b(le,{model:x($),rules:x(G),"label-width":"200px","label-position":"top"},{default:h((()=>[b(A,{label:"模板内容",prop:"content"},{default:h((()=>[b(D,{type:"textarea",modelValue:x($).content,"onUpdate:modelValue":d[4]||(d[4]=e=>x($).content=e),readonly:""},null,8,["modelValue"])])),_:1}),b(A,{label:"接收人",prop:"userId"},{default:h((()=>[b(ae,{modelValue:x($).userId,"onUpdate:modelValue":d[5]||(d[5]=e=>x($).userId=e),placeholder:"请选择接收人"},{default:h((()=>[(v(!0),g(I,null,V(x(ee),(e=>(v(),w(B,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(v(!0),g(I,null,V(x($).params,(e=>(v(),w(A,{key:e,label:"参数 {"+e+"}",prop:"templateParams."+e},{default:h((()=>[b(D,{modelValue:x($).templateParams[e],"onUpdate:modelValue":t=>x($).templateParams[e]=t,placeholder:"请输入 "+e+" 参数"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])],64)}}});export{N as default};
