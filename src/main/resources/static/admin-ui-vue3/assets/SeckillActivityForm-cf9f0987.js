import{f as x,ab as h,d as G,l as K,r as n,o as R,c as W,i as s,w as u,a as r,j as S,B as X,q as Z,x as $,F as ee,ac as te,a9 as ae,ae as le,H as oe,bE as re,J as ie,L as se,__tla as ce}from"./index-0f589822.js";import{_ as ne,__tla as ue}from"./Dialog.vue_vue_type_style_index_0_lang-2d188c85.js";import{_ as me,__tla as de}from"./Form-89fb98fc.js";import{_ as pe,__tla as fe}from"./SpuSelect.vue_vue_type_script_setup_true_lang-c17b8a9f.js";import{_ as _e,__tla as be}from"./SpuAndSkuList.vue_vue_type_script_setup_true_lang-e469030d.js";import{b as U,d as he,__tla as ye}from"./formatTime-58783104.js";import{g as ve,__tla as ke}from"./seckillConfig-c37a15a6.js";import{r as m,__tla as we}from"./formRules-04f2a102.js";import{D as ge,__tla as Pe}from"./dict-f9a1a53b.js";import{u as Se,__tla as Ce}from"./useCrudSchemas-9a73989a.js";import{h as Fe,__tla as Ie}from"./spu-3234a0da.js";import{g as De,__tla as Ve}from"./index-c338d539.js";import{u as Te,__tla as Ye}from"./useMessage-45ab706e.js";import{_ as Me}from"./_plugin-vue_export-helper-1b428a4d.js";let C,F,E,A,O,Le=Promise.all([(()=>{try{return ce}catch{}})(),(()=>{try{return ue}catch{}})(),(()=>{try{return de}catch{}})(),(()=>{try{return fe}catch{}})(),(()=>{try{return be}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return ke}catch{}})(),(()=>{try{return we}catch{}})(),(()=>{try{return Pe}catch{}})(),(()=>{try{return Ce}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return Ve}catch{}})(),(()=>{try{return Ye}catch{}})()]).then(async()=>{let I,D;I=x({spuId:[m],name:[m],startTime:[m],endTime:[m],sort:[m],configIds:[m],totalLimitCount:[m],singleLimitCount:[m],totalStock:[m]}),D=x([{label:"\u79D2\u6740\u6D3B\u52A8\u540D\u79F0",field:"name",isSearch:!0,form:{colProps:{span:24}},table:{width:120}},{label:"\u6D3B\u52A8\u5F00\u59CB\u65F6\u95F4",field:"startTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u6D3B\u52A8\u7ED3\u675F\u65F6\u95F4",field:"endTime",formatter:U,isSearch:!0,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD",type:"daterange"}},form:{component:"DatePicker",componentProps:{type:"date",valueFormat:"x"}},table:{width:120}},{label:"\u79D2\u6740\u65F6\u6BB5",field:"configIds",form:{component:"Select",componentProps:{multiple:!0,optionsAlias:{labelField:"name",valueField:"id"}},api:ve},table:{width:300}},{label:"\u65B0\u589E\u8BA2\u5355\u6570",field:"orderCount",isForm:!1,form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u4ED8\u6B3E\u4EBA\u6570",field:"userCount",isForm:!1,form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u8BA2\u5355\u5B9E\u4ED8\u91D1\u989D",field:"totalPrice",isForm:!1,form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u603B\u9650\u8D2D\u6570\u91CF",field:"totalLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u5355\u6B21\u9650\u591F\u6570\u91CF",field:"singleLimitCount",form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u6392\u5E8F",field:"sort",form:{component:"InputNumber",value:0},table:{width:80}},{label:"\u79D2\u6740\u5E93\u5B58",field:"stock",isForm:!1,form:{component:"InputNumber",value:0},table:{width:120}},{label:"\u79D2\u6740\u603B\u5E93\u5B58",field:"totalStock",isForm:!1,table:{width:120}},{label:"\u79D2\u6740\u6D3B\u52A8\u5546\u54C1",field:"spuId",isTable:!0,isSearch:!1,form:{colProps:{span:24}},table:{width:300}},{label:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",formatter:he,search:{component:"DatePicker",componentProps:{valueFormat:"YYYY-MM-DD HH:mm:ss",type:"daterange",defaultTime:[new Date("1 00:00:00"),new Date("1 23:59:59")]}},isForm:!1,table:{width:120}},{label:"\u72B6\u6001",field:"status",dictType:ge.COMMON_STATUS,dictClass:"number",isForm:!1,isSearch:!0,form:{component:"Radio"},table:{width:80}},{label:"\u5907\u6CE8",field:"remark",isSearch:!1,form:{component:"Input",componentProps:{type:"textarea",rows:4},colProps:{span:24}},table:{width:300}},{label:"\u64CD\u4F5C",field:"action",isForm:!1,table:{width:120,fixed:"right"}}]),{allSchemas:F}=Se(D),O=async y=>await h.get({url:"/promotion/seckill-activity/page",params:y}),A=async y=>await h.delete({url:"/promotion/seckill-activity/delete?id="+y}),C=Me(G({name:"PromotionSeckillActivityForm",__name:"SeckillActivityForm",emits:["success"],setup(y,{expose:j,emit:H}){const{t:g}=K(),V=Te(),f=n(!1),T=n(""),_=n(!1),Y=n(""),d=n(),M=n(),L=n(),q=[{name:"productConfig.stock",rule:t=>t>1,message:"\u5546\u54C1\u79D2\u6740\u5E93\u5B58\u5FC5\u987B\u5927\u4E8E 1 \uFF01\uFF01\uFF01"},{name:"productConfig.seckillPrice",rule:t=>t>.01,message:"\u5546\u54C1\u79D2\u6740\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E 0.01 \uFF01\uFF01\uFF01"}],v=n([]),P=n([]),z=(t,e)=>{d.value.setValues({spuId:t}),N(t,e)},N=async(t,e,a)=>{var k;const i=[],c=await Fe([t]);if(c.length==0)return;v.value=[];const o=c[0],b=e===void 0?o==null?void 0:o.skus:(k=o==null?void 0:o.skus)==null?void 0:k.filter(l=>e.includes(l.id));b==null||b.forEach(l=>{let p={skuId:l.id,stock:0,seckillPrice:0};if(a!==void 0){const w=a.find(Q=>Q.skuId===l.id);w&&(w.seckillPrice=te(w.seckillPrice)),p=w||p}l.productConfig=p}),o.skus=b,i.push({spuId:o.id,spuDetail:o,propertyList:De(o)}),v.value.push(o),P.value=i};j({open:async(t,e)=>{var a;if(f.value=!0,T.value=g("action."+t),Y.value=t,await B(),e){_.value=!0;try{const i=await(async c=>await h.get({url:"/promotion/seckill-activity/get?id="+c}))(e);await N(i.spuId,(a=i.products)==null?void 0:a.map(c=>c.skuId),i.products),d.value.setValues(i)}finally{_.value=!1}}}});const B=async()=>{v.value=[],P.value=[],await ae(),d.value.getElFormRef().resetFields()},J=async()=>{if(d&&await d.value.getElFormRef().validate()){_.value=!0;try{const t=d.value.formModel,e=L.value.getSkuConfigs("productConfig");e.forEach(a=>{a.seckillPrice=le(a.seckillPrice)}),t.products=e,Y.value==="create"?(await(async a=>await h.post({url:"/promotion/seckill-activity/create",data:a}))(t),V.success(g("common.createSuccess"))):(await(async a=>await h.put({url:"/promotion/seckill-activity/update",data:a}))(t),V.success(g("common.updateSuccess"))),f.value=!1,H("success")}finally{_.value=!1}}};return(t,e)=>{const a=oe,i=re,c=ie,o=me,b=ne,k=se;return R(),W(ee,null,[s(b,{modelValue:r(f),"onUpdate:modelValue":e[2]||(e[2]=l=>$(f)?f.value=l:null),title:r(T),width:"65%"},{footer:u(()=>[s(a,{disabled:r(_),type:"primary",onClick:J},{default:u(()=>[S("\u786E \u5B9A")]),_:1},8,["disabled"]),s(a,{onClick:e[1]||(e[1]=l=>f.value=!1)},{default:u(()=>[S("\u53D6 \u6D88")]),_:1})]),default:u(()=>[X((R(),Z(o,{ref_key:"formRef",ref:d,isCol:!0,rules:r(I),schema:r(F).formSchema},{spuId:u(()=>[s(a,{onClick:e[0]||(e[0]=l=>r(M).open())},{default:u(()=>[S("\u9009\u62E9\u5546\u54C1")]),_:1}),s(r(_e),{ref_key:"spuAndSkuListRef",ref:L,"rule-config":q,"spu-list":r(v),"spu-property-list-p":r(P)},{default:u(()=>[s(c,{align:"center",label:"\u79D2\u6740\u5E93\u5B58","min-width":"168"},{default:u(({row:l})=>[s(i,{modelValue:l.productConfig.stock,"onUpdate:modelValue":p=>l.productConfig.stock=p,min:0,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(c,{align:"center",label:"\u79D2\u6740\u4EF7\u683C(\u5143)","min-width":"168"},{default:u(({row:l})=>[s(i,{modelValue:l.productConfig.seckillPrice,"onUpdate:modelValue":p=>l.productConfig.seckillPrice=p,min:0,precision:2,step:.1,class:"w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["spu-list","spu-property-list-p"])]),_:1},8,["rules","schema"])),[[k,r(_)]])]),_:1},8,["modelValue","title"]),s(r(pe),{ref_key:"spuSelectRef",ref:M,isSelectSku:!0,onConfirm:z},null,512)],64)}}}),[["__scopeId","data-v-d0272e40"]]),E=Object.freeze(Object.defineProperty({__proto__:null,default:C},Symbol.toStringTag,{value:"Module"}))});export{C as S,Le as __tla,F as a,E as b,A as d,O as g};
